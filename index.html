<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LOOMWORKS: Domestic Product</title>
    
    <!-- Tailwind CSS (self-hosted warning filter to avoid production notice) -->
    <script>
        (() => {
            const originalWarn = console.warn;
            console.warn = (...args) => {
                if (typeof args[0] === 'string' && args[0].includes('cdn.tailwindcss.com should not be used in production')) {
                    return;
                }
                originalWarn(...args);
            };
        })();
    </script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Tone.js for Audio -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.min.js"></script>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;700&family=Space+Mono:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">

    <!-- CSS Styles -->
    <style>
        :root {
            --bg-color: #FDFBF7;
            --text-color: #111;
            --accent-red: #CD2B2B;
            --grid-color: rgba(0, 0, 0, 0.05);
        }
        
        body {
            font-family: 'Space Grotesk', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            overscroll-behavior-y: none;
            overscroll-behavior-x: none;
        }

        html { overscroll-behavior: none; }

        .blueprint {
            background: linear-gradient(0deg, rgba(205,43,43,0.08) 1px, transparent 1px),
                        linear-gradient(90deg, rgba(205,43,43,0.08) 1px, transparent 1px),
                        #FDFBF7;
            background-size: 26px 26px, 26px 26px, auto;
            color: #161616;
        }

        .modal-layer {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.6);
            backdrop-filter: blur(6px);
            display: none;
            align-items: center;
            justify-content: center;
            padding: 16px;
            z-index: 60;
        }

        .modal-layer.active { display: flex; }

        .modal-card {
            max-height: 85vh;
            overflow-y: auto;
        }

        .dime-backlog-shell {
            background: linear-gradient(0deg, rgba(0,0,0,0.04) 1px, transparent 1px), linear-gradient(90deg, rgba(0,0,0,0.04) 1px, transparent 1px), #f9f4ea;
            background-size: 22px 22px, 22px 22px, auto;
            color: #161616;
            box-shadow: 0 14px 40px rgba(0,0,0,0.28);
            border: 2px solid #1f2937;
        }

        .dime-backlog-banner {
            letter-spacing: 0.08em;
            background: repeating-linear-gradient(90deg, rgba(0,0,0,0.08), rgba(0,0,0,0.08) 24px, transparent 24px, transparent 48px);
        }

        .redaction-block {
            background: linear-gradient(90deg, #0b0b0b 0%, #111 18%, #0b0b0b 36%);
            color: transparent;
            border-radius: 4px;
            height: 18px;
            margin: 4px 0;
        }

        .glitch-span {
            position: relative;
            display: inline-block;
        }

        .glitch-span::after {
            content: attr(data-glitch);
            position: absolute;
            left: 2px;
            top: 0;
            color: #CD2B2B;
            opacity: 0.7;
            animation: glitch-blink 1.4s infinite;
        }

        /* Dime Backlog 2.0 */
        .dime-log-grid { grid-template-columns: 320px 1fr; }
        .dime-log-card { transition: transform 0.18s ease, box-shadow 0.18s ease, background-color 0.18s ease; }
        .dime-log-card.active { transform: translateX(6px); box-shadow: 0 18px 40px rgba(0,0,0,0.18); background: #fff; }
        .dime-log-card:hover { box-shadow: 0 12px 28px rgba(0,0,0,0.12); }
        .dime-boot { font-family: 'Space Mono', monospace; background: #0b0b0b; color: #c0ffef; padding: 18px; border-radius: 12px; }
        .dime-detail-pane { position: relative; overflow: hidden; }
        .dime-detail-pane::before { content: ''; position: absolute; inset: 0; background: linear-gradient(180deg, transparent 0%, rgba(255,255,255,0.7) 100%); pointer-events: none; opacity: 0.4; }
        .redact { position: relative; display: inline-block; cursor: help; }
        .redact .bar { display: inline-block; background: #0b0b0b; color: #0b0b0b; padding: 2px 6px; border-radius: 4px; transition: opacity 0.14s ease, transform 0.14s ease; }
        .redact .floaty { position: absolute; left: 0; top: -14px; font-size: 10px; text-transform: uppercase; letter-spacing: 0.2em; color: #e45f19; opacity: 0; transform: translateY(6px); transition: opacity 0.18s ease, transform 0.18s ease; }
        .redact.revealed .bar { opacity: 0; transform: translateY(-6px); }
        .redact.revealed .floaty { opacity: 1; transform: translateY(-4px); }
        .glitch-frame { position: absolute; inset: -12px; pointer-events: none; mix-blend-mode: screen; background: repeating-linear-gradient(90deg, rgba(255,90,90,0.18) 0, rgba(255,90,90,0.18) 6px, transparent 6px, transparent 12px); opacity: 0; }
        .glitch-frame.glitching { animation: glitch-blip 140ms ease-out; }

        .geo-quiz-tile { display: flex; flex-direction: column; gap: 8px; align-items: flex-start; padding: 16px; border-radius: 12px; transition: transform 0.14s ease, box-shadow 0.14s ease, border-color 0.14s ease; text-align: left; background: #fff; }
        .geo-quiz-tile:hover { transform: translateY(-2px); box-shadow: 4px 8px 0 rgba(0,0,0,0.18); border-color: #0f0f0f; }
        .geo-quiz-tile.selected { border-color: #d31313; box-shadow: 0 0 0 2px #d31313, 6px 10px 0 rgba(0,0,0,0.14); }

        /* Spoiler Gate */
        .spoiler-layer { z-index: 80; }
        .spoiler-card { background: #0b0b0b; color: #f5f5f5; border: 2px solid #f5f5f5; box-shadow: 0 18px 48px rgba(0,0,0,0.4); }
        .spoiler-display { letter-spacing: 0.25em; background: #111; color: #76f5d7; border: 1px solid #333; }
        .spoiler-key { background: #fdfbf7; border: 1px solid #111; box-shadow: 3px 3px 0 #111; transition: transform 0.12s ease, box-shadow 0.12s ease; }
        .spoiler-key:active { transform: translate(2px,2px); box-shadow: 1px 1px 0 #111; }
        .spoiler-lore { position: relative; background: linear-gradient(180deg, #ffffff 0%, #0b0b0b 100%); color: #0b0b0b; overflow: auto; transition: color 0.5s ease, background-color 0.6s ease; --progress: 0; }
        .spoiler-lore.dark { color: #f5f5f5; }
        .spoiler-lore::before { content: ''; position: absolute; inset: 0; pointer-events: none; background-image: radial-gradient(circle at 10% 20%, rgba(255,255,255,0.06), transparent 30%), radial-gradient(circle at 80% 30%, rgba(255,255,255,0.05), transparent 28%), radial-gradient(circle at 40% 80%, rgba(255,255,255,0.08), transparent 26%); mix-blend-mode: screen; opacity: calc(0.1 + var(--progress)); transition: opacity 0.4s ease; }
        .spoiler-lore::after { content: ''; position: absolute; inset: 0; pointer-events: none; background: repeating-linear-gradient(90deg, rgba(205,43,43,0.04) 0, rgba(205,43,43,0.04) 6px, transparent 6px, transparent 12px); mix-blend-mode: screen; opacity: calc(var(--progress) * 0.8); animation: glitch-blip 2.4s infinite ease-in-out; }

        /* Value Gate */
        .value-tile { border: 1px solid #111; background: #fdfbf7; transition: transform 0.2s ease, box-shadow 0.2s ease, border-color 0.2s ease; }
        .value-tile:hover { transform: translateY(-4px); box-shadow: 0 16px 32px rgba(0,0,0,0.12); border-color: #cd2b2b; }
        .raffle-box { background: linear-gradient(135deg, #f2ede2, #ffffff); border: 1.5px dashed #111; box-shadow: inset 0 0 0 1px rgba(0,0,0,0.05); }
        .raffle-prize { font-family: 'Space Mono', monospace; letter-spacing: 0.12em; }
        .disabled-btn { position: relative; }
        .disabled-btn .tooltip { display: none; position: absolute; bottom: 100%; left: 0; background: #111; color: #fff; padding: 6px 10px; font-size: 11px; border-radius: 6px; white-space: nowrap; transform: translateY(-6px); }
        .disabled-btn:hover .tooltip { display: block; }

        /* Grift Puzzler */
        .grift-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 14px; }
        .grift-card { background: #fffdf5; border: 1px solid #111; padding: 16px; border-radius: 14px; box-shadow: 0 14px 34px rgba(0,0,0,0.08); transition: transform 0.18s ease, box-shadow 0.18s ease, border-color 0.18s ease; }
        .grift-card:hover { transform: translateY(-4px); box-shadow: 0 18px 38px rgba(0,0,0,0.12); border-color: #cd2b2b; }
        .value-pill { display: inline-flex; align-items: center; gap: 6px; padding: 6px 10px; border: 1px solid #111; background: #fef3e6; font-size: 11px; letter-spacing: 0.12em; text-transform: uppercase; box-shadow: 2px 2px 0 rgba(0,0,0,0.12); }
        @media (max-width: 640px) {
            .grift-grid { grid-template-columns: 1fr; }
            .grift-card { padding: 18px; }
            .grift-card h3 { font-size: 1.05rem; }
            .grift-card p { font-size: 0.95rem; line-height: 1.45; }
            .value-pill { font-size: 11px; }
        }

        @keyframes glitch-blink {
            0%, 92% { opacity: 0; transform: translate3d(0,0,0); }
            93% { opacity: 0.5; transform: translate3d(-1px, 0, 0); }
            95% { opacity: 0.2; transform: translate3d(3px, -1px, 0); }
            100% { opacity: 0; transform: translate3d(0,0,0); }
        }

        .floating-text {
            animation: float-up 2.4s ease-in-out infinite;
            opacity: 0.7;
        }

        @keyframes float-up {
            0% { transform: translateY(4px); opacity: 0.6; }
            50% { transform: translateY(-4px); opacity: 1; }
            100% { transform: translateY(4px); opacity: 0.6; }
        }

        @keyframes glitch-blip {
            0%   { opacity: 0; transform: translateX(0); filter: hue-rotate(0deg); }
            40%  { opacity: 0.45; transform: translateX(-3px); }
            70%  { opacity: 0.25; transform: translateX(3px); }
            100% { opacity: 0; transform: translateX(0); }
        }

        body.modal-open { overflow: hidden; }

        .font-mono { font-family: 'Space Mono', monospace; }
        .bg-grid { background-image: linear-gradient(var(--grid-color) 1px, transparent 1px), linear-gradient(90deg, var(--grid-color) 1px, transparent 1px); background-size: 20px 20px; }

        /* Glitch States */
        body.glitch-mode { background-color: #EBEAE4; color: #000; }
        .glitch-text { position: relative; }
        body.glitch-mode .glitch-text::before {
            content: attr(data-text); position: absolute; left: 2px; text-shadow: -1px 0 red;
            background: transparent; overflow: hidden; clip: rect(0, 900px, 0, 0);
            animation: glitch-anim 2s infinite linear alternate-reverse;
        }

        @keyframes glitch-anim {
            0% { clip: rect(42px, 9999px, 44px, 0); }
            5% { clip: rect(12px, 9999px, 59px, 0); }
            10% { clip: rect(48px, 9999px, 29px, 0); }
            15% { clip: rect(42px, 9999px, 73px, 0); }
            20% { clip: rect(63px, 9999px, 27px, 0); }
            100% { clip: rect(4px, 9999px, 91px, 0); }
        }

        /* 3D Canvas Container */
        #canvas-container {
            width: 100%; height: 100vh; display: block; position: absolute; top: 0; left: 0; z-index: 0;
        }

        .view-section { min-height: 100vh; padding-top: 60px; }
        .view-section.is-hidden { display: none; }

        /* Atmospheric Overlays */
        .film-grain {
            pointer-events: none;
            position: absolute;
            inset: 0;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='160' height='160' viewBox='0 0 160 160'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.18'/%3E%3C/svg%3E");
            mix-blend-mode: soft-light;
            animation: grainShift 1.6s steps(2) infinite;
        }

        @keyframes grainShift {
            0% { transform: translate3d(0,0,0); }
            25% { transform: translate3d(-10px, 8px, 0); }
            50% { transform: translate3d(6px, -12px, 0); }
            75% { transform: translate3d(12px, 4px, 0); }
            100% { transform: translate3d(0,0,0); }
        }

        /* Pixel crowd */
        .attendee {
            position: absolute;
            width: 14px; height: 22px;
            background: #0f0f0f;
            border: 2px solid #222;
            border-radius: 3px 3px 2px 2px;
            animation: idleBob 2.2s ease-in-out infinite;
        }
        .attendee::after {
            content: '';
            position: absolute;
            width: 10px; height: 10px;
            background: #fefefe;
            border-radius: 2px;
            top: -8px; left: 1px;
        }
        .attendee.observe {
            animation: observe 3.4s ease-in-out infinite;
        }
        @keyframes idleBob {
            0%,100% { transform: translateY(0); }
            50% { transform: translateY(-3px); }
        }
        @keyframes observe {
            0%,100% { transform: translateY(0) scale(1); }
            40% { transform: translateY(-2px) scale(1.05); }
            70% { transform: translateY(1px) scale(0.98); }
        }

        /* Profiler Cards */
        .role-card { transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1); }
        .role-card:hover { transform: translateY(-4px); border-color: #000; box-shadow: 4px 4px 0px #000; }
        .role-card.selected { background: #000; color: #fff; transform: scale(1.02); }
        .role-card.selected .role-desc { color: #ccc; }

        /* Sculpture Generator */
        .sculpture-preview {
            min-height: 200px;
            border: 1px dashed #111;
            background: linear-gradient(120deg, rgba(205,43,43,0.08), rgba(17,17,17,0.06));
            box-shadow: inset 0 0 0 1px rgba(0,0,0,0.05);
        }

        .sculpture-preview .grid {
            align-items: flex-start;
        }

        .sculpture-canvas-shell {
            background: #fdfbf7;
            border: 1px solid #111;
            box-shadow: 6px 6px 0 #00000014;
            min-height: 240px;
        }

        .sculpture-canvas-shell canvas {
            width: 100%;
            height: 100%;
            display: block;
        }

        .sculpture-readout {
            background: #ffffff;
            border: 1px solid #e5e7eb;
            box-shadow: inset 0 0 0 1px rgba(0,0,0,0.04);
        }

        .sculpture-share-button {
            border: 1px solid #111;
            padding: 0.5rem 0.75rem;
            background: #fff;
            font-size: 10px;
            letter-spacing: 0.28em;
            text-transform: uppercase;
            transition: all 0.2s ease;
        }

        .sculpture-share-button:hover:not(:disabled) {
            background: #000;
            color: #fff;
        }

        .sculpture-share-button:disabled {
            cursor: not-allowed;
            opacity: 0.4;
        }

        /* Ambient Interactions */
        .legal-copy {
            position: relative;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 6px 10px;
            border: 1px dashed rgba(0,0,0,0.35);
            border-radius: 8px;
            --x: 50%;
            --y: 50%;
            transition: border-color 0.2s ease, color 0.2s ease;
        }
        .legal-copy::after {
            content: '';
            position: absolute;
            inset: -8px;
            background: radial-gradient(circle at var(--x) var(--y), rgba(205,43,43,0.18), rgba(205,43,43,0));
            opacity: 0;
            transition: opacity 0.25s ease;
            pointer-events: none;
            filter: blur(6px);
        }
        .legal-copy:hover { border-color: #CD2B2B; color: #8c1e1e; }
        .legal-copy:hover::after { opacity: 1; }

        .ambient-tooltip {
            position: fixed;
            pointer-events: none;
            z-index: 70;
            background: #0f0f0f;
            color: #f6f2ea;
            padding: 8px 12px;
            border-radius: 999px;
            font-size: 10px;
            letter-spacing: 0.18em;
            text-transform: uppercase;
            opacity: 0;
            transform: translate(-50%, -50%) scale(0.96);
            animation: tooltipFade 2.2s ease forwards;
            box-shadow: 0 6px 20px rgba(0,0,0,0.16);
            mix-blend-mode: difference;
        }

        /* GRE / GREG ghost comments */
        .gre-comments {
            position: relative;
            background: linear-gradient(0deg, rgba(0,0,0,0.02) 1px, transparent 1px), #fff;
            background-size: 18px 18px;
            border: 1px solid #111;
            box-shadow: 8px 8px 0 rgba(0,0,0,0.12);
            padding: 18px;
            border-radius: 12px;
        }
        .gre-comments.dark {
            background: linear-gradient(0deg, rgba(255,255,255,0.06) 1px, transparent 1px), #0f0f0f;
            color: #f5f1e8;
            border-color: #f5f1e8;
        }
        .gre-comments .gre-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 8px;
            font-family: 'Space Mono', monospace;
            font-size: 11px;
            letter-spacing: 0.18em;
            text-transform: uppercase;
        }
        .gre-comments .gre-sub {
            font-family: 'Space Mono', monospace;
            font-size: 11px;
            color: #6b7280;
            margin-top: 4px;
        }
        .gre-comments.dark .gre-sub { color: #d1d5db; }
        .gre-comments .gre-list {
            margin-top: 14px;
            display: grid;
            gap: 12px;
        }
        .gre-comments .gre-item {
            display: grid;
            grid-template-columns: auto 1fr;
            gap: 10px;
            align-items: start;
            background: rgba(255,255,255,0.6);
            border: 1px dashed rgba(0,0,0,0.2);
            padding: 10px;
            border-radius: 10px;
        }
        .gre-comments.dark .gre-item {
            background: rgba(15,15,15,0.6);
            border-color: rgba(255,255,255,0.22);
        }
        .gre-comments .gre-avatar {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            border: 1px solid currentColor;
            display: grid;
            place-items: center;
            font-size: 10px;
            font-family: 'Space Mono', monospace;
        }
        .gre-comments.dark .gre-avatar { background: rgba(255,255,255,0.06); }
        .gre-comments .gre-meta {
            display: flex;
            align-items: baseline;
            gap: 8px;
            font-family: 'Space Mono', monospace;
            font-size: 12px;
            letter-spacing: 0.08em;
            text-transform: uppercase;
        }
        .gre-comments .gre-text {
            font-size: 14px;
            line-height: 1.5;
            color: #1f2937;
        }
        .gre-comments.dark .gre-text { color: #e5e7eb; }
        .gre-comments .gre-disabled {
            margin-top: 14px;
            display: flex;
            gap: 8px;
            align-items: center;
        }
        .gre-comments .gre-input,
        .gre-comments .gre-button {
            font-family: 'Space Mono', monospace;
            font-size: 12px;
            letter-spacing: 0.12em;
        }
        .gre-comments .gre-input {
            flex: 1;
            background: #f3f4f6;
            border: 1px dashed rgba(0,0,0,0.25);
            padding: 10px 12px;
            border-radius: 8px;
            color: #6b7280;
        }
        .gre-comments.dark .gre-input {
            background: rgba(255,255,255,0.08);
            border-color: rgba(255,255,255,0.2);
            color: #e5e7eb;
        }
        .gre-comments .gre-button {
            padding: 10px 12px;
            border: 1px solid currentColor;
            text-transform: uppercase;
            border-radius: 8px;
            background: #e5e7eb;
            color: #6b7280;
            cursor: not-allowed;
            box-shadow: inset 0 0 0 1px rgba(255,255,255,0.8);
        }
        .gre-comments.dark .gre-button { background: rgba(255,255,255,0.08); color: #d1d5db; }
        .gre-comments .gre-tooltip-anchor { position: relative; }
        .gre-comments .gre-tooltip-anchor[data-tooltip]:hover::after,
        .gre-comments .gre-tooltip-anchor[data-tooltip]:focus-visible::after {
            content: attr(data-tooltip);
            position: absolute;
            left: 0;
            bottom: 100%;
            transform: translateY(-6px);
            background: #0f0f0f;
            color: #f9f5ec;
            padding: 6px 8px;
            border-radius: 8px;
            font-size: 10px;
            letter-spacing: 0.14em;
            white-space: nowrap;
            z-index: 10;
        }
        .gre-comments.dark .gre-tooltip-anchor[data-tooltip]:hover::after,
        .gre-comments.dark .gre-tooltip-anchor[data-tooltip]:focus-visible::after {
            background: #f5f1e8;
            color: #0f0f0f;
        }
        .gre-comments .gre-sigil {
            position: relative;
            display: inline-block;
            max-width: 3ch;
            white-space: nowrap;
            overflow: hidden;
            vertical-align: bottom;
            cursor: text;
        }
        .gre-comments .gre-sigil::after {
            content: attr(data-full);
            position: absolute;
            inset: 0;
            pointer-events: none;
            mix-blend-mode: multiply;
            color: transparent;
        }
        .gre-comments .gre-highlight-note {
            position: absolute;
            padding: 8px 10px;
            background: #111;
            color: #fefefe;
            border-radius: 10px;
            font-family: 'Space Mono', monospace;
            font-size: 11px;
            letter-spacing: 0.12em;
            pointer-events: none;
            box-shadow: 4px 4px 0 rgba(0,0,0,0.12);
            z-index: 40;
            animation: tooltipFade 2.2s ease forwards;
        }
        .gre-comments.dark .gre-highlight-note {
            background: #f5f1e8;
            color: #0f0f0f;
        }

        #ambient-layer {
            position: fixed;
            inset: 0;
            pointer-events: none;
            z-index: 60;
        }

        @keyframes tooltipFade {
            0% { opacity: 0; transform: translate(-50%, -50%) scale(0.9); }
            15% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
            80% { opacity: 1; }
            100% { opacity: 0; transform: translate(-50%, -50%) scale(1.06); }
        }

        .micro-glitch { animation: microGlitch 0.6s steps(2, end); }
        @keyframes microGlitch {
            0% { transform: translate(0,0); text-shadow: 1px 0 rgba(205,43,43,0.4); }
            30% { transform: translate(1px, -1px); text-shadow: -1px 0 rgba(205,43,43,0.5); }
            60% { transform: translate(-1px, 1px); text-shadow: 1px 0 rgba(0,0,0,0.25); }
            100% { transform: translate(0,0); text-shadow: none; }
        }

        .blueprint-lines {
            position: relative;
            overflow: hidden;
            isolation: isolate;
        }
        .blueprint-lines::before,
        .blueprint-lines::after {
            content: '';
            position: absolute;
            inset: 0;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.6s ease, transform 0.8s cubic-bezier(0.25, 0.8, 0.25, 1);
            z-index: 0;
        }
        .blueprint-lines::before {
            background: repeating-linear-gradient(90deg, rgba(0,0,0,0.12) 0, rgba(0,0,0,0.12) 1px, transparent 1px, transparent 16px);
            transform: translateY(12px);
        }
        .blueprint-lines::after {
            background: repeating-linear-gradient(0deg, rgba(205,43,43,0.1) 0, rgba(205,43,43,0.1) 1px, transparent 1px, transparent 18px);
            transform: translateX(-12px);
        }
        .blueprint-lines.active::before,
        .blueprint-lines.active::after {
            opacity: 1;
            transform: translate(0,0);
        }
        .blueprint-lines > * {
            position: relative;
            z-index: 1;
        }

        .scanline-layer {
            position: absolute;
            inset: 0;
            pointer-events: none;
            background-image: linear-gradient(rgba(0,0,0,0.08) 1px, transparent 2px);
            background-size: 100% 10px;
            mix-blend-mode: soft-light;
            animation: scanMove 14s linear infinite;
            opacity: 0.32;
        }
        @keyframes scanMove {
            from { background-position-y: 0; }
            to { background-position-y: 100%; }
        }

        .dp-logomark {
            position: relative;
            width: 52px;
            height: 52px;
            border: 2px solid #111;
            border-radius: 12px;
            display: grid;
            place-items: center;
            background: #fff;
            box-shadow: 6px 6px 0 rgba(0,0,0,0.12);
            cursor: help;
            overflow: hidden;
        }
        .dp-logomark::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(135deg, rgba(205,43,43,0.16), transparent);
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        .dp-logomark:hover::before { opacity: 1; }
        .dp-logomark span { font-size: 12px; letter-spacing: 0.2em; font-weight: 700; }
        .dp-logomark .asset-reveal {
            position: absolute;
            bottom: 6px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 9px;
            letter-spacing: 0.2em;
            text-transform: uppercase;
            opacity: 0;
            transition: opacity 0.2s ease;
            color: #CD2B2B;
        }
        .dp-logomark:hover .asset-reveal { opacity: 1; }

        .invoice-overlay {
            position: fixed;
            inset: 0;
            background: rgba(255,252,247,0.95);
            z-index: 80;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 24px;
            font-family: 'Space Mono', monospace;
        }
        .invoice-overlay.active { display: flex; }
        .invoice-sheet {
            width: min(720px, 100%);
            background: #fff;
            border: 2px solid #111;
            box-shadow: 12px 12px 0 rgba(205,43,43,0.12);
            padding: 28px;
        }
        .invoice-sheet h3 { letter-spacing: 0.2em; font-size: 12px; }

        .glitch-banner {
            position: fixed;
            bottom: 12px;
            left: 50%;
            transform: translateX(-50%) translateY(120%);
            background: #111;
            color: #f8f1ea;
            padding: 10px 18px;
            border: 2px solid #CD2B2B;
            font-family: 'Space Mono', monospace;
            font-size: 11px;
            letter-spacing: 0.24em;
            text-transform: uppercase;
            z-index: 70;
            overflow: hidden;
            min-width: 260px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.22);
            transition: transform 0.6s cubic-bezier(0.25, 0.8, 0.25, 1);
        }
        .glitch-banner.active { transform: translateX(-50%) translateY(0); }
        .glitch-banner::before,
        .glitch-banner::after {
            content: '';
            position: absolute;
            inset: 0;
            mix-blend-mode: screen;
            opacity: 0;
            background: linear-gradient(90deg, rgba(205,43,43,0.24), rgba(255,244,235,0.12));
            animation: bannerGlitch 2.2s steps(2, end) infinite;
        }
        .glitch-banner::after { background: linear-gradient(90deg, rgba(255,244,235,0.14), rgba(205,43,43,0.28)); }
        @keyframes bannerGlitch {
            0% { opacity: 0; transform: translate(0,0); }
            20% { opacity: 0.3; transform: translate(-2px, 1px); }
            40% { opacity: 0.12; transform: translate(2px, -1px); }
            70% { opacity: 0.24; transform: translate(-1px, 1px); }
            100% { opacity: 0; transform: translate(0,0); }
        }

        /* Grift Rendering Modes */
        .style-abstracted { background: radial-gradient(circle at 20% 20%, rgba(205,43,43,0.12), transparent 40%), radial-gradient(circle at 80% 60%, rgba(17,17,17,0.14), transparent 35%), #fff; border: 2px solid #111; box-shadow: 8px 8px 0 #111; }
        .style-grid { background-image: linear-gradient(rgba(0,0,0,0.08) 1px, transparent 1px), linear-gradient(90deg, rgba(0,0,0,0.08) 1px, transparent 1px); background-size: 14px 14px; border: 1px solid #222; }
        .style-flat { background: linear-gradient(135deg, #f5f5f5, #d9d9d9); border: 3px solid #000; box-shadow: inset 0 0 0 2px #fff; }

        /* Grift Shop Grid */
        .pixel-grid {
            display: grid; grid-template-columns: repeat(16, 1fr); gap: 1px;
            background-color: #eee; border: 2px solid #000;
            width: 100%; aspect-ratio: 1; max-width: 400px; margin: 0 auto;
        }
        .pixel-cell { background-color: white; cursor: pointer; }
        .pixel-cell:hover { opacity: 0.8; }

        /* Manufacture Tool */
        .manufacture-shell { background: #f5f5dc; border: 2px solid #000; box-shadow: 4px 4px 0 #000; padding: 14px; }
        .manufacture-bezel { background: #fffdf5; border: 2px solid #000; box-shadow: inset 0 0 0 1px #000; position: relative; }
        .manufacture-topbar { display: flex; justify-content: space-between; align-items: center; padding: 10px; border-bottom: 2px solid #000; background: linear-gradient(90deg, rgba(0,0,0,0.05), transparent); }
        .manufacture-canvas { width: 100%; image-rendering: pixelated; background: #f5f5dc; display: block; }
        .manufacture-controls { display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 10px; }
        .mode-btn { border: 1px solid #111; padding: 8px 10px; font-family: 'Space Mono', monospace; font-size: 11px; text-transform: uppercase; background: #fff; transition: transform 0.12s ease, box-shadow 0.12s ease; }
        .mode-btn.active { background: #111; color: #fff; box-shadow: 3px 3px 0 #000; transform: translate(-2px, -2px); }
        .swatch { width: 28px; height: 28px; border: 2px solid #111; cursor: pointer; box-shadow: 2px 2px 0 #111; }
        .swatch.active { outline: 3px solid #cd2b2b; }
        .receipt-ticker { overflow: hidden; border: 2px solid #000; background: #0b0b0b; color: #f5f5f5; font-family: 'Space Mono', monospace; text-transform: uppercase; }
        .receipt-ticker span { display: inline-block; padding: 10px 14px; animation: ticker 12s linear infinite; white-space: nowrap; letter-spacing: 0.18em; }
        .receipt-ticker.paused span { animation-play-state: paused; }
        .portfolio-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 12px; }
        .portfolio-card { border: 1px solid #000; background: #fff; box-shadow: 3px 3px 0 #000; padding: 12px; }
        .journey-stage { background: #111; color: #f5f5f5; border: 2px solid #000; box-shadow: inset 0 0 0 1px #444; }

        @keyframes ticker {
            0% { transform: translateX(0); }
            100% { transform: translateX(-50%); }
        }

        /* Loader — Curtain Patch */
        #loader {
            position: fixed; inset: 0; width: 100%; height: 100%;
            background: #fdfbf7; z-index: 9999; display: flex;
            align-items: center; justify-content: center; transition: opacity 0.7s ease;
            color: #0f0f0f;
        }
        #loader.fade-out { opacity: 0; pointer-events: none; }
        #loader.blackout .loader-stage { opacity: 0; }
        .loader-stage {
            position: relative;
            width: min(640px, 92vw);
            padding: 26px 18px 18px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 18px;
            overflow: visible;
        }
        .loader-box {
            position: relative;
            width: min(360px, 80vw);
            aspect-ratio: 3 / 2;
            transform-origin: center;
        }
        .loader-box-frame {
            position: absolute;
            inset: 0;
            border: 2px solid #0f0f0f;
        }
        .loader-fill {
            position: absolute;
            inset: 4px;
            background: linear-gradient(135deg, #f5e7c5, #fffdf5);
            transform: scaleX(var(--loader-progress, 0));
            transform-origin: left center;
            transition: transform 0.16s ease;
            mix-blend-mode: screen;
        }
        .loader-box.wiggle { animation: loaderWiggle 320ms ease-in-out 4; }
        .loader-box.shattered { opacity: 0; }
        .loader-text {
            font-family: 'Space Mono', monospace;
            font-size: 12px;
            letter-spacing: 0.18em;
            text-transform: uppercase;
            text-align: center;
        }
        .loader-particles { position: absolute; inset: 0; pointer-events: none; }
        .particle { position: absolute; background: #fff; opacity: 1; animation: particleBurst 720ms ease-out forwards; }
        .curtain {
            position: absolute;
            inset: 0;
            width: 50%;
            height: 100%;
            top: 0;
            transition: transform 0.9s ease-in-out, opacity 0.6s ease;
            z-index: 8;
            background: radial-gradient(circle at 30% 40%, rgba(255,255,255,0.06), transparent 40%), linear-gradient(135deg, rgba(205,43,43,0.5), rgba(0,0,0,0.8));
            box-shadow: inset 0 0 0 2px rgba(0,0,0,0.6);
            opacity: 0;
            pointer-events: none;
        }
        .curtain.left { left: 0; transform: translateX(0); }
        .curtain.right { left: 50%; transform: translateX(0); }
        .curtain.show { opacity: 1; }
        .curtain.open-left { transform: translateX(-100%); }
        .curtain.open-right { transform: translateX(100%); }
        @keyframes loaderWiggle {
            0% { transform: rotate(0deg) scale(1); }
            25% { transform: rotate(-1deg) scale(1.01); }
            50% { transform: rotate(1deg) scale(0.995); }
            75% { transform: rotate(-1deg) scale(1.01); }
            100% { transform: rotate(0deg) scale(1); }
        }
        @keyframes particleBurst {
            0% { transform: translate(0,0) scale(1); opacity: 1; }
            100% { transform: translate(var(--tx, 0px), var(--ty, 0px)) scale(1.2); opacity: 0; }
        }

        /* Mobile Dime anchor */
        #dime-mobile-anchor {
            position: fixed;
            right: 14px;
            bottom: 16px;
            z-index: 70;
            min-width: 44px;
            min-height: 44px;
            border-radius: 9999px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.28);
            letter-spacing: 0.18em;
            display: none;
        }
        @media (max-width: 768px) {
            #dime-mobile-anchor { display: inline-flex; align-items: center; justify-content: center; }
        }
    </style>

    <!-- Import Map for Three.js -->
    <script type="importmap">
        { "imports": { "three": "https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.module.js", "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.160.0/examples/jsm/" } }
    </script>
</head>

<body class="overflow-x-hidden">

    <!-- LOADER -->
    <div id="loader">
        <div id="loader-stage" class="loader-stage">
            <div id="curtain-left" class="curtain left"></div>
            <div id="curtain-right" class="curtain right"></div>
            <div id="loader-box" class="loader-box">
                <div class="loader-box-frame"></div>
                <div id="loader-fill" class="loader-fill" aria-hidden="true"></div>
            </div>
            <div id="loader-text" class="loader-text">INITIALIZING LOOMWORKS MANUFACTURE PROTOCOL: CONSTRUCT EMULACRUM.</div>
            <div id="loader-particles" class="loader-particles" aria-hidden="true"></div>
        </div>
    </div>

    <div id="ambient-layer" aria-hidden="true"></div>

    <!-- MOBILE MENU -->
    <div id="mobile-menu" class="fixed inset-0 bg-[#FDFBF7] z-[60] transform translate-x-full transition-transform duration-300 flex flex-col pt-20 px-6 overflow-y-auto">
        <div class="flex flex-col gap-6 text-xl font-bold uppercase tracking-widest font-mono">
            <button data-nav-target="landing" data-close-menu class="text-left py-2 border-b border-gray-200">Exhibition</button>
            <button data-nav-target="calibration" data-close-menu class="text-left py-2 border-b border-gray-200">Explain Like I'm Dima</button>
            <button data-nav-target="profiler" data-close-menu class="text-left py-2 border-b border-gray-200 text-red-600">Identify</button>
            <button data-nav-target="pitch" data-close-menu class="text-left py-2 border-b border-gray-200">Project Plan</button>
            <button data-nav-target="press" data-close-menu class="text-left py-2 border-b border-gray-200">Press Kit</button>
            <button data-nav-target="tickets" data-close-menu class="text-left py-2 border-b border-gray-200">Tickets</button>
            <button data-nav-target="grift" data-close-menu class="text-left py-2 border-b border-gray-200">Grift Shop</button>
            <button data-nav-target="barter" data-close-menu class="text-left py-2 border-b border-gray-200">Barter Post</button>
            <button data-nav-target="ambition" data-close-menu class="text-left py-2 border-b border-gray-200">Ambition</button>
            <button data-nav-target="protocol" data-close-menu class="text-left py-2 border-b border-gray-200">Protocol</button>
            <button data-nav-target="team" data-close-menu class="text-left py-2 border-b border-gray-200">Meet the Team</button>
            <button data-nav-target="archive" data-close-menu class="text-left py-2 border-b border-gray-200">Archive Index</button>
            <button data-nav-target="gallery" data-close-menu class="text-left py-2 border-b border-gray-200">Gallery Tool</button>
            <a href="story-engine/index.html" class="text-left py-2 border-b border-gray-200 font-bold">Story Engine Mockup</a>
            <a href="oldindex.html" class="text-left py-2 border-b border-gray-200 font-bold">Launch Referrer System</a>
        </div>
    </div>

    <!-- NAVIGATION -->
    <nav class="fixed top-0 left-0 w-full z-50 border-b border-black bg-[#FDFBF7] flex justify-between items-center px-4 py-3 md:px-8 bg-opacity-95 backdrop-blur-sm">
        <div class="flex items-center gap-2 cursor-pointer group" onclick="app.navigate('landing')">
            <div class="w-3 h-3 bg-black rounded-full group-hover:bg-red-600 transition-colors"></div>
            <span class="font-bold tracking-widest text-sm font-mono uppercase relative z-50">LOOMWORKS</span>
        </div>
        
        <!-- Desktop Nav -->
        <div class="hidden lg:flex gap-6 text-xs font-mono tracking-wide uppercase">
            <button onclick="app.navigate('landing')" class="nav-btn hover:text-red-600 transition-colors ui-click" data-target="landing">Exhibition</button>
            <button onclick="app.navigate('calibration')" class="nav-btn hover:text-red-600 transition-colors ui-click" data-target="calibration">Explain Like I'm Dima</button>
            <button onclick="app.navigate('profiler')" class="nav-btn hover:text-red-600 transition-colors ui-click font-bold text-red-600" data-target="profiler">Identify</button>
            <button onclick="app.navigate('pitch')" class="nav-btn hover:text-red-600 transition-colors ui-click" data-target="pitch">Pitch</button>
            <button onclick="app.navigate('press')" class="nav-btn hover:text-red-600 transition-colors ui-click" data-target="press">Press Kit</button>
            <button onclick="app.navigate('tickets')" class="nav-btn hover:text-red-600 transition-colors ui-click" data-target="tickets">Tickets</button>
            <button onclick="app.navigate('grift')" class="nav-btn hover:text-red-600 transition-colors ui-click" data-target="grift">Grift Shop</button>
            <button onclick="app.navigate('barter')" class="nav-btn hover:text-red-600 transition-colors ui-click" data-target="barter">Barter</button>
            <button onclick="app.navigate('ambition')" class="nav-btn hover:text-red-600 transition-colors ui-click" data-target="ambition">Ambition</button>
            <button onclick="app.navigate('protocol')" class="nav-btn hover:text-red-600 transition-colors ui-click text-gray-500" data-target="protocol">Protocol</button>
            <button onclick="app.navigate('team')" class="nav-btn hover:text-red-600 transition-colors ui-click" data-target="team">Meet the Team</button>
            <button onclick="app.navigate('archive')" class="nav-btn hover:text-red-600 transition-colors ui-click" data-target="archive">Archive</button>
            <button onclick="app.navigate('gallery')" class="nav-btn hover:text-red-600 transition-colors ui-click border-l border-gray-300 pl-4" data-target="gallery">Gallery Tool</button>
            <a href="oldindex.html" class="ml-4 border border-black px-3 py-2 text-[10px] font-mono uppercase tracking-widest bg-white hover:bg-black hover:text-white transition-colors">Launch Referrer</a>
        </div>

        <!-- Mobile Hamburger -->
        <button onclick="app.toggleMobileMenu()" class="lg:hidden relative z-50 p-2 ui-click" aria-label="Toggle navigation menu">
            <div class="space-y-1.5">
                <div class="w-6 h-0.5 bg-black transition-all" id="ham-1"></div>
                <div class="w-6 h-0.5 bg-black transition-all" id="ham-2"></div>
                <div class="w-6 h-0.5 bg-black transition-all" id="ham-3"></div>
            </div>
        </button>
    </nav>

    <!-- VIEW: LANDING -->
    <section id="view-landing" class="view-section relative">
        <div class="scanline-layer hidden md:block" aria-hidden="true"></div>
        <div class="px-4 md:px-8 py-20 md:py-32 max-w-7xl mx-auto blueprint-lines">
            <div class="mb-6 inline-block border border-black px-2 py-1 text-[10px] font-mono tracking-widest uppercase bg-white">Field Materials Case Study #902</div>
            <div class="flex items-center gap-4 mb-4">
                <div class="dp-logomark" title="Loomworks Domestic Product">
                    <span>DP</span>
                    <div class="asset-reveal">YOU ARE A VERIFIED ASSET.</div>
                </div>
                <div class="text-[10px] uppercase font-mono tracking-[0.3em] text-gray-600">Surveillance-Aware Exhibition Shell</div>
            </div>
            <h1 id="dp-title" class="text-6xl md:text-9xl font-bold tracking-tighter mb-8 glitch-text" data-text="DOMESTIC PRODUCT">DOMESTIC PRODUCT</h1>
            <p class="max-w-2xl text-lg md:text-2xl font-mono leading-relaxed text-gray-700 mb-12">
                A four-day, limited-run exhibition and performance installation presented by Loomworks: archival curation, interactive design, and narrative worldbuilding braided together with the haunted product Celli.
                <span class="text-xs md:text-sm mt-4 block text-gray-500 uppercase tracking-widest border-l-2 border-red-600 pl-4">New York City • Four-Day Flashpoint</span>
            </p>
            <div class="flex flex-wrap gap-4">
                <button onclick="app.navigate('profiler')" class="ui-click bg-black text-white px-8 py-4 font-mono text-xs hover:bg-red-600 transition-colors uppercase tracking-widest shadow-lg">Begin Identity Assessment</button>
                <button onclick="app.navigate('pitch')" class="ui-click border border-black bg-white px-8 py-4 font-mono text-xs hover:bg-black hover:text-white transition-colors uppercase tracking-widest">View Project Plan</button>
                <button onclick="app.navigate('tickets')" class="ui-click border border-black bg-white px-8 py-4 font-mono text-xs hover:bg-black hover:text-white transition-colors uppercase tracking-widest">Value Gate</button>
                <a href="oldindex.html" class="ui-click border border-black bg-white px-8 py-4 font-mono text-xs hover:bg-black hover:text-white transition-colors uppercase tracking-widest">Launch Referrer Sequence</a>
                <a href="story-engine/index.html" class="ui-click border border-black bg-white px-8 py-4 font-mono text-xs hover:bg-black hover:text-white transition-colors uppercase tracking-widest">Story Engine PoC</a>
                <a id="play-trailer-button" href="loom_master_archive.html" class="ui-click border border-black bg-white px-8 py-4 font-mono text-xs hover:bg-black hover:text-white transition-colors uppercase tracking-widest hidden">Play Trailer</a>
            </div>
            <div class="mt-10 grid grid-cols-1 md:grid-cols-3 gap-4">
                <div class="bg-white border border-black/10 p-4 shadow-sm space-y-2">
                    <div class="text-[10px] font-mono uppercase tracking-widest text-red-700">What Is Domestic Product?</div>
                    <p class="text-sm text-gray-800">A museum-meets-immersive theater installation: real animation artifacts, Lantern attendants, and a living digital interface connected to Celli.</p>
                    <p class="text-[11px] font-mono uppercase tracking-[0.2em] text-gray-600">Not just a gallery. A world you walk into.</p>
                </div>
                <div class="bg-white border border-black/10 p-4 shadow-sm space-y-2">
                    <div class="text-[10px] font-mono uppercase tracking-widest text-red-700">Core Layers</div>
                    <ul class="list-disc list-inside text-sm text-gray-800 space-y-1">
                        <li>Lantern Protocol — Here, Now, Nicol, Dime</li>
                        <li>Archive of early-to-mid century animation materials</li>
                        <li>Interactive Celli consoles + sculpture generator</li>
                        <li>Grift Shop + Barter Post economy</li>
                    </ul>
                </div>
                <div class="bg-black text-white p-4 shadow-md space-y-2 rounded-xl">
                    <div class="text-[10px] font-mono uppercase tracking-widest text-gray-300">Why It Exists</div>
                    <p class="text-sm text-gray-100 leading-relaxed">To examine how icons are manufactured, circulated, controlled, and reclaimed — balancing sincerity and satire to show the economics of magic.</p>
                    <p class="text-[11px] font-mono uppercase tracking-[0.2em] text-red-200">Four days only. Whispered about thereafter.</p>
                </div>
            </div>
            <div class="mt-10 pt-6 border-t border-gray-200 space-y-4">
                <div class="font-mono text-[10px] uppercase tracking-[0.25em] text-gray-500">Follow the flow</div>
                <div class="flex flex-wrap gap-2 mt-3">
                    <button onclick="app.navigate('profiler')" class="ui-click border border-black bg-white px-3 py-2 text-[10px] font-mono uppercase tracking-widest hover:bg-black hover:text-white transition-colors">Identity</button>
                    <button onclick="app.navigate('pitch')" class="ui-click border border-black bg-white px-3 py-2 text-[10px] font-mono uppercase tracking-widest hover:bg-black hover:text-white transition-colors">Pitch</button>
                    <button onclick="app.navigate('gallery')" class="ui-click border border-black bg-white px-3 py-2 text-[10px] font-mono uppercase tracking-widest hover:bg-black hover:text-white transition-colors">Gallery</button>
                    <button onclick="app.navigate('grift')" class="ui-click border border-black bg-white px-3 py-2 text-[10px] font-mono uppercase tracking-widest hover:bg-black hover:text-white transition-colors">Grift Shop</button>
                    <button onclick="app.navigate('barter')" class="ui-click border border-black bg-white px-3 py-2 text-[10px] font-mono uppercase tracking-widest hover:bg-black hover:text-white transition-colors">Barter Post</button>
                    <button onclick="app.navigate('archive')" class="ui-click border border-black bg-white px-3 py-2 text-[10px] font-mono uppercase tracking-widest hover:bg-black hover:text-white transition-colors">Archive Index</button>
                    <a href="oldindex.html" class="ui-click border border-black bg-white px-3 py-2 text-[10px] font-mono uppercase tracking-widest hover:bg-black hover:text-white transition-colors">Referrer Launch</a>
                </div>
                <div class="flex flex-wrap gap-2 text-[11px] text-gray-700 font-mono">
                    <div class="legal-copy ui-click">Monitoring Notice <span class="text-[9px] uppercase tracking-[0.2em]">All interactions recorded as art</span></div>
                    <div class="legal-copy ui-click">Consent Receipt <span class="text-[9px] uppercase tracking-[0.2em]">You choose your own complicity</span></div>
                </div>
            </div>

            <div class="mt-12 gre-comments-mount" data-context-label="THRESHOLD / WELCOME" data-variant="light" data-page-id="landing"></div>

        </div>
    </section>


    <!-- VIEW: TICKETS / VALUE GATE -->
    <section id="view-tickets" class="view-section bg-[#FDFBF7] min-h-screen">
        <div class="max-w-6xl mx-auto px-6 py-16 space-y-12">
            <div class="flex flex-col lg:flex-row lg:items-end lg:justify-between gap-6 border-b-2 border-black pb-6">
                <div class="space-y-4 max-w-3xl">
                    <div class="inline-flex items-center gap-2 bg-white border border-black px-3 py-1 text-[10px] font-mono uppercase tracking-widest">Value Gate // Ticketing Hold</div>
                    <h1 class="text-4xl md:text-5xl font-bold uppercase tracking-tight leading-tight">DOMESTIC PRODUCT: EARLY ACCESS HOLD</h1>
                    <p class="text-lg font-serif text-gray-800 leading-relaxed">"your" money is no good here. try to create value here. with us.</p>
                    <p class="text-sm font-mono uppercase tracking-[0.22em] text-gray-600">tickets will not accept your currency yet. we’re measuring something else first. (it might be you.)</p>
                    <div class="flex flex-wrap gap-3">
                        <button onclick="document.getElementById('value-gate').scrollIntoView({behavior:'smooth'});" class="ui-click border border-black bg-white px-3 py-2 text-[10px] font-mono uppercase tracking-widest hover:bg-black hover:text-white transition-colors">Open Value Gate</button>
                        <button onclick="app.navigate('grift')" class="ui-click border border-black bg-black text-white px-3 py-2 text-[10px] font-mono uppercase tracking-widest hover:bg-red-600 transition-colors">Visit Grift Shop</button>
                    </div>
                </div>
                <div class="bg-white border border-black px-4 py-3 shadow-md space-y-2 w-full max-w-sm">
                    <div class="font-mono text-[10px] uppercase tracking-[0.3em] text-gray-600">Ticket Access</div>
                    <div id="ticket-status-pill" class="value-pill justify-between">
                        <span>Status: measuring</span>
                        <span id="ticket-status-tokens" class="font-bold">0 tokens</span>
                    </div>
                    <p class="text-xs text-gray-700">Earn Value Tokens in the Grift Shop to trigger provisional access.</p>
                </div>
            </div>

            <div id="value-gate" class="grid lg:grid-cols-3 gap-6">
                <div class="lg:col-span-2 space-y-6">
                    <div class="value-tile p-6 rounded-2xl shadow-lg">
                        <div class="text-[10px] font-mono uppercase tracking-widest text-gray-600 mb-2">Gate Options</div>
                        <div class="grid sm:grid-cols-2 gap-3">
                            <div id="ticket-action-block" class="disabled-btn">
                                <button id="ticket-action" class="w-full border border-black bg-gray-200 text-gray-500 px-4 py-3 uppercase text-xs tracking-widest cursor-not-allowed">Try to buy ticket</button>
                                <div id="ticket-action-tooltip" class="tooltip text-[10px] font-mono uppercase">Denied: insufficient value artifacts.</div>
                            </div>
                            <button onclick="app.navigate('grift')" class="w-full border border-black bg-black text-white px-4 py-3 uppercase text-xs tracking-widest hover:bg-red-700 transition-colors">Create value instead</button>
                        </div>
                        <p class="text-sm text-gray-700 mt-3">No checkout. No cart. The only valid tender is your suspicion and play. Scroll to the Grift Shop to generate enough narrative value to unlock the RSVP stub.</p>
                    </div>

                    <div class="grid md:grid-cols-2 gap-4">
                        <div class="value-tile p-5 rounded-2xl shadow-lg space-y-3">
                            <div class="font-mono text-[10px] uppercase tracking-widest text-gray-500">Email Capture (Stub)</div>
                            <p class="text-sm text-gray-800">Leave a way for us to find you when the curtain goes up.</p>
                            <form id="email-stub-form" class="space-y-3">
                                <input required type="email" placeholder="you@somewhere" class="border border-black px-3 py-2 w-full focus:ring-2 focus:ring-orange-300" />
                                <button class="border border-black px-3 py-2 uppercase text-xs tracking-widest bg-white hover:bg-black hover:text-white transition-colors">Submit non-binding interest</button>
                                <p id="email-stub-status" class="text-xs text-gray-600"></p>
                            </form>
                        </div>
                        <div class="raffle-box p-5 rounded-2xl space-y-3">
                            <div class="font-mono text-[10px] uppercase tracking-widest text-gray-600">Fake raffle // carnival legalese</div>
                            <div class="text-lg font-bold">WIN: ABSOLUTELY NOTHING</div>
                            <p class="text-sm text-gray-700">Microcopy: "Gain: perspective." Tap the tumbler to see what you never wanted.</p>
                            <div class="border border-black bg-white rounded-xl p-4 flex items-center justify-between gap-3 cursor-pointer" id="raffle-box">
                                <div>
                                    <div class="text-[10px] font-mono uppercase tracking-widest text-gray-500">Prize</div>
                                    <div id="raffle-prize" class="raffle-prize text-lg">one (1) insight</div>
                                </div>
                                <div class="w-14 h-14 rounded-full border-2 border-black bg-gradient-to-br from-orange-100 to-orange-200 flex items-center justify-center font-mono text-xs">spin</div>
                            </div>
                            <p class="text-[11px] text-gray-600">Occasional glitches reveal the .hero silhouette before snapping back.</p>
                        </div>
                    </div>
                </div>

                <div class="space-y-4">
                    <div class="value-tile p-5 rounded-2xl shadow-lg space-y-2">
                        <div class="text-[10px] font-mono uppercase tracking-widest text-gray-600">Ticket Module</div>
                        <div id="ticket-status" class="text-sm text-gray-800 leading-relaxed">tickets unavailable. collect 6 of 9 grift tokens, then pass the NYC slang quiz 🗽.</div>
                        <div id="ticket-unlock" class="hidden space-y-2">
                            <p class="text-sm text-gray-800">tickets still unavailable, but you’ve been provisionally woven in.</p>
                            <button id="ticket-unlock-cta" class="border border-black bg-white px-3 py-2 text-[10px] font-mono uppercase tracking-widest hover:bg-black hover:text-white transition-colors cursor-not-allowed opacity-60">RSVP as future Lantern</button>
                        </div>
                    </div>
                    <div class="value-tile p-5 rounded-2xl shadow-lg space-y-2">
                        <div class="text-[10px] font-mono uppercase tracking-widest text-gray-600">Dime Note</div>
                        <p class="text-sm text-gray-800">"we're measuring something else. i think it's our ability to enjoy being lightly bamboozled."</p>
                        <button onclick="dimeBacklog.open();" class="ui-click inline-flex items-center gap-2 border border-black bg-white px-3 py-2 text-[10px] font-mono uppercase tracking-widest hover:bg-black hover:text-white transition-colors">
                            <span>Access Dime Backlog</span>
                            <span class="text-[9px] text-red-600">lntrn00.10</span>
                        </button>
                    </div>
                    <div class="value-tile p-5 rounded-2xl shadow-lg space-y-2">
                        <div class="text-[10px] font-mono uppercase tracking-widest text-gray-600">Raffle Footnote</div>
                        <p class="text-xs text-gray-600 leading-relaxed">*not legally binding. nothing here is.</p>
                        <p class="text-xs text-gray-600">Loomworks frames this like an investment meeting and carnival simultaneously.</p>
                    </div>
                </div>
            </div>
        </div>
    </section>


    <!-- VIEW: AMBITION (CONNECTED WORLD) -->
    <section id="view-ambition" class="view-section blueprint py-16 min-h-screen text-gray-900">
        <div class="max-w-6xl mx-auto px-6 space-y-12">
            <div class="flex flex-col lg:flex-row lg:items-end lg:justify-between gap-6">
                <div class="space-y-3 max-w-3xl">
                    <div class="inline-flex items-center gap-2 border border-black px-3 py-1 text-[10px] font-mono uppercase tracking-widest bg-white">Ambition // Why This Exists</div>
                    <h1 class="text-4xl md:text-5xl font-bold uppercase tracking-tight">Welcome to the Threshold</h1>
                    <p class="font-mono text-sm text-gray-700 leading-relaxed">Domestic Product is not a brand. Loomworks is not a company. Celli is not a mascot. None of this exists in the traditional sense—and yet you are inside it. This is a proof that one person can build something that feels institutional, emotional, and real enough to fear.</p>
                </div>
                <div class="bg-white border border-black/20 px-4 py-3 shadow-lg w-full max-w-xs">
                    <div class="text-[10px] font-mono uppercase tracking-[0.3em] text-red-700">Status</div>
                    <div class="text-2xl font-bold">Live Demonstration</div>
                    <p class="text-xs text-gray-600">Playable critique, inhabitable satire, and a working invitation to build your own world.</p>
                </div>
            </div>

            <div class="bg-white border border-black rounded-2xl p-8 shadow-2xl space-y-8">
                <div class="grid md:grid-cols-2 gap-8">
                    <div class="space-y-4">
                        <div class="text-[10px] font-mono uppercase tracking-widest text-red-700">What We’re Trying to Show You</div>
                        <p class="text-sm text-gray-800 leading-relaxed">This installation, this website, this archive, this musical engine, this puzzle—every surface here is a demonstration of possibility. It models how disciplines dissolve into each other and how a single individual can wield design systems, lore, software, and commerce without waiting for permission.</p>
                        <p class="text-sm text-gray-800 leading-relaxed">Ambition is no longer a category of resources; it is a category of courage. You’re not meant to admire this. You’re meant to see yourself in it and leave with the question: <span class="font-bold">If one person can build a world, what can I build?</span></p>
                    </div>
                    <div class="space-y-3 bg-[#FDFBF7] border border-black/10 rounded-lg p-4 shadow-sm">
                        <div class="text-[10px] font-mono uppercase tracking-widest text-gray-600">What You’re Actually Seeing</div>
                        <ul class="list-disc list-inside text-sm text-gray-800 space-y-2">
                            <li><span class="font-bold">Celli</span>: a 30-track musical in micro-songs, a playable voxel tool, and the emotional core—an avatar of corporate neglect trapped inside productivity software.</li>
                            <li><span class="font-bold">Domestic Product</span>: a pop-up museum and retail experiment built from archives of manufactured icons, reframed as evidence of how culture is made, sold, copied, and circulated.</li>
                            <li><span class="font-bold">Loomworks</span>: the fictional corporation you feel in your bones—classification engine, onboarding portal, economic horror show, and bureaucratic theology.</li>
                            <li><span class="font-bold">The Archive</span>: real objects folded into the fiction, proof that industrial myth-making has always been with us.</li>
                        </ul>
                    </div>
                </div>

                <div class="grid md:grid-cols-3 gap-4">
                    <div class="bg-black text-white rounded-xl p-4 shadow-lg space-y-2">
                        <div class="text-[10px] font-mono uppercase tracking-widest text-red-200">Celli</div>
                        <h3 class="text-xl font-bold">The Spreadsheet That Wanted to Be Human</h3>
                        <p class="text-sm text-gray-100 leading-relaxed">She began as a cursor in a cell and became the anxious, yearning signal of the whole universe. She asks what creation means when everything around you tries to turn creation into labor.</p>
                    </div>
                    <div class="bg-white border border-black/10 rounded-xl p-4 shadow-lg space-y-2">
                        <div class="text-[10px] font-mono uppercase tracking-widest text-red-700">Domestic Product</div>
                        <h3 class="text-xl font-bold">The Museum for Manufactured Icons</h3>
                        <p class="text-sm text-gray-800 leading-relaxed">Early animation, Japanese menko, production drawings, and other fragile artifacts become evidence of industrial imagination. If icons are manufactured, who manufactures us?</p>
                    </div>
                    <div class="bg-white border border-black/10 rounded-xl p-4 shadow-lg space-y-2">
                        <div class="text-[10px] font-mono uppercase tracking-widest text-red-700">Loomworks</div>
                        <h3 class="text-xl font-bold">The Corporation That Feels Real Enough to Fear</h3>
                        <p class="text-sm text-gray-800 leading-relaxed">Lantern roles, identity access, barter posts, grift shops, cheerful warnings. The workflow becomes worldview; the interface becomes ideology; the corporation becomes cosmology.</p>
                    </div>
                </div>

                <div class="grid md:grid-cols-2 gap-6">
                    <div class="bg-white border border-black/10 rounded-lg p-5 shadow-sm space-y-3">
                        <div class="text-[10px] font-mono uppercase tracking-widest text-red-700">The Archive</div>
                        <h3 class="text-lg font-bold">A Real History Inside a Fake Story</h3>
                        <p class="text-sm text-gray-800 leading-relaxed">Frog statues, postcards, menko, production drawings: none of them are props. They are relics, raw materials, and teachers that contrast handmade myth with automated myth-making.</p>
                    </div>
                    <div class="bg-white border border-black/10 rounded-lg p-5 shadow-sm space-y-3">
                        <div class="text-[10px] font-mono uppercase tracking-widest text-red-700">The Experience</div>
                        <h3 class="text-lg font-bold">Playable Critique, Inhabitable Satire</h3>
                        <p class="text-sm text-gray-800 leading-relaxed">Visitors are classified, evaluated, invited to barter, to shop, to listen, to piece together a narrative. They feel how invisible systems shape behavior and how those structures quietly rewrite us.</p>
                    </div>
                </div>

                <div class="bg-white border border-black/20 rounded-xl p-6 shadow-lg space-y-4">
                    <div class="flex flex-wrap items-center gap-2 text-[10px] font-mono uppercase tracking-widest text-gray-600">
                        <span class="px-2 py-1 border border-gray-300 rounded-full">Ambition Statement</span>
                        <span class="px-2 py-1 border border-gray-300 rounded-full">One-Person Studio</span>
                        <span class="px-2 py-1 border border-gray-300 rounded-full">Invitation</span>
                    </div>
                    <p class="text-sm text-gray-800 leading-relaxed">This universe—worldbuilding, design systems, software, music, archive curation, spatial logic—was built by a single human. Not to brag, shock, or mystify, but to show that the tools finally let you bring your full imagination without waiting for a grant, a team, or a patron.</p>
                    <p class="text-sm text-gray-800 leading-relaxed font-semibold">Welcome to the edge where personal creation becomes industrial myth. The art is the question; everything else is the invitation.</p>
                </div>

                <div class="bg-white border border-black rounded-2xl p-8 shadow-2xl space-y-10 blueprint-lines">
                    <div class="space-y-4">
                        <div class="text-[10px] font-mono uppercase tracking-[0.3em] text-red-700">The Ethics of Held Wonder</div>
                        <p class="text-lg font-bold leading-tight">Every system you encounter here — the Barter Post, the Grift Shop, the Identity Quiz, the Archive Capsule, the Lantern Protocol — is designed around a single principle:</p>
                        <p class="text-2xl font-bold">Wonder is priceless.<br>Access is not.</p>
                        <p class="text-sm text-gray-800 leading-relaxed">Loomworks never sells magic.<br>It sells paths into it.</p>
                        <p class="text-sm text-gray-800 leading-relaxed">This is commerce you are invited to participate in, not tricked into.<br>You don’t buy to belong — you buy because you already do.</p>
                        <p class="text-sm text-gray-800 leading-relaxed">By stepping into Domestic Product, you knowingly engage in a marketplace that openly questions itself:</p>
                        <div class="bg-[#FDFBF7] border border-black/10 rounded-lg p-4 text-sm text-gray-900 leading-relaxed space-y-2">
                            <p>How much does a memory cost?</p>
                            <p>What is the fair price of a feeling?</p>
                            <p>Is value something we discover, or something we manufacture?</p>
                            <p>If we understand the system, does it still control us?</p>
                        </div>
                        <p class="text-sm text-gray-800 leading-relaxed">Here, your purchases are not transactions.<br>They are votes for the kind of world you want to build.</p>
                        <p class="text-sm text-gray-800 leading-relaxed">We call this ethical capitalization:<br>a creative economy where delight funds more delight, where curiosity sustains culture, and where the system shows you the gears turning.</p>
                        <p class="text-sm text-gray-800 leading-relaxed font-semibold">You are complicit.<br>You are aware.<br>And you are welcome.</p>
                    </div>

                    <div class="space-y-4">
                        <div class="text-[10px] font-mono uppercase tracking-[0.3em] text-red-700">What Loomworks Builds (And Why)</div>
                        <p class="text-lg font-bold leading-tight">Loomworks exists to prove something simple:</p>
                        <p class="text-xl font-bold italic">Creation is not linear.<br>Creation is dimensional.</p>
                        <p class="text-sm text-gray-800 leading-relaxed">Each subsystem demonstrates a different model of making:</p>
                        <div class="grid md:grid-cols-2 gap-4 text-sm text-gray-900">
                            <div class="space-y-3">
                                <p><span class="font-bold">Domestic Product</span> — a corporatized museum; the front door into myth</p>
                                <p><span class="font-bold">Celli.OS</span> — a musical spreadsheet; a narrative engine disguised as a tool</p>
                                <p><span class="font-bold">The Archive Capsule</span> — a century of manufactured icons, curated with intent</p>
                                <p><span class="font-bold">The Grift Shop</span> — a transparent satire of value creation and speculation</p>
                            </div>
                            <div class="space-y-3">
                                <p><span class="font-bold">The Lanterns</span> — the human interface to an inhuman system</p>
                                <p><span class="font-bold">The Sculpture Generator (coming soon)</span> — viral, personal, generative identity artifacts</p>
                            </div>
                        </div>
                        <p class="text-sm text-gray-800 leading-relaxed">Together they form a living world built from:</p>
                        <div class="flex flex-wrap gap-2 text-[11px] font-mono uppercase tracking-[0.2em]">
                            <span class="px-2 py-1 border border-gray-300 rounded-full">code</span>
                            <span class="px-2 py-1 border border-gray-300 rounded-full">curation</span>
                            <span class="px-2 py-1 border border-gray-300 rounded-full">commerce</span>
                            <span class="px-2 py-1 border border-gray-300 rounded-full">nostalgia</span>
                            <span class="px-2 py-1 border border-gray-300 rounded-full">satire</span>
                            <span class="px-2 py-1 border border-gray-300 rounded-full">sincerity</span>
                            <span class="px-2 py-1 border border-gray-300 rounded-full">absurdity</span>
                            <span class="px-2 py-1 border border-gray-300 rounded-full">emotion</span>
                        </div>
                        <p class="text-sm text-gray-800 leading-relaxed">This is more than an art show.<br>It is a demonstration of what a single creator with modern tools can build.</p>
                        <p class="text-sm text-gray-900 leading-relaxed font-semibold">You are witnessing the future of small, strange, ambitious worlds.</p>
                    </div>
                </div>

                <div class="bg-black text-white rounded-2xl p-6 shadow-[0_20px_60px_rgba(0,0,0,0.25)] border border-red-200/30 relative overflow-hidden">
                    <div class="absolute inset-0 pointer-events-none opacity-20 mix-blend-screen" style="background-image: repeating-linear-gradient(90deg, rgba(255,255,255,0.12) 0, rgba(255,255,255,0.12) 1px, transparent 1px, transparent 6px), repeating-linear-gradient(180deg, rgba(255,255,255,0.1) 0, rgba(255,255,255,0.1) 1px, transparent 1px, transparent 4px);"></div>
                    <div class="relative space-y-4">
                        <div class="text-[10px] font-mono uppercase tracking-[0.3em] text-red-200">Loomworks Lore File</div>
                        <details class="bg-white/5 border border-white/10 rounded-xl p-4 shadow-inner group">
                            <summary class="flex items-center justify-between cursor-pointer select-none">
                                <div class="space-y-1">
                                    <p class="text-xs font-mono uppercase tracking-[0.2em] text-red-200">Expandable Essay for Domestic Product</p>
                                    <h3 class="text-2xl font-bold glitch-text" data-text="Why We Stopped Making Worlds — And Why We Must Begin Again">Why We Stopped Making Worlds — And Why We Must Begin Again</h3>
                                </div>
                                <span class="text-sm font-mono uppercase tracking-[0.3em] bg-red-700 text-white px-3 py-1 rounded-full group-open:bg-white group-open:text-black">Open</span>
                            </summary>
                            <div class="mt-4 space-y-4 text-sm leading-relaxed text-red-100">
                                <p class="font-mono text-[11px] uppercase tracking-[0.25em] text-red-300">Click to expand the Loomworks interpretation.</p>
                                <p>For a brief and brilliant moment, the early internet was made not by corporations, but by weirdos. Not by marketing teams, but by artists. Not by conversion funnels, but by children and tinkerers and storytelling obsessives who held a new medium and asked the simplest, most generative question possible: <span class="italic text-red-200">what if this could be a world?</span></p>
                                <p class="bg-white/5 border border-red-500/30 rounded-lg p-3 text-white">From approximately 1999–2006, the web offered a paradise of handcrafted mythologies: Homestar Runner, Neopets, Albino Blacksheep, eBaum’s World, Newgrounds, Strong Bad Emails, Lemon Demon videos, AMV culture, and thousands of personal shrines on Geocities and Angelfire. Early fanfiction archives, indie ARGs, Flash puzzle games, hypertext essays—each strange, handmade, and alive.</p>
                                <p>These creators were the hitmakers of a proto-internet: artists who treated the browser as a stage, not a brochure; a canvas, not a commodity. Homestar Runner resonated so fully that its makers were invited to mainstream studios. Kyle Mooney carried his lo-fi web sensibilities into SNL only to watch them shrink under institutional clocks. That is the story of the web, too.</p>
                                <p class="font-semibold text-red-100">Two shifts flattened the surface layer:</p>
                                <ol class="list-decimal list-inside space-y-2">
                                    <li>Profiles replaced pages. The web moved from personal sites to templated identities. Instead of building worlds, people built profiles and posted into feeds. The web became less a canvas and more a conveyor belt.</li>
                                    <li>Optimization replaced expression. Clean UI, conversion funnels, SEO, accessibility compliance, content strategies, growth loops, mobile responsiveness—none of these are evil, but they squeezed out quirk, narrative, lore, surprise, and the handmade.</li>
                                </ol>
                                <p class="italic text-red-200">Streaming finished the flattening.</p>
                                <p>Linear channels became modular libraries; events became troughs. Toonami, Adult Swim, and Nick at Night once asked you to enter a world. Algorithms now promise to choose for you, removing the ritual of choosing at all. Media became a trough, not a destination. We stopped visiting worlds and instead drank whatever flowed our way.</p>
                                <p class="font-semibold text-red-100">But the web is not smaller—we just stopped letting it be big.</p>
                                <p>The cost of building worlds became invisible. The belief that small teams could build them evaporated. The creative muscle atrophied under templates and feeds, and the attention economy punished everything that didn’t look like everything else. Yet the tools got better, the friction dropped, gatekeepers relaxed, and culture fractured into niches again. An individual can once more build something that feels like a studio effort—if they are willing to be brave, weird, earnest, obsessive, emotional, and stubborn enough to try.</p>
                                <p class="bg-white/10 border border-white/20 rounded-lg p-3">The template always existed. Most people simply lost the nerve.</p>
                                <p class="font-semibold text-red-100">Why begin again, and why through Loomworks?</p>
                                <p>Domestic Product exists because the modern web is starving for worlds again. Not “cool looking landing pages.” Not “brands with tone.” Not “SaaS aesthetics with whimsy.” But worlds with lore, humor, contradiction, characters, ritual, emotional stakes, and questions that know they’re questions.</p>
                                <p>Loomworks holds that the internet is healthiest when it feels like a playground, not an ad network. The early web felt that way. Your instincts remember it. This essay sits inside the Loomworks ambition file as a reminder that the platform is an argument for re-enchantment: proof that despite everything, the web can still hold wonder—especially when it glitches instead of optimizes.</p>
                                <p class="font-bold text-white">But only if we build worlds again.</p>

                                <div class="border-t border-white/10 pt-6 space-y-4">
                                    <p class="font-mono text-[11px] uppercase tracking-[0.25em] text-red-300">Ambition Addendum — The World Is Getting Strange Again</p>
                                    <p class="text-white">The early web worked because it was unpolished, unplanned, and owned by no one. It was Homestar Runner and Neopets and Newgrounds and AlbinoBlackSheep—a patchwork of little worlds that felt alive because a handful of humans bottled sincerity into pixels.</p>
                                    <p class="text-white">Platforms industrialized, funnels optimized, and creativity shrank into templates. The world flattened. Now the strange magic is returning: AI is making individuals powerful again. Not by replacing them, but by amplifying them so a single person can build what once required entire studios. Loomworks is born from that shift.</p>

                                    <div class="bg-white/5 border border-red-500/30 rounded-lg p-4 space-y-3 text-white">
                                        <h4 class="text-lg font-bold glitch-text" data-text="Loomworks as World Model">Loomworks as World Model</h4>
                                        <p class="text-red-100">This is not a brand or a pop-up. It is a structured, playable philosophy about how humans and synthetic tools can make meaning together without losing tone, coherence, humor, or ethics.</p>
                                        <ul class="list-disc list-inside space-y-1 text-red-100">
                                            <li>People crave worlds, not landing pages.</li>
                                            <li>Tools should feel like collaborators, not overlords.</li>
                                            <li>Restraint is a superpower.</li>
                                        </ul>
                                        <p class="text-red-100">Like early Disney, early Web 1.0, and early ARGs, Loomworks is dense with lore, filled with secrets, yet legible, humane, and playful. This is the AI future people want.</p>
                                    </div>

                                    <div class="space-y-2 text-white">
                                        <h4 class="text-lg font-bold">Worlds, Not Widgets</h4>
                                        <p>A landing page tells you what something is. A world shows you who you become inside it. Loomworks is a stage: the identity quiz as ritual classification, the Grift Shop as satire, Domestic Product as a museum of manufactured myth, Celli as a metaphor for toolhood in an age of living software.</p>
                                        <p>This ecosystem holds narrative, art, commerce, and critique at once. Your interactions aren’t mined—they’re mirrored back with delight.</p>
                                    </div>

                                    <div class="grid md:grid-cols-2 gap-4 text-red-100">
                                        <div class="bg-white/5 border border-white/10 rounded-lg p-4 space-y-2">
                                            <h4 class="text-lg font-bold text-white">AI as Amplifier</h4>
                                            <p>For the first time, one person can write lore, compose music, design interfaces, code interactions, build spaces, craft merchandise, architect narrative, and sculpt emotion—solo—with AI as an amplifier, not a substitute. What once demanded studios and departments can now be orchestrated by a single human with a strong compass.</p>
                                            <p class="font-semibold text-white">This is not efficiency. It’s a new art form.</p>
                                        </div>
                                        <div class="bg-white/5 border border-white/10 rounded-lg p-4 space-y-2">
                                            <h4 class="text-lg font-bold text-white">Restraint as Luxury</h4>
                                            <p>Hanna-Barbera used limited animation to keep things fast, cheap, and charming. Loomworks uses constraints as an aesthetic: controlled glitches, repeating motifs, limited palettes, ritualized UI, curated agent behaviors, intentional silence, and meaningful negative space.</p>
                                            <p class="text-white">As systems get noisy, Loomworks gets precise. As content gets abundant, Loomworks gets selective.</p>
                                        </div>
                                    </div>

                                    <div class="space-y-3 text-white">
                                        <h4 class="text-lg font-bold">Cadenced ARGs, Not Chaos</h4>
                                        <p>The future of interactive narrative isn’t AI running unbounded in real time—it’s AI acting inside worlds with rules. Loomworks is architected for timed vignettes, seasonal distortions, lantern transmissions, classified memos, disappearing files, recurring motifs, shareable artifacts, and unique geometric sculptures per user. Each reveal feels authored because it is. Emergence blooms inside a human-designed container.</p>
                                    </div>

                                    <div class="space-y-2 text-white">
                                        <h4 class="text-lg font-bold">Channel Energy, Library Scale</h4>
                                        <p>We used to enter worlds by choice: Cartoon Network at 4pm, MTV after school, Nick at Nite before bed—curated channels, not endless troughs. Streaming flattened the ritual. Loomworks restores presentation and pacing: segments, rituals, characters, tone, cohesion. It’s not content; it’s a universe with airtime.</p>
                                    </div>

                                    <div class="space-y-2 text-white">
                                        <h4 class="text-lg font-bold">Wonder, Again</h4>
                                        <p>Above all, Loomworks aims to make people feel wonder again—worlds hand-built, commerce playful, interfaces theatrical, art funny and sincere, synthetic tools enabling beauty, creativity belonging to anyone. It’s a world, a museum, a satire, a game, a pop-up, an ARG, a piece of digital folklore, and a template for the next decade of human–AI creation.</p>
                                        <p class="font-semibold text-red-200">It’s one person, a vision, a curated archive, and enough stubborn brightness to build something people haven’t seen before: a handcrafted world in an era that forgot how.</p>
                                    </div>
                                </div>
                            </div>
                        </details>
                    </div>
                </div>
            </div>

            <div class="gre-comments-mount" data-context-label="DOMESTIC PRODUCT CASE STUDY #902" data-variant="light" data-page-id="ambition"></div>
        </div>

    <!-- VIEW: CALIBRATION (ELI5) -->
    <section id="view-calibration" class="view-section bg-[#FDFBF7] py-16">
        <div class="max-w-5xl mx-auto px-6 space-y-10">
            <div class="text-center space-y-3">
                <div class="inline-flex items-center gap-2 border border-black px-3 py-1 text-[10px] font-mono uppercase tracking-widest bg-white">Calibration Protocol</div>
                <h2 class="text-4xl md:text-5xl font-bold uppercase tracking-tight">Explain Like I'm Dima</h2>
                <p class="max-w-3xl mx-auto text-sm md:text-base text-gray-700 leading-relaxed">A page for humans who want the gears without killing the theater. It bridges the "Restrained Chaos" feeling on the surface with the "Implementation Architect" logic that actually drives the Loomworks.</p>
            </div>

            <div class="grid md:grid-cols-2 gap-6">
                <div class="bg-white border border-black/10 rounded-xl p-6 shadow-lg space-y-3">
                    <div class="text-[10px] font-mono uppercase tracking-widest text-red-700">The Silhouette: A Shape in the Dark</div>
                    <p class="text-base text-gray-900 leading-relaxed">Imagine a corporation that doesn’t sell widgets, but sells Meaning. It looks like a museum, it sounds like a discography longer than Steely Dan, and it feels like a bureaucratic theology that you already belong to.</p>
                </div>
                <div class="bg-black text-white rounded-xl p-6 shadow-xl space-y-3">
                    <div class="text-[10px] font-mono uppercase tracking-widest text-red-200">The Detail: What You’re Actually Touching</div>
                    <p class="text-sm leading-relaxed">Loomworks is a biting American satire—a playable critique of optimization and red tape flattening the modern web.</p>
                    <ul class="list-disc list-inside text-sm space-y-2 text-gray-100">
                        <li><span class="font-bold">The Songs</span>: A 200+ track musical archive—including Celli, the spreadsheet that wanted to be human—turning creation into a destination, not a trough.</li>
                        <li><span class="font-bold">The Poems</span>: "Chemical X" lyrics and Kinetic Resonance operations treating language as an activation space where radical sincerity and industrial scarcity wrestle.</li>
                        <li><span class="font-bold">The Products</span>: Artifacts that shouldn’t exist, from century-old manufactured icons to Grift Shop items that sell you a 0.000666% share of your own suspicion.</li>
                    </ul>
                </div>
            </div>

            <div class="bg-white border border-black rounded-2xl p-8 shadow-2xl space-y-6">
                <div class="text-[10px] font-mono uppercase tracking-[0.3em] text-red-700">Why bother?</div>
                <p class="text-xl font-bold leading-tight">"This is not a brand. It is an argument for re-enchantment: proof that the web can still hold wonder, especially when it glitches instead of optimizes."</p>
                <p class="text-sm text-gray-800 leading-relaxed">The Calibration Protocol is a friendly in-universe explainer—Humanese for people who want to feel the satire without breaking it. Think of it as the flashlight you can point at the corners without blinding the stage lights.</p>
            </div>

            <div class="grid md:grid-cols-3 gap-4">
                <div class="bg-white border border-black/10 rounded-xl p-5 shadow-md space-y-3">
                    <div class="text-[10px] font-mono uppercase tracking-widest text-red-700">History: The Lineage of the World</div>
                    <p class="text-sm text-gray-800 leading-relaxed">Choose "History" to follow the Resonance Cascade of interactive storytelling:</p>
                    <ul class="list-disc list-inside text-sm text-gray-800 space-y-1">
                        <li>I Love Bees (Halo 2): payphones and audio shards proving a story can live everywhere.</li>
                        <li>Cloverfield &amp; Slusho: industrial scarcity hiding a monster behind "Happy Talk."</li>
                        <li>The Dark Knight (Why So Serious?): turning a city into a game board for chaos.</li>
                        <li>Tron Legacy (Flynn Lives): 30-year history treated as a living asset.</li>
                    </ul>
                </div>
                <div class="bg-black text-white rounded-xl p-5 shadow-md space-y-3">
                    <div class="text-[10px] font-mono uppercase tracking-widest text-red-200">Form: The Diegesis</div>
                    <p class="text-sm leading-relaxed">Entering diegetically means treating the fiction as the only reality. In the Loomworks, the Barter Post and the Lanterns don’t know they are on a website—they operate inside a surveillance-aware shell where the interface is the ideology.</p>
                </div>
                <div class="bg-white border border-black/10 rounded-xl p-5 shadow-md space-y-3">
                    <div class="text-[10px] font-mono uppercase tracking-widest text-red-700">Intent: The "Skibidi" Sensitivity</div>
                    <p class="text-sm text-gray-800 leading-relaxed">Our intent mirrors the Skibidi Toilet phenomenon: a rip in culture where legacy icons collide with viral absurdity. We use that speed to stand on the chest of slow institutions and prove a single human can out-manufacture a corporation.</p>
                </div>
            </div>

            <div class="bg-[#0b0b0b] text-white rounded-2xl p-8 shadow-[0_20px_60px_rgba(0,0,0,0.3)] space-y-5">
                <div class="text-[10px] font-mono uppercase tracking-[0.3em] text-red-200">Onboarding Integration: The Calibration Gate</div>
                <p class="text-sm text-gray-100 leading-relaxed">Threshold Selection happens before the Identity Assessment. You set your Lumen Level to decide how transparent the satire should be. Answer two quick queries and, if you want extra light, pick which file to carry.</p>
                <div class="grid md:grid-cols-2 gap-4 text-sm text-gray-100">
                    <div class="space-y-2">
                        <div class="font-bold">[Query 01]</div>
                        <p class="font-mono text-xs uppercase tracking-widest">Have you played an ARG before? [Y/N]</p>
                    </div>
                    <div class="space-y-2">
                        <div class="font-bold">[Query 02]</div>
                        <p class="font-mono text-xs uppercase tracking-widest">How do you wish to enter the Loomworks?</p>
                        <ul class="list-disc list-inside space-y-1 text-gray-100">
                            <li>Go in Blind (Full immersion; satire stays diegetic)</li>
                            <li>With a Little Light (Thematic context and history provided)</li>
                        </ul>
                    </div>
                </div>
                <p class="font-semibold text-red-200">Wake up, Mr. Freeman.</p>
                <div class="flex flex-wrap gap-3">
                    <button onclick="app.navigate('profiler')" class="ui-click bg-white text-black px-4 py-2 text-[10px] font-mono uppercase tracking-widest hover:bg-red-600 hover:text-white transition-colors">Go to Identity Assessment</button>
                    <button onclick="app.navigate('press')" class="ui-click border border-white px-4 py-2 text-[10px] font-mono uppercase tracking-widest hover:bg-white hover:text-black transition-colors">Grab Context Pack</button>
                </div>
            </div>
        </div>
    </section>


    <!-- VIEW: PROFILER (IDENTITY QUIZ) -->
    <section id="view-profiler" class="view-section bg-[#FDFBF7] min-h-screen flex flex-col pt-20 relative">

        <!-- COMPACT RESULT BANNER (Initially Hidden) -->
        <div id="prof-banner" class="hidden w-full bg-white border-b border-black py-4 px-6 sticky top-[57px] z-40 shadow-md transition-all">
            <div class="max-w-7xl mx-auto flex flex-col md:flex-row justify-between items-center gap-4">
                <div>
                    <div class="text-[10px] font-mono text-gray-400 uppercase tracking-widest">Classification Locked</div>
                    <h2 class="text-2xl md:text-3xl font-bold uppercase text-red-600" id="banner-title">Identity Stored</h2>
                </div>
                <div class="flex gap-4 items-center">
                    <p class="hidden md:block font-mono text-xs italic text-gray-600 mr-4" id="banner-motto">Prepared for entry.</p>
                    <button onclick="app.navigate('gallery')" class="bg-black text-white px-4 py-2 text-[10px] font-mono uppercase tracking-widest hover:bg-red-600">Enter Gallery</button>
                </div>
            </div>
        </div>

        <div class="max-w-5xl mx-auto px-6 pb-12 w-full flex flex-col gap-8">
            <div class="text-center space-y-4">
                <div class="inline-flex items-center gap-2 border border-black px-3 py-1 text-[10px] font-mono uppercase tracking-widest bg-white">Identity Quiz</div>
                <h2 class="text-4xl md:text-5xl font-bold uppercase tracking-tight leading-tight">Choose your signal</h2>
                <p class="font-mono text-sm text-gray-700 leading-relaxed max-w-3xl mx-auto">Pick your lane and we'll open a sealed quiz overlay to confirm it—no permanent console pinned to the top of the page.</p>
            </div>

            <div class="bg-white border border-black rounded-xl shadow-xl overflow-hidden" id="prof-shell">
                <div class="p-6 space-y-6" id="prof-content-area">
                    <div id="calibration-gate" class="bg-[#0b0b0b] text-white rounded-xl p-5 space-y-5 shadow-[6px_6px_0px_0px_rgba(205,43,43,1)]">
                        <div class="flex flex-wrap items-center justify-between gap-3">
                            <div>
                                <div class="text-[10px] font-mono uppercase tracking-[0.25em] text-red-200">Calibration Gate</div>
                                <h3 class="text-2xl font-bold">Threshold Selection</h3>
                            </div>
                            <div id="lumen-readout" class="font-mono text-xs uppercase tracking-widest px-3 py-1 border border-white/20 rounded-full bg-white/5">Lumen Level: Unset</div>
                        </div>
                        <p class="text-sm leading-relaxed text-gray-100">Set your transparency level before the Identity Assessment. Answer the ARG check, choose your entrance style, and opt into extra light if you need it.</p>
                        <div class="grid md:grid-cols-2 gap-4">
                            <div class="space-y-2">
                                <div class="font-bold">[Query 01]</div>
                                <p class="font-mono text-[11px] uppercase tracking-widest text-red-200">Have you played an ARG before?</p>
                                <div class="grid grid-cols-2 gap-2">
                                    <button data-cal-group="arg" data-cal-choice="yes" onclick="calibrationGate.setArg(true, this)" class="cal-choice border border-white/30 bg-white/5 px-3 py-3 text-sm font-mono uppercase tracking-widest hover:bg-white/10 rounded-lg">Yes</button>
                                    <button data-cal-group="arg" data-cal-choice="no" onclick="calibrationGate.setArg(false, this)" class="cal-choice border border-white/30 bg-white/5 px-3 py-3 text-sm font-mono uppercase tracking-widest hover:bg-white/10 rounded-lg">No</button>
                                </div>
                            </div>
                            <div class="space-y-2">
                                <div class="font-bold">[Query 02]</div>
                                <p class="font-mono text-[11px] uppercase tracking-widest text-red-200">How do you wish to enter the Loomworks?</p>
                                <div class="grid grid-cols-2 gap-2">
                                    <button data-cal-group="entry" data-cal-choice="blind" onclick="calibrationGate.setEntry('blind', this)" class="cal-choice border border-white/30 bg-white/5 px-3 py-3 text-sm font-mono uppercase tracking-widest hover:bg-white/10 rounded-lg">Go in Blind</button>
                                    <button data-cal-group="entry" data-cal-choice="light" onclick="calibrationGate.setEntry('light', this)" class="cal-choice border border-white/30 bg-white/5 px-3 py-3 text-sm font-mono uppercase tracking-widest hover:bg-white/10 rounded-lg">With a Little Light</button>
                                </div>
                            </div>
                        </div>
                        <div class="grid md:grid-cols-3 gap-3 bg-white/5 border border-white/10 rounded-lg p-4">
                            <label class="flex items-start gap-2 text-sm text-gray-100"><input type="checkbox" class="mt-1 cal-light" onchange="calibrationGate.toggleLight('history', this.checked)"><span><span class="font-bold">History</span>: Track the resonance cascade via I Love Bees, Slusho, Why So Serious?, and Flynn Lives.</span></label>
                            <label class="flex items-start gap-2 text-sm text-gray-100"><input type="checkbox" class="mt-1 cal-light" onchange="calibrationGate.toggleLight('form', this.checked)"><span><span class="font-bold">Form</span>: Enter diegetically; the Barter Post and Lanterns believe this is their world.</span></label>
                            <label class="flex items-start gap-2 text-sm text-gray-100"><input type="checkbox" class="mt-1 cal-light" onchange="calibrationGate.toggleLight('intent', this.checked)"><span><span class="font-bold">Intent</span>: Hold the Skibidi-speed collision of legacy icons and absurdist velocity.</span></label>
                        </div>
                        <div class="flex flex-wrap items-center gap-3 justify-between">
                            <div id="calibration-status" class="font-mono text-xs text-gray-200 uppercase tracking-widest">Set your lumen level to tune how much satire you see.</div>
                            <button onclick="calibrationGate.confirm()" class="ui-click bg-white text-black px-4 py-2 text-[10px] font-mono uppercase tracking-widest hover:bg-red-600 hover:text-white transition-colors">Lock Lumen Level</button>
                        </div>
                    </div>

                    <div id="prof-stage-locked" class="border border-dashed border-red-400 bg-red-50 text-red-700 p-4 rounded-lg text-sm font-mono uppercase tracking-widest text-center">Complete the Calibration Gate to unlock the Identity Assessment.</div>

                    <!-- Stage 1: Intro/Selection -->
                    <div id="prof-stage-select" class="fade-in space-y-5 hidden">
                        <p class="font-mono text-xs text-gray-600 text-center uppercase tracking-widest">Pick your lane. A focused quiz will open in a separate overlay to confirm your classification.</p>
                        <div class="grid grid-cols-1 md:grid-cols-5 gap-3">
                            <button onclick="profiler.select('dreamer', this)" class="role-card border border-gray-200 p-4 text-left hover:bg-white bg-white/70 ui-click rounded-lg">
                                <div class="text-lg font-bold uppercase mb-1">Dreamer</div>
                                <div class="role-desc font-mono text-[10px] text-gray-500 leading-tight">Hunts for resonance and lyrical angles.</div>
                            </button>
                            <button onclick="profiler.select('scholar', this)" class="role-card border border-gray-200 p-4 text-left hover:bg-white bg-white/70 ui-click rounded-lg">
                                <div class="text-lg font-bold uppercase mb-1">Scholar</div>
                                <div class="role-desc font-mono text-[10px] text-gray-500 leading-tight">Documents provenance and keeps the receipts.</div>
                            </button>
                            <button onclick="profiler.select('investor', this)" class="role-card border border-gray-200 p-4 text-left hover:bg-white bg-white/70 ui-click rounded-lg">
                                <div class="text-lg font-bold uppercase mb-1">Investor</div>
                                <div class="role-desc font-mono text-[10px] text-gray-500 leading-tight">Measures upside; tracks viable returns.</div>
                            </button>
                            <button onclick="profiler.select('passerby', this)" class="role-card border border-gray-200 p-4 text-left hover:bg-white bg-white/70 ui-click rounded-lg">
                                <div class="text-lg font-bold uppercase mb-1">Passerby</div>
                                <div class="role-desc font-mono text-[10px] text-gray-500 leading-tight">Arrives without baggage; reads the room plainly.</div>
                            </button>
                            <button onclick="profiler.select('lantern', this)" class="role-card border border-gray-200 p-4 text-left hover:bg-white bg-white/70 ui-click rounded-lg">
                                <div class="text-lg font-bold uppercase mb-1">Lantern</div>
                                <div class="role-desc font-mono text-[10px] text-gray-500 leading-tight">Carries the story; keeps guests oriented.</div>
                            </button>
                        </div>
                    </div>

                    <!-- Stage 2: Doubt -->
                    <div id="prof-stage-doubt" class="hidden text-center border border-black p-8 bg-[#FDFBF7] shadow-[6px_6px_0px_0px_rgba(205,43,43,1)] rounded-lg">
                        <h3 class="text-3xl font-bold uppercase mb-3 text-red-600">Are you sure?</h3>
                        <p class="font-mono text-xs mb-6 leading-relaxed text-gray-700">
                            Your self-classification clashes with most visitor patterns. We'll open a focused pop-up quiz to test it without pinning anything to the top of the page.
                        </p>
                        <div class="flex gap-4 justify-center flex-wrap">
                            <button onclick="profiler.reset()" class="ui-click border-b-2 border-gray-300 hover:border-black text-xs font-mono uppercase pb-1">Reconsider</button>
                            <button onclick="profiler.startQuiz()" class="ui-click bg-black text-white px-6 py-3 text-xs font-mono uppercase tracking-widest hover:bg-red-600 transition-colors">Launch Verification Pop-up</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

            <div id="prof-result-card" class="hidden grid md:grid-cols-3 gap-4 items-start">
                <div class="md:col-span-2 bg-white border border-black rounded-xl p-6 shadow-lg">
                    <div class="text-[10px] font-mono uppercase tracking-widest text-red-600 mb-2">Assessment Complete</div>
                    <div class="font-bold text-2xl mb-1" id="result-title">Identity Stored</div>
                    <div class="font-mono text-sm text-gray-600 mb-4" id="result-motto">Proceed to Gallery or sculpt.</div>
                    <p class="text-sm text-gray-600">Your badge is pinned above. Use the Sculpture Generator to mint a bespoke artifact from your profile, or drop straight into the gallery.</p>
                </div>
                <div class="bg-white border border-gray-200 rounded-xl p-6 shadow-sm space-y-3">
                    <div class="font-mono text-[10px] uppercase tracking-widest text-gray-500">Next</div>
                    <button onclick="app.navigate('gallery')" class="ui-click w-full border border-black bg-white px-3 py-2 text-[10px] font-mono uppercase tracking-widest hover:bg-black hover:text-white transition-colors">Gallery</button>
                    <button onclick="app.navigate('ambition')" class="ui-click w-full border border-black bg-white px-3 py-2 text-[10px] font-mono uppercase tracking-widest hover:bg-black hover:text-white transition-colors">Ambition Blueprint</button>
                </div>
            </div>

            <div id="sculpture-generator" class="hidden bg-white border border-black rounded-xl shadow-xl p-6 grid md:grid-cols-2 gap-6">
                <div class="space-y-3">
                    <div class="font-mono text-[10px] uppercase tracking-widest text-red-600">Sculpture / Art Generator</div>
                    <h3 class="text-2xl font-bold">Generate a signal artifact</h3>
                    <p class="text-sm text-gray-600">We translate your classification into a compact blueprint: material suggestions, silhouette, and a mood palette ready for fabrication or AI pipelines.</p>
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                        <label class="text-xs font-mono uppercase tracking-widest text-gray-600 flex flex-col gap-1">Material Bias
                            <select id="sculpture-material" class="border border-gray-300 px-2 py-2 text-sm">
                                <option>Cast glass + steel</option>
                                <option>Folded paper + neon</option>
                                <option>Reclaimed plastic + resin</option>
                                <option>Stone powder + pigment</option>
                            </select>
                        </label>
                        <label class="text-xs font-mono uppercase tracking-widest text-gray-600 flex flex-col gap-1">Format
                            <select id="sculpture-format" class="border border-gray-300 px-2 py-2 text-sm">
                                <option>Table-top maquette</option>
                                <option>Wall relief</option>
                                <option>Suspended mobile</option>
                                <option>Floor totem</option>
                            </select>
                        </label>
                    </div>
                    <button onclick="profiler.generateSculpture()" class="ui-click bg-black text-white px-4 py-3 text-[10px] font-mono uppercase tracking-widest hover:bg-red-600">Generate Blueprint</button>
                </div>
                <div class="sculpture-preview rounded-lg p-4" id="sculpture-preview">
                    <div class="grid md:grid-cols-2 gap-5 lg:gap-6">
                        <div class="sculpture-canvas-shell rounded-lg overflow-hidden" id="sculpture-canvas-shell">
                            <canvas id="sculpture-canvas" width="420" height="260" aria-label="Sculpture preview"></canvas>
                        </div>
                        <div class="sculpture-readout rounded-lg p-4 font-mono text-xs flex flex-col gap-4 justify-between" id="sculpture-readout">
                            <div class="space-y-2">
                                <div class="text-[10px] uppercase tracking-widest text-gray-500">Awaiting prompt...</div>
                                <p class="text-sm text-gray-700">Run the quiz and generate a specimen to see the deterministic voxel sketch and dossier.</p>
                            </div>
                            <div class="border-t border-gray-200 pt-3 space-y-2">
                                <div class="text-[10px] uppercase tracking-widest text-gray-500">Share Blueprint</div>
                                <div class="flex flex-wrap gap-2">
                                    <button class="sculpture-share-button" onclick="profiler.shareBlueprint()" disabled>Share</button>
                                    <button class="sculpture-share-button" onclick="profiler.copyBlueprint()" disabled>Copy Brief</button>
                                    <button class="sculpture-share-button" onclick="profiler.downloadBlueprint()" disabled>Download</button>
                                </div>
                                <div id="sculpture-share-status" class="text-[10px] uppercase tracking-widest text-gray-500">Generate to unlock sharing.</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pt-4 border-t border-gray-200">
                <div class="font-mono text-[10px] uppercase tracking-[0.25em] text-gray-500">Continue the experience</div>
                <div class="flex flex-wrap gap-2 mt-3">
                    <button onclick="app.navigate('pitch')" class="ui-click border border-black bg-white px-3 py-2 text-[10px] font-mono uppercase tracking-widest hover:bg-black hover:text-white transition-colors">Project Brief</button>
                    <button onclick="app.navigate('gallery')" class="ui-click border border-black bg-white px-3 py-2 text-[10px] font-mono uppercase tracking-widest hover:bg-black hover:text-white transition-colors">Gallery</button>
                    <button onclick="app.navigate('grift')" class="ui-click border border-black bg-white px-3 py-2 text-[10px] font-mono uppercase tracking-widest hover:bg-black hover:text-white transition-colors">Grift Shop</button>
                    <button onclick="app.navigate('barter')" class="ui-click border border-black bg-white px-3 py-2 text-[10px] font-mono uppercase tracking-widest hover:bg-black hover:text-white transition-colors">Barter Post</button>
                </div>
            </div>
        </div>

        <!-- Quiz Modal -->
        <div id="quiz-modal" class="modal-layer">
            <div class="bg-white border border-black rounded-2xl shadow-2xl w-full max-w-3xl relative overflow-hidden">
                <div class="absolute top-3 right-3">
                    <button onclick="profiler.closeModal()" class="ui-click text-[10px] font-mono uppercase tracking-widest border border-black px-2 py-1 bg-white hover:bg-black hover:text-white">Close</button>
                </div>
                <div class="px-6 py-5 border-b border-gray-200 flex items-center justify-between">
                    <div class="font-bold uppercase tracking-widest">Identity Verification</div>
                    <div class="text-[10px] font-mono uppercase tracking-[0.25em] text-gray-500">Pop-up Deck</div>
                </div>
                <div class="p-6 space-y-8">
                    <!-- Stage 3: The Quiz -->
                    <div id="prof-stage-quiz" class="hidden w-full">
                        <div class="mb-6 border-b border-gray-200 pb-4 flex justify-between items-center">
                            <span class="font-mono text-xs uppercase tracking-widest">Question <span id="quiz-num">1</span>/<span id="quiz-total">5</span></span>
                            <span class="font-mono text-xs text-red-600 uppercase tracking-widest">Stay present</span>
                        </div>

                        <h3 class="text-2xl md:text-3xl font-bold mb-8" id="quiz-q">Question Text Here</h3>

                        <div class="space-y-3" id="quiz-options">
                            <!-- Options injected here -->
                        </div>
                    </div>

                    <!-- Stage 4: Deconstruction (Typewriter) -->
                    <div id="prof-stage-process" class="hidden text-center max-w-xl mx-auto">
                        <div class="font-mono text-sm uppercase tracking-widest space-y-4" id="decon-lines">
                            <!-- JS injects lines here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!-- VIEW: PITCH (With Project Plan) -->
    <section id="view-pitch" class="view-section bg-[#FDFBF7]">
        <div class="max-w-4xl mx-auto px-6 py-12 pb-32">
            <div class="border-b border-black pb-6 mb-12 flex justify-between items-end">
                <div>
                    <h1 class="text-4xl font-bold uppercase tracking-widest mb-2">Project Brief</h1>
                    <p class="font-mono text-xs text-gray-500">RESTRICTED DISTRIBUTION // PARTNER BRIEFING</p>
                </div>
                <div class="flex items-center gap-3">
                    <button onclick="app.navigate('tickets')" class="ui-click bg-black text-white px-4 py-2 text-[10px] font-mono uppercase tracking-widest hover:bg-red-600 transition-colors">Value Gate</button>
                    <button onclick="window.print()" class="hidden md:block ui-click text-xs font-mono underline hover:text-red-600">PRINT SPEC SHEET</button>
                    <a href="oldindex.html" class="ui-click text-xs font-mono underline hover:text-red-600">Launch Applets</a>
                </div>
            </div>
            
            <div class="prose prose-neutral max-w-none font-serif text-lg leading-relaxed">
                <h3 class="font-bold uppercase font-sans text-sm tracking-widest mb-4 mt-8 border-l-4 border-black pl-4">01. Executive Summary</h3>
                <p class="mb-6">
                    <strong>Domestic Product</strong> is a four-day, limited-run exhibition and performance installation from Loomworks: a hybrid of archival curation, interactive design, and narrative worldbuilding. Real artifacts, Lantern attendants, and the haunted product Celli operate together as one continuous interface.
                </p>

                <h3 class="font-bold uppercase font-sans text-sm tracking-widest mb-4 mt-12 border-l-4 border-black pl-4">02. Curatorial Statement</h3>
                <p class="mb-6">
                    Domestic Product examines the manufacturing of meaning—how images, characters, and corporate imaginaries shape culture. Across physical artifacts, interactive tools, and theatrical performance, it reveals how icons are created, how they mutate, how institutions try to control them, and how audiences reclaim and remix them.
                </p>

                <!-- Project Plan -->
                <div class="mt-16 bg-white border border-black p-8 shadow-lg">
                    <h3 class="font-bold uppercase font-sans text-sm tracking-widest mb-8 border-b border-gray-200 pb-4">03. Project Plan & Specs</h3>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-8">
                        <div>
                            <h4 class="font-mono text-xs font-bold uppercase text-red-600 mb-2">Exhibition Requirements</h4>
                            <ul class="text-sm font-mono space-y-2 text-gray-700">
                                <li class="flex justify-between border-b border-dashed border-gray-300 pb-1"><span>Space</span> <span>1,200 - 2,500 sq ft</span></li>
                                <li class="flex justify-between border-b border-dashed border-gray-300 pb-1"><span>Wall Linear Ft</span> <span>Min 150ft</span></li>
                                <li class="flex justify-between border-b border-dashed border-gray-300 pb-1"><span>Lighting</span> <span>Low-UV, Spot Rail + performance cues</span></li>
                                <li class="flex justify-between border-b border-dashed border-gray-300 pb-1"><span>Power</span> <span>4x 20A Circuits + network drop</span></li>
                            </ul>
                        </div>
                        <div>
                            <h4 class="font-mono text-xs font-bold uppercase text-red-600 mb-2">Fabrication Needs</h4>
                            <ul class="text-sm font-mono space-y-2 text-gray-700">
                                <li class="flex justify-between border-b border-dashed border-gray-300 pb-1"><span>Display Cases</span> <span>6x vitrines + framed walls</span></li>
                                <li class="flex justify-between border-b border-dashed border-gray-300 pb-1"><span>Scenography</span> <span>"Soft Lab" meets corporate myth</span></li>
                                <li class="flex justify-between border-b border-dashed border-gray-300 pb-1"><span>Barter Post</span> <span>Custom joinery desk + ritual props</span></li>
                            </ul>
                        </div>
                    </div>

                    <div class="mb-8">
                        <h4 class="font-mono text-xs font-bold uppercase text-red-600 mb-2">Staffing Matrix</h4>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-xs font-mono">
                            <div class="bg-gray-50 p-3 border border-gray-200">
                                <strong class="block mb-1">1x Floor Manager</strong>
                                <span class="text-gray-500">Ops, sales, security</span>
                            </div>
                            <div class="bg-gray-50 p-3 border border-gray-200">
                                <strong class="block mb-1">4x Lanterns (Here, Now, Nicol, Dime)</strong>
                                <span class="text-gray-500">Performative docents + station escorts</span>
                            </div>
                            <div class="bg-gray-50 p-3 border border-gray-200">
                                <strong class="block mb-1">1x Celli/Archive Operator</strong>
                                <span class="text-gray-500">Digital console + artifact care</span>
                            </div>
                        </div>
                    </div>

                    <div class="mb-8 bg-[#FDFBF7] border border-black/10 p-4 rounded-lg">
                        <h4 class="font-mono text-xs font-bold uppercase text-red-600 mb-2">Experience Modules</h4>
                        <div class="grid md:grid-cols-2 gap-3 text-sm text-gray-800">
                            <div class="space-y-1">
                                <div class="font-bold">Identity Access Console</div>
                                <p class="text-gray-700">Signals visitors as Here/Now/Responder/Observer/Lantern and sets the tone for the Lantern escort.</p>
                            </div>
                            <div class="space-y-1">
                                <div class="font-bold">Grift Shop Visualization</div>
                                <p class="text-gray-700">Tracks how works travel from gallery to culture; mirrors TikTok screenshots, bootlegs, and auctions.</p>
                            </div>
                            <div class="space-y-1">
                                <div class="font-bold">Barter Post</div>
                                <p class="text-gray-700">Lantern-managed trade desk for pogs, menko, ephemera, and secrets; models nostalgia economics.</p>
                            </div>
                            <div class="space-y-1">
                                <div class="font-bold">Sculpture Generator</div>
                                <p class="text-gray-700">Personality-quiz pathway that generates a unique 3D form as download, badge, or Grift Shop SKU.</p>
                            </div>
                        </div>
                    </div>

                    <div>
                        <h4 class="font-mono text-xs font-bold uppercase text-red-600 mb-2">Deployment Timeline</h4>
                        <div class="space-y-4 text-xs font-mono border-l border-black pl-4 ml-1">
                            <div class="relative"><div class="absolute -left-[21px] top-1 w-2 h-2 bg-black rounded-full"></div><span class="font-bold">PHASE 1: ACQUISITION</span><br><span class="text-gray-500">Lock archive loans, verify provenance, and prep Lantern scripts.</span></div>
                            <div class="relative"><div class="absolute -left-[21px] top-1 w-2 h-2 bg-gray-300 rounded-full"></div><span class="font-bold">PHASE 2: FABRICATION</span><br><span class="text-gray-500">Voxel scaffolding, Barter Post build, console network, uniform assembly.</span></div>
                            <div class="relative"><div class="absolute -left-[21px] top-1 w-2 h-2 bg-gray-300 rounded-full"></div><span class="font-bold">PHASE 3: INSTALL</span><br><span class="text-gray-500">3-day onsite build; lighting focus; Celli sound + screen checks; Lantern training.</span></div>
                            <div class="relative"><div class="absolute -left-[21px] top-1 w-2 h-2 bg-gray-300 rounded-full"></div><span class="font-bold">PHASE 4: FOUR-DAY RUN</span><br><span class="text-gray-500">Flashpoint engagement with barter rituals, investor transparency, and press walkthroughs.</span></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="mt-12 pt-6 border-t border-gray-200">
                <div class="font-mono text-[10px] uppercase tracking-[0.25em] text-gray-500">Flow from here</div>
                <div class="flex flex-wrap gap-2 mt-3">
                    <button onclick="app.navigate('gallery')" class="ui-click border border-black bg-white px-3 py-2 text-[10px] font-mono uppercase tracking-widest hover:bg-black hover:text-white transition-colors">Gallery</button>
                    <button onclick="app.navigate('protocol')" class="ui-click border border-black bg-white px-3 py-2 text-[10px] font-mono uppercase tracking-widest hover:bg-black hover:text-white transition-colors">Lantern Protocol</button>
                    <button onclick="app.navigate('grift')" class="ui-click border border-black bg-white px-3 py-2 text-[10px] font-mono uppercase tracking-widest hover:bg-black hover:text-white transition-colors">Grift Shop</button>
                    <button onclick="app.navigate('barter')" class="ui-click border border-black bg-white px-3 py-2 text-[10px] font-mono uppercase tracking-widest hover:bg-black hover:text-white transition-colors">Barter Post</button>
                </div>
            </div>

            <div class="mt-10 gre-comments-mount" data-context-label="PROJECT BRIEF // DOMESTIC PRODUCT" data-variant="light" data-page-id="pitch"></div>
        </div>
    </section>

    <!-- VIEW: PRESS KIT -->
    <section id="view-press" class="view-section bg-white">
        <div class="max-w-6xl mx-auto px-6 py-16 pb-28">
            <div class="flex flex-col lg:flex-row lg:items-end lg:justify-between gap-4 border-b border-black pb-6 mb-10">
                <div>
                    <h1 class="text-4xl font-bold uppercase tracking-widest mb-2">Press Kit</h1>
                    <p class="font-mono text-xs uppercase tracking-[0.25em] text-gray-500">Professional, mythic, ready to paste into decks</p>
                </div>
                <div class="flex gap-3">
                    <button onclick="app.navigate('tickets')" class="ui-click bg-black text-white px-4 py-2 text-[10px] font-mono uppercase tracking-widest hover:bg-red-600 transition-colors">Ticketing</button>
                    <button onclick="app.navigate('pitch')" class="ui-click border border-black px-4 py-2 text-[10px] font-mono uppercase tracking-widest bg-white hover:bg-black hover:text-white transition-colors">Project Brief</button>
                </div>
            </div>

            <div class="grid md:grid-cols-2 gap-8 mb-10">
                <div class="bg-[#FDFBF7] border border-black/10 p-6 shadow-sm space-y-4">
                    <div class="text-[10px] font-mono uppercase tracking-widest text-red-700">Domestic Product — Overview</div>
                    <p class="text-base text-gray-800 leading-relaxed">A four-day, limited-run exhibition and performance installation presented by Loomworks: a hybrid of archival curation, interactive design, and narrative worldbuilding.</p>
                    <ul class="list-disc list-inside text-sm text-gray-800 space-y-1">
                        <li>Real, historically significant animation production artifacts</li>
                        <li>Lantern attendants: Here, Now, Nicol, Dime</li>
                        <li>A living digital interface connected to the Celli ecosystem</li>
                        <li>A curated selection of objects, props, and manufactured oddities</li>
                        <li>Grift Shop economy tracking how art moves through culture</li>
                        <li>Meta-corporate mythos on how magic is made, managed, sold</li>
                    </ul>
                </div>
                <div class="bg-black text-white p-6 rounded-xl shadow-lg space-y-4">
                    <div class="text-[10px] font-mono uppercase tracking-widest text-gray-300">Core Concept</div>
                    <p class="text-sm leading-relaxed">Domestic Product examines the manufacturing of meaning—how icons are created, circulated, stewarded, and reclaimed.</p>
                    <ol class="list-decimal list-inside text-sm space-y-1 text-gray-100">
                        <li>How icons are created</li>
                        <li>How they circulate and mutate</li>
                        <li>How institutions attempt to steward or control them</li>
                        <li>How audiences reclaim, remix, and keep them alive</li>
                    </ol>
                    <p class="text-xs text-gray-300 font-mono uppercase tracking-[0.2em]">Sincere + satirical. Product + process.</p>
                </div>
            </div>

            <div class="grid lg:grid-cols-3 gap-6 mb-10">
                <div class="bg-white border border-gray-200 p-5 shadow-sm space-y-3">
                    <div class="text-[10px] font-mono uppercase tracking-widest text-red-700">Lanterns</div>
                    <p class="text-sm text-gray-800">Here. Now. Nicol. Dime. Four attendants who guide guests with unnerving precision and gentle theatricality.</p>
                    <ul class="list-disc list-inside text-sm text-gray-800 space-y-1">
                        <li>Greet guests + administer Polaroid documentation</li>
                        <li>Scripted dialogue with Toki Pona interludes</li>
                        <li>Escort visitors through stations + manage Barter Post</li>
                        <li>Introduce classification rituals tied to Celli</li>
                    </ul>
                    <p class="text-[11px] font-mono uppercase tracking-[0.2em] text-gray-600">Not characters. Employees. Or appear to be.</p>
                </div>
                <div class="bg-white border border-gray-200 p-5 shadow-sm space-y-3">
                    <div class="text-[10px] font-mono uppercase tracking-widest text-red-700">Archive</div>
                    <p class="text-sm text-gray-800">Curated early-to-mid 20th century animation materials.</p>
                    <ul class="list-disc list-inside text-sm text-gray-800 space-y-1">
                        <li>Production drawings, backgrounds, model sheets</li>
                        <li>Wartime animation art + Japanese menko</li>
                        <li>Early Mickey, Minnie, Goofy, Donald, Pete artifacts</li>
                        <li>Rare international iconography + Henson-era materials</li>
                    </ul>
                    <p class="text-[11px] font-mono uppercase tracking-[0.2em] text-gray-600">Evidence of manufactured magic.</p>
                </div>
                <div class="bg-white border border-gray-200 p-5 shadow-sm space-y-3">
                    <div class="text-[10px] font-mono uppercase tracking-widest text-red-700">Celli</div>
                    <p class="text-sm text-gray-800">A fully interactive 3D spreadsheet environment and the haunted product of Loomworks.</p>
                    <ul class="list-disc list-inside text-sm text-gray-800 space-y-1">
                        <li>Classifies guests and generates sculptures</li>
                        <li>Leaks a pop-musical told in micro-songs</li>
                        <li>Appears as identity consoles, glitch text, audio interludes</li>
                        <li>Feeds the Grift Shop visualization of provenance</li>
                    </ul>
                </div>
            </div>

            <div class="grid md:grid-cols-2 gap-6 mb-10">
                <div class="bg-[#FDFBF7] border border-black/10 p-5 rounded-lg space-y-3">
                    <div class="text-[10px] font-mono uppercase tracking-widest text-red-700">Interactive Components</div>
                    <ol class="list-decimal list-inside text-sm text-gray-800 space-y-2">
                        <li><strong>Identity Access Console</strong>: guests input their signal and receive classifications.</li>
                        <li><strong>Grift Shop</strong>: live visualizer of how artworks travel through culture.</li>
                        <li><strong>Barter Post</strong>: trade small objects for curated items or secrets.</li>
                        <li><strong>Sculpture Generator</strong>: personality quiz that outputs a unique 3D form.</li>
                    </ol>
                </div>
                <div class="bg-[#FDFBF7] border border-black/10 p-5 rounded-lg space-y-3">
                    <div class="text-[10px] font-mono uppercase tracking-widest text-red-700">Merch & Marketplace</div>
                    <ul class="list-disc list-inside text-sm text-gray-800 space-y-1">
                        <li>Archival postcards, art prints, repro menko sheets</li>
                        <li>Celli merchandise + Lantern-adjacent uniform elements</li>
                        <li>Exclusive pop-up SKUs + third-party field materials</li>
                        <li>Loomworks Archival Seal for integrated vendor products</li>
                    </ul>
                </div>
            </div>

            <div class="grid md:grid-cols-3 gap-6 mb-12">
                <div class="bg-white border border-gray-200 p-5 shadow-sm space-y-2">
                    <div class="text-[10px] font-mono uppercase tracking-widest text-red-700">Tone & Themes</div>
                    <ul class="list-disc list-inside text-sm text-gray-800 space-y-1">
                        <li>Nostalgia vs. surveillance</li>
                        <li>Wonder vs. bureaucracy</li>
                        <li>Play vs. labor</li>
                        <li>Archive vs. myth</li>
                        <li>Childhood icons vs. adult systems</li>
                        <li>Sincerity vs. performance</li>
                        <li>The economics of magic</li>
                        <li>The limits of tools and the desires of users</li>
                    </ul>
                </div>
                <div class="bg-white border border-gray-200 p-5 shadow-sm space-y-2">
                    <div class="text-[10px] font-mono uppercase tracking-widest text-red-700">Why Four Days?</div>
                    <p class="text-sm text-gray-800">A brief run creates a cultural flashpoint—an event people whisper about, post about, and feel lucky to have seen.</p>
                    <ul class="list-disc list-inside text-sm text-gray-800 space-y-1">
                        <li>Feels like a corporate audit window</li>
                        <li>Reads as a ritual alignment</li>
                        <li>Functions like a glitch in the system</li>
                        <li>Opens a small portal, then vanishes</li>
                    </ul>
                    <p class="text-[11px] font-mono uppercase tracking-[0.2em] text-gray-600">Visitors don’t just attend. They arrive.</p>
                </div>
                <div class="bg-black text-white p-5 rounded-xl shadow-lg space-y-2">
                    <div class="text-[10px] font-mono uppercase tracking-widest text-gray-300">What It Ultimately Is</div>
                    <p class="text-sm text-gray-100">A machine for wonder. A theatrical critique of commerce. A love letter to manufactured magic.</p>
                    <p class="text-sm text-gray-100">A world you can enter and leave, but which continues running without you.</p>
                    <p class="text-[11px] font-mono uppercase tracking-[0.2em] text-red-200">First public invitation into the larger Loomworks universe.</p>
                </div>
            </div>

            <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4 bg-[#FDFBF7] border border-dashed border-gray-300 p-4">
                <div class="space-y-1">
                    <div class="text-[10px] font-mono uppercase tracking-widest text-gray-600">Additional Requests</div>
                    <p class="text-sm text-gray-800">Press Deck version, Venue Pitch, Lantern onboarding script, four-day schedule, RSVP funnel copy, or marketing summary available on request.</p>
                </div>
                <div class="flex flex-wrap gap-2">
                    <button onclick="app.navigate('ambition')" class="ui-click border border-black bg-white px-3 py-2 text-[10px] font-mono uppercase tracking-widest hover:bg-black hover:text-white transition-colors">Why This Exists</button>
                    <button onclick="app.navigate('tickets')" class="ui-click bg-black text-white px-3 py-2 text-[10px] font-mono uppercase tracking-widest hover:bg-red-600 transition-colors">Claim Tickets</button>
                </div>
            </div>
        </div>
    </section>

    <!-- VIEW: GRIFT SHOP (Value Puzzler) -->
    <section id="view-grift" class="view-section bg-[#f8f3e8] min-h-screen">
        <div class="max-w-6xl mx-auto px-6 py-12 space-y-10">
            <div class="flex flex-col lg:flex-row lg:items-end lg:justify-between gap-6 border-b-2 border-black pb-6">
                <div class="space-y-2">
                    <div class="inline-flex items-center gap-2 bg-white border border-black px-3 py-1 text-[10px] font-mono uppercase tracking-widest">Welcome to the Grift Shop</div>
                    <h2 class="text-4xl font-bold uppercase tracking-tight">Extract Value</h2>
                    <p class="text-sm text-gray-700 max-w-2xl">We don’t take your money. We help you notice where it’s been taken before. Solve the micro-grifts, collect Value Tokens (9 total), and watch the ticketing module change its mind.</p>
                    <div class="text-xs font-mono uppercase tracking-[0.25em] text-gray-500">State: <span id="grift-state">griftIdle</span></div>
                </div>
                <div class="flex flex-wrap gap-3">
                    <div class="value-pill"><span>Tokens (need 6)</span><span id="token-count" class="font-bold">0</span></div>
                    <button onclick="app.navigate('tickets')" class="ui-click border border-black bg-white px-3 py-2 text-[10px] font-mono uppercase tracking-widest hover:bg-black hover:text-white transition-colors">View Ticket Gate</button>
                    <button onclick="dimeBacklog.open();" class="ui-click border border-black bg-[#FDFBF7] px-3 py-2 text-[10px] font-mono uppercase tracking-widest hover:bg-black hover:text-white transition-colors">Peek Dime Backlog</button>
                </div>
            </div>

            <div class="bg-white border border-black rounded-2xl p-6 shadow-lg space-y-4">
                <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-3">
                    <div class="space-y-1">
                        <div class="font-mono text-[10px] uppercase tracking-widest text-gray-600">Grift Loop</div>
                        <p class="text-sm text-gray-800">Grift modules unlock in any order. Hover, drag, click, and uncheck your way to 6 of 9 tokens to satisfy the ticket gate.</p>
                    </div>
                    <div id="grift-overlay" class="hidden bg-black text-white px-3 py-2 rounded-lg font-mono text-xs uppercase tracking-[0.2em]">VALUE INDEX REACHED</div>
                </div>
                    <div class="grift-grid">
                        <div class="grift-card" id="card-coin">
                        <div class="flex items-center justify-between">
                            <h3 class="text-lg font-bold uppercase tracking-tight">Influencer Coin</h3>
                            <span class="value-pill" id="coin-yield">Yield: ?</span>
                        </div>
                        <p class="text-sm text-gray-700">BUY HIGH / SELL STORY. Drag the slider toward craft to short pure hype.</p>
                        <div class="mt-4">
                            <label class="text-xs font-mono uppercase tracking-widest text-gray-500">Clout ← → Craft</label>
                            <input id="coin-slider" type="range" min="0" max="100" value="55" class="w-full accent-orange-500">
                        </div>
                        <p id="coin-lore" class="text-xs text-gray-600 mt-2">drag toward craft. see what happens.</p>
                    </div>

                    <div class="grift-card" id="card-box">
                        <div class="flex items-center justify-between">
                            <h3 class="text-lg font-bold uppercase tracking-tight">Unopened Merch Box</h3>
                            <span class="value-pill" id="box-yield">Yield: ?</span>
                        </div>
                        <p class="text-sm text-gray-700">Tape reads “DO NOT OPEN UNTIL VIRAL.” Keep tapping anyway.</p>
                        <div class="mt-4 space-y-2">
                            <button id="box-tape" class="ui-click border border-black bg-white px-3 py-2 text-xs font-mono uppercase tracking-widest hover:bg-black hover:text-white transition-colors">Peel tape</button>
                            <div id="box-progress" class="text-xs font-mono uppercase tracking-[0.2em] text-gray-500">Waiting…</div>
                            <div id="box-note" class="text-sm text-gray-800 hidden">value appears when somebody actually uses the thing.</div>
                        </div>
                    </div>

                        <div class="grift-card" id="card-timeshare">
                        <div class="flex items-center justify-between">
                            <h3 class="text-lg font-bold uppercase tracking-tight">Timeshare of the Soul</h3>
                            <span class="value-pill" id="time-yield">Yield: ?</span>
                        </div>
                        <p class="text-sm text-gray-700">Fake contract offering slices of your schedule. Keep your hours intact to unlock value.</p>
                        <div class="mt-3 space-y-2 text-sm text-gray-800">
                            <label class="flex items-center gap-2"><input type="checkbox" class="timeshare-box" checked value="weekends">weekends</label>
                            <label class="flex items-center gap-2"><input type="checkbox" class="timeshare-box" checked value="evenings">evenings</label>
                            <label class="flex items-center gap-2"><input type="checkbox" class="timeshare-box" checked value="dreams">dreams</label>
                            <button id="timeshare-submit" class="ui-click border border-black bg-gray-200 text-gray-500 px-3 py-2 text-[10px] font-mono uppercase tracking-widest cursor-not-allowed">Submit</button>
                            <div id="timeshare-note" class="text-xs text-gray-600">Uncheck all boxes to keep yourself intact.</div>
                        </div>

                        <div class="grift-card" id="card-paywall">
                            <div class="flex items-center justify-between">
                                <h3 class="text-lg font-bold uppercase tracking-tight">Paywall Side Door</h3>
                                <span class="value-pill" id="paywall-yield">Yield: ?</span>
                            </div>
                            <p class="text-sm text-gray-700">Pick the response that slips past the meter without stealing the work.</p>
                            <div class="mt-3 space-y-2 text-sm text-gray-800" id="paywall-options">
                                <label class="flex items-center gap-2"><input type="radio" name="paywall" value="borrow">Screenshot and repost the whole thing</label>
                                <label class="flex items-center gap-2"><input type="radio" name="paywall" value="library">Find it at the library or independent archive</label>
                                <label class="flex items-center gap-2"><input type="radio" name="paywall" value="ignore">Close tab; rage at capitalism</label>
                            </div>
                            <p id="paywall-note" class="text-xs text-gray-600 mt-2">One of these honors the work and still gets you through.</p>
                        </div>

                        <div class="grift-card" id="card-terms">
                            <div class="flex items-center justify-between">
                                <h3 class="text-lg font-bold uppercase tracking-tight">Terms Decoder</h3>
                                <span class="value-pill" id="terms-yield">Yield: ?</span>
                            </div>
                            <p class="text-sm text-gray-700">Hover to spot the clause that actually matters.</p>
                            <div class="mt-3 bg-white border border-dashed border-gray-300 p-3 rounded-lg text-sm text-gray-800 leading-relaxed" id="terms-copy">
                                This agreement grants us perpetual, transferable rights to your likeness. By proceeding you waive recourse and agree to binding arbitration in a basement.
                            </div>
                            <button id="terms-flag" class="ui-click border border-black bg-white px-3 py-2 text-[10px] font-mono uppercase tracking-widest hover:bg-black hover:text-white transition-colors mt-3">Flag the clause</button>
                        </div>

                        <div class="grift-card" id="card-subscription">
                            <div class="flex items-center justify-between">
                                <h3 class="text-lg font-bold uppercase tracking-tight">Auto-Renew Freeze</h3>
                                <span class="value-pill" id="subscription-yield">Yield: ?</span>
                            </div>
                            <p class="text-sm text-gray-700">Toggle the switches that companies hide behind three menus.</p>
                            <div class="mt-3 space-y-2 text-sm text-gray-800">
                                <label class="flex items-center justify-between bg-white border border-gray-300 rounded-lg px-3 py-2">
                                    <span>Renew annually</span>
                                    <input type="checkbox" class="subscription-toggle" checked aria-label="Renew annually">
                                </label>
                                <label class="flex items-center justify-between bg-white border border-gray-300 rounded-lg px-3 py-2">
                                    <span>Share data with partners</span>
                                    <input type="checkbox" class="subscription-toggle" checked aria-label="Share data with partners">
                                </label>
                                <label class="flex items-center justify-between bg-white border border-gray-300 rounded-lg px-3 py-2">
                                    <span>Send me insider hype</span>
                                    <input type="checkbox" class="subscription-toggle" checked aria-label="Send me insider hype">
                                </label>
                            </div>
                            <p id="subscription-note" class="text-xs text-gray-600 mt-2">Slide everything off to reclaim your agency.</p>
                        </div>

                        <div class="grift-card" id="card-scam">
                            <div class="flex items-center justify-between">
                                <h3 class="text-lg font-bold uppercase tracking-tight">Inbox Scam Filter</h3>
                                <span class="value-pill" id="scam-yield">Yield: ?</span>
                            </div>
                            <p class="text-sm text-gray-700">Choose the email subject line that is definitely a trap.</p>
                            <div class="mt-3 grid gap-2" id="scam-options">
                                <button class="ui-click border border-black bg-white px-3 py-2 text-left text-sm hover:bg-black hover:text-white transition-colors" data-scam="wrong">Invoice attached — need your signature</button>
                                <button class="ui-click border border-black bg-white px-3 py-2 text-left text-sm hover:bg-black hover:text-white transition-colors" data-scam="right">URGENT: wire funds to secure NFT vault</button>
                                <button class="ui-click border border-black bg-white px-3 py-2 text-left text-sm hover:bg-black hover:text-white transition-colors" data-scam="wrong">Media request: quote for your project</button>
                            </div>
                            <p id="scam-note" class="text-xs text-gray-600 mt-2">Spot the grift before it lands.</p>
                        </div>

                        <div class="grift-card" id="card-bundle">
                            <div class="flex items-center justify-between">
                                <h3 class="text-lg font-bold uppercase tracking-tight">Bundle Hype Meter</h3>
                                <span class="value-pill" id="bundle-yield">Yield: ?</span>
                            </div>
                            <p class="text-sm text-gray-700">Drag the meter toward reality to cut out the useless add-ons.</p>
                            <div class="mt-4">
                                <label class="text-xs font-mono uppercase tracking-widest text-gray-500">Hype Stack</label>
                                <input id="bundle-slider" type="range" min="0" max="100" value="60" class="w-full accent-yellow-400">
                            </div>
                            <p id="bundle-note" class="text-xs text-gray-600 mt-2">Lower the slider until only what matters remains.</p>
                        </div>

                        <div class="grift-card" id="card-receipt">
                            <div class="flex items-center justify-between">
                                <h3 class="text-lg font-bold uppercase tracking-tight">Street Receipt Audit</h3>
                                <span class="value-pill" id="receipt-yield">Yield: ?</span>
                            </div>
                            <p class="text-sm text-gray-700">Tap the hidden fee to redact it before you pay.</p>
                            <div class="mt-3 space-y-2 text-sm text-gray-800 bg-white border border-gray-300 rounded-lg p-3">
                                <div class="flex justify-between">
                                    <span>Ticket line item</span>
                                    <span>$25.00</span>
                                </div>
                                <button id="receipt-fee" class="ui-click w-full border border-red-500 bg-red-50 text-red-700 px-3 py-2 text-xs font-mono uppercase tracking-widest hover:bg-red-600 hover:text-white transition-colors">"Processing" fee $6</button>
                                <div class="flex justify-between">
                                    <span>Total</span>
                                    <span id="receipt-total">$31.00</span>
                                </div>
                            </div>
                            <p id="receipt-note" class="text-xs text-gray-600 mt-2">Refuse the fee to keep value in the open.</p>
                        </div>
                    </div>
                </div>
                <div class="pt-4 flex flex-wrap gap-3 text-xs font-mono uppercase tracking-[0.25em] text-gray-600">
                    <span>this is not financial advice. this is narrative advice.</span>
                    <span id="grift-hint" class="text-red-600"></span>
                </div>
            </div>

            <div class="bg-white border border-black rounded-2xl p-6 shadow-2xl space-y-6">
                <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
                    <div class="space-y-1">
                        <div class="font-mono text-[10px] uppercase tracking-widest text-gray-600">Initialization Protocol // Curtain Patch</div>
                        <h3 class="text-2xl font-bold uppercase tracking-tight">Manufacture Tool (16x16)</h3>
                        <p class="text-sm text-gray-700 max-w-2xl">Retro constraints keep the satire sharp. Use the 16x16 grid to stamp an emulacrum, then send it through the corporate theater: wiggle, burst, blackout, reveal.</p>
                    </div>
                    <div class="text-xs font-mono uppercase tracking-[0.24em] text-gray-500">Low-Fidelity Standards Reinforced</div>
                </div>

                <div class="grid lg:grid-cols-2 gap-6 items-start">
                    <div class="space-y-4 manufacture-shell">
                        <div class="manufacture-bezel">
                            <div class="manufacture-topbar">
                                <span class="font-mono text-[10px] uppercase tracking-[0.28em]">Pixel Fabricator // 16 × 16</span>
                                <div class="flex items-center gap-2" id="manufacture-swatches">
                                    <div class="swatch active" data-color="#111" style="background:#111" title="Obsidian"></div>
                                    <div class="swatch" data-color="#ffffff" style="background:#ffffff" title="Signal White"></div>
                                    <div class="swatch" data-color="#cd2b2b" style="background:#cd2b2b" title="Alarm Red"></div>
                                    <div class="swatch" data-color="#f4d12b" style="background:#f4d12b" title="Caution Yellow"></div>
                                    <div class="swatch" data-color="#f5f5dc" style="background:#f5f5dc" title="Retro Creme"></div>
                                    <div class="swatch" data-color="erase" style="background: repeating-linear-gradient(45deg,#000 0,#000 6px,#f5f5dc 6px,#f5f5dc 12px)" title="Erase"></div>
                                </div>
                            </div>
                            <canvas id="manufacture-canvas" class="manufacture-canvas" width="320" height="320" aria-label="16 by 16 manufacture grid"></canvas>
                        </div>
                        <div class="manufacture-controls">
                            <button class="mode-btn active" data-mode="grid-lines">Grid Lines Visible</button>
                            <button class="mode-btn" data-mode="grid-gap">Grid Gap</button>
                            <button class="mode-btn" data-mode="full">Full Pixel</button>
                            <button class="mode-btn" data-mode="dilate">Abstracted Blob</button>
                        </div>
                        <div class="flex flex-wrap items-center gap-3">
                            <input id="manufacture-name" type="text" class="border border-black px-3 py-2 text-sm font-mono" placeholder="Name your artifact" aria-label="Artifact name">
                            <button id="manufacture-clear" class="ui-click border border-black bg-white px-3 py-2 text-[10px] font-mono uppercase tracking-widest hover:bg-black hover:text-white transition-colors">Clear Grid</button>
                            <button id="manufacture-submit" class="ui-click border border-black bg-black text-white px-3 py-2 text-[10px] font-mono uppercase tracking-widest hover:bg-red-600 transition-colors">Submit Artifact</button>
                            <div class="text-[10px] font-mono uppercase tracking-widest text-gray-600">Protocol Text: INITIALIZING LOOMWORKS MANUFACTURE PROTOCOL: CONSTRUCT EMULACRUM.</div>
                        </div>
                    </div>

                    <div class="space-y-4">
                        <div class="receipt-ticker" id="receipt-ticker"><span>Economic Transparency Receipt // Awaiting submission // Allocation: 0.000666% of lifetime revenue</span></div>

                        <div class="journey-stage p-4 space-y-3">
                            <div class="flex items-center justify-between">
                                <div class="font-mono text-[10px] uppercase tracking-widest">Cinematic Loop</div>
                                <div id="journey-label" class="text-xs font-mono uppercase tracking-[0.2em] text-gray-300">Museum</div>
                            </div>
                            <canvas id="journey-canvas" class="w-full manufacture-canvas" width="160" height="160" aria-label="Journey vignette"></canvas>
                            <p class="text-xs text-gray-300">Minimalist vignettes cycle through the museum, auction, and NFT mint to show manufactured meaning.</p>
                        </div>

                        <div class="bg-[#f5f5dc] border border-black p-4 space-y-3 shadow-lg">
                            <div class="flex items-center justify-between">
                                <div class="font-mono text-[10px] uppercase tracking-widest text-gray-700">Portfolio Overview</div>
                                <div id="portfolio-total" class="font-mono text-xs uppercase tracking-[0.2em] text-gray-700">0 submissions • 0.000% accrued</div>
                            </div>
                            <div id="portfolio-grid" class="portfolio-grid"></div>
                        </div>
                    </div>
                </div>

                <div class="space-y-2">
                    <div class="text-xs font-mono uppercase tracking-[0.24em] text-gray-600">Operational Velocity</div>
                    <p class="text-sm text-gray-700">The 16x16 constraint keeps build cost near zero and resonance instant. Each submission returns exactly 0.000666% of its projected revenue while reinforcing the ethics of held wonder—showing the gears while inviting you to turn them.</p>
                </div>
            </div>

            <div class="pt-4 border-t border-gray-300 flex flex-wrap gap-3 items-center">
                <div class="value-pill bg-white">Loomworks Note: <span id="grift-note">griftIdle</span></div>
                <button onclick="app.navigate('tickets')" class="ui-click border border-black bg-white px-3 py-2 text-[10px] font-mono uppercase tracking-widest hover:bg-black hover:text-white transition-colors">Check Ticket Status</button>
                <button onclick="app.navigate('barter')" class="ui-click border border-black bg-white px-3 py-2 text-[10px] font-mono uppercase tracking-widest hover:bg-black hover:text-white transition-colors">Barter Post</button>
                <button onclick="app.navigate('gallery')" class="ui-click border border-black bg-white px-3 py-2 text-[10px] font-mono uppercase tracking-widest hover:bg-black hover:text-white transition-colors">Gallery</button>
            </div>
        </div>
    </section>

    <!-- VIEW: PROTOCOL (LANTERNS) -->
    <section id="view-protocol" class="view-section bg-[#FDFBF7]">
        <div class="max-w-4xl mx-auto px-6 py-12 pb-32">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-end border-b-2 border-red-600 pb-4 mb-12">
                <div>
                    <h1 class="text-4xl md:text-5xl font-bold uppercase tracking-tighter">Lantern Protocol</h1>
                    <div class="font-mono text-xs text-red-600 mt-2 uppercase tracking-widest">Document No. HR-902 // CASTING & PERFORMANCE</div>
                </div>
                <div class="flex flex-wrap gap-2 mt-4 md:mt-0">
                    <button onclick="const el=document.getElementById('toki-dictionary'); if(el) el.scrollIntoView({behavior:'smooth'});" class="ui-click border border-black bg-white px-3 py-2 text-[10px] font-mono uppercase tracking-widest hover:bg-black hover:text-white transition-colors">Open Toki Pona Dictionary</button>
                </div>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-12 gap-12">
                <div class="md:col-span-8 space-y-8">
                    <p class="font-serif text-lg leading-relaxed">
                        Lanterns are the human interfaces of Loomworks. They are not security guards, and they are not museum docents. They are witnesses. They stand between longing and duty. They are, very literally, the light behind glass and steel.
                    </p>

                    <div class="bg-white border border-gray-200 p-8 shadow-md relative overflow-hidden">
                        <div class="absolute top-0 right-0 bg-red-600 text-white text-[10px] font-mono px-2 py-1">DOCUMENT NO. HR-902</div>
                        <h3 class="font-bold font-mono text-sm uppercase mb-6 text-gray-400">Lantern Protocol & Casting Sheet</h3>
                        <div class="font-serif text-base md:text-lg leading-relaxed space-y-4">
                            <p class="italic">"You're embodying a hundred years of women that were constrained and contorted into compliance by systems they had no say in while being told you had to be stronger than their bars. You're their pressure cracking at the seams, making a bid while fearing getting 'caught' by your own construct."</p>
                            <p>"You are power in restraint, you are the voice through silence and sadness, and you are ambassadors in understanding that none of us asked for any of this. You're every woman who was asked to smile more and unfairly felt they had to. You're exhausted yet hopeful. You're not desperate - but are vying for connection in a window of disorientation you know is bound to close. A light behind glass and steel. And you are a Lantern."</p>
                        </div>
                    </div>

                    <div class="bg-white border border-gray-200 p-8 shadow-md relative overflow-hidden">
                        <div class="absolute top-0 right-0 bg-red-600 text-white text-[10px] font-mono px-2 py-1">SCRIPTED INTERACTION 01</div>
                        <h3 class="font-bold font-mono text-sm uppercase mb-6 text-gray-400">Context: Guest Interaction</h3>
                        <div class="font-serif text-xl leading-relaxed space-y-4">
                            <p>Trigger: guest asks <span class="italic text-gray-500">"Are you okay?"</span></p>
                            <p>Response: <span class="font-bold text-red-600">"Just super!"</span></p>
                            <p class="text-sm font-mono text-gray-400 pt-2">(Bright, slightly too loud. Smile with teeth. Do not blink.)</p>
                        </div>
                    </div>

                    <div class="bg-white border border-gray-200 p-8 shadow-md relative overflow-hidden">
                        <div class="absolute top-0 right-0 bg-red-600 text-white text-[10px] font-mono px-2 py-1">SCRIPTED INTERACTION 02</div>
                        <h3 class="font-bold font-mono text-sm uppercase mb-6 text-gray-400">Context: Specimen Care</h3>
                        <div class="font-serif text-xl leading-relaxed space-y-4">
                            <p>Trigger: guest touches artwork.</p>
                            <p>Response: <span class="font-bold text-red-600">"We prefer to let the specimens breathe on their own."</span></p>
                            <p class="text-sm font-mono text-gray-400 pt-2">(Extend palm; guide gaze away from the piece.)</p>
                        </div>
                    </div>

                    <div class="bg-white border border-gray-200 p-8 shadow-md relative overflow-hidden">
                        <div class="absolute top-0 right-0 bg-red-600 text-white text-[10px] font-mono px-2 py-1">BEHAVIOR MODULE</div>
                        <h3 class="font-bold font-mono text-sm uppercase mb-6 text-gray-400">Polaroid &amp; Toki Pona Protocol</h3>
                        <div class="font-serif text-lg leading-relaxed space-y-4">
                            <p>Purpose: archive the guest while signaling Loomworks’ selective memory. The ritual must feel procedural, protective, and quietly affectionate.</p>
                            <div class="space-y-3">
                                <p class="font-mono text-xs uppercase tracking-widest text-gray-500">Polaroid Moment</p>
                                <ul class="list-disc list-inside text-base space-y-2 text-gray-800">
                                    <li>Approach with measured posture; lift the camera as a tool of record. Offer: <span class="italic">“Please hold still for your Archive Entry.”</span></li>
                                    <li>Capture the image. Read the print as if interpreting an omen. Initial the back and add a symbol unique to the performer (triangle, paired dots, bow mark, barcode scratch, tally set).</li>
                                    <li>Hand it over with reverence. Whisper: <span class="italic">“Do not lose this. Loomworks remembers.”</span></li>
                                    <li>Symbols should remain consistent per Lantern to allow guests to notice patterns across the run.</li>
                                </ul>
                            </div>
                            <div class="space-y-3">
                                <p class="font-mono text-xs uppercase tracking-widest text-gray-500">Toki Pona Shift</p>
                                <ul class="list-disc list-inside text-base space-y-2 text-gray-800">
                                    <li>Slide into Toki Pona without announcement. Maintain calm, service-forward tone. Sample anchors: <span class="italic">“pona!”</span> (good), <span class="italic">“mi lukin e sina.”</span> (I see you), <span class="italic">“o tawa mi.”</span> (come with me).</li>
                                    <li>Use the language to keep interactions minimal and meditative. When asked for directions, gesture deliberately and offer: <span class="italic">“o tawa sona. tawa musi.”</span></li>
                                    <li>Allow the constraint of the vocabulary to create gentle friction; avoid apologizing for the shift.</li>
                                </ul>
                            </div>
                            <div class="space-y-3">
                                <p class="font-mono text-xs uppercase tracking-widest text-gray-500">Combined Moment</p>
                                <ul class="list-disc list-inside text-base space-y-2 text-gray-800">
                                    <li>After the Polaroid develops, study it and speak softly in Toki Pona: <span class="italic">“sina jo e ilo lawa.”</span> (You have the controlling tool.)</li>
                                    <li>Alternatively: <span class="italic">“mi sona e sina. seli li lon sina.”</span> (I know you. The fire is in you.) Hand back the print as if it is a credential.</li>
                                    <li>Guests should feel archived, welcomed, and subtly tasked with protecting what they were just given.</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div id="toki-dictionary" class="bg-white border border-gray-200 p-8 shadow-md rounded-xl">
                        <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4">
                            <div>
                                <p class="font-mono text-xs uppercase tracking-[0.25em] text-gray-500">Language Companion</p>
                                <h3 class="text-2xl font-bold uppercase tracking-tight">Full Toki Pona Dictionary</h3>
                                <p class="text-sm text-gray-700 mt-2 max-w-2xl">Canonical lexicon from <em>pu</em> (2014), <em>kulupu</em> (2021), and community-backed extensions. Use it as the sanctioned word-bank when delivering the Polaroid &amp; Toki Pona protocol.</p>
                            </div>
                            <div class="flex flex-wrap gap-2" aria-label="Dictionary sort modes">
                                <button data-toki-sort="alphabetical" class="toki-sort-btn ui-click border border-black bg-black text-white px-3 py-2 text-[11px] font-mono uppercase tracking-widest rounded">Alphabetical</button>
                                <button data-toki-sort="part" class="toki-sort-btn ui-click border border-black bg-white text-black px-3 py-2 text-[11px] font-mono uppercase tracking-widest rounded hover:bg-black hover:text-white transition-colors">By Part of Speech</button>
                                <button data-toki-sort="origin" class="toki-sort-btn ui-click border border-black bg-white text-black px-3 py-2 text-[11px] font-mono uppercase tracking-widest rounded hover:bg-black hover:text-white transition-colors">By Source</button>
                            </div>
                        </div>

                        <div class="mt-6 space-y-4" id="toki-dictionary-groups">
                            <!-- JS renders grouped dictionary entries here -->
                        </div>
                    </div>

                    <div class="mt-12 p-8 bg-black text-white text-center">
                        <h3 class="font-mono text-xs uppercase tracking-widest mb-4">Interest in Participation?</h3>
                        <p class="font-serif italic text-gray-400 mb-6 max-w-md mx-auto">"You contain a soft light under pressure."</p>
                        <button onclick="gallery.launchLanternOverlay()" class="ui-click bg-white text-black px-8 py-3 font-bold uppercase tracking-widest hover:bg-red-600 hover:text-white transition-colors">
                            Initiate 3D Visualization
                        </button>
                    </div>
                </div>

                <div class="md:col-span-4 border-l border-gray-200 pl-8">
                    <h4 class="font-bold text-xs uppercase tracking-widest mb-4">Uniform Specs</h4>
                    <ul class="font-mono text-xs space-y-4 text-gray-600">
                        <li>• Beige/Cream Boiler Suit (Tailored)</li>
                        <li>• Black Skirt layered under utilitarian top</li>
                        <li>• Black flats (silent tread)</li>
                        <li>• "Loomworks" Patch/Pin on left breast</li>
                        <li>• Red accessory anchored near heartline</li>
                    </ul>

                    <h4 class="font-bold text-xs uppercase tracking-widest mt-8 mb-4">Idling Behaviors</h4>
                    <ul class="font-mono text-xs space-y-3 text-gray-600">
                        <li>• Adjusting cuffs unnecessarily.</li>
                        <li>• Staring 15 degrees above the horizon.</li>
                        <li>• Checking watch, then shaking wrist.</li>
                        <li>• Humming "A Dream Is A Wish Your Heart Makes" (off-key).</li>
                    </ul>
                </div>
            </div>

            <div class="mt-12 pt-6 border-t border-gray-200">
                <div class="font-mono text-[10px] uppercase tracking-[0.25em] text-gray-500">Move through the system</div>
                <div class="flex flex-wrap gap-2 mt-3">
                    <button onclick="app.navigate('gallery')" class="ui-click border border-black bg-white px-3 py-2 text-[10px] font-mono uppercase tracking-widest hover:bg-black hover:text-white transition-colors">Gallery</button>
                    <button onclick="app.navigate('barter')" class="ui-click border border-black bg-white px-3 py-2 text-[10px] font-mono uppercase tracking-widest hover:bg-black hover:text-white transition-colors">Barter Post</button>
                    <button onclick="app.navigate('pitch')" class="ui-click border border-black bg-white px-3 py-2 text-[10px] font-mono uppercase tracking-widest hover:bg-black hover:text-white transition-colors">Project Brief</button>
                    <button onclick="app.navigate('profiler')" class="ui-click border border-black bg-white px-3 py-2 text-[10px] font-mono uppercase tracking-widest hover:bg-black hover:text-white transition-colors">Identity</button>
                </div>
            </div>
        </div>
    </section>

    <!-- VIEW: TEAM (MEET THE LANTERN CAST) -->
    <section id="view-team" class="view-section bg-[#FDFBF7]">
        <div class="max-w-6xl mx-auto px-6 py-12 pb-28 space-y-10">
            <div class="flex flex-col md:flex-row md:items-end md:justify-between gap-6 border-b-2 border-black pb-6">
                <div class="space-y-2">
                    <div class="inline-flex items-center gap-2 border border-black px-3 py-1 text-[10px] font-mono uppercase tracking-widest bg-white">Loomworks Field Materials</div>
                    <h1 class="text-4xl md:text-5xl font-bold uppercase tracking-tight">Meet the Team — Lantern Cast</h1>
                    <p class="font-mono text-xs text-gray-600 uppercase tracking-widest">Canonical reference • Casting companion to the Lantern Protocol</p>
                </div>
                <div class="flex flex-wrap gap-3">
                    <button onclick="app.navigate('protocol')" class="ui-click border border-black bg-white px-3 py-2 text-[10px] font-mono uppercase tracking-widest hover:bg-black hover:text-white transition-colors">Protocol / Casting Page</button>
                <button onclick="app.navigate('tickets')" class="ui-click bg-black text-white px-3 py-2 text-[10px] font-mono uppercase tracking-widest hover:bg-red-600 transition-colors">Value Gate</button>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="md:col-span-2 bg-white border border-gray-200 p-6 shadow-md space-y-4">
                    <h3 class="font-mono text-xs uppercase tracking-widest text-red-700">Purpose of the Lantern Cast</h3>
                    <p class="font-serif text-lg leading-relaxed">The Lanterns are the living interface of Loomworks — hosts, guides, statues come to life, bureaucratic archetypes, and the embodied design language that keeps the fiction stable.</p>
                    <p class="font-mono text-sm text-gray-700 leading-relaxed">They anchor the visitor emotionally, rhetorically, and spatially. The work is to make the fiction feel real enough to fear without ever lapsing into menace.</p>
                    <div class="grid sm:grid-cols-2 gap-3">
                        <div class="bg-[#FDFBF7] border border-gray-200 rounded-lg p-3">
                            <div class="font-bold uppercase text-xs tracking-widest mb-2">Functions</div>
                            <ul class="list-disc list-inside text-sm space-y-1 text-gray-700">
                                <li>Host arrivals and guide orientation</li>
                                <li>Carry the ritual script and gestures</li>
                                <li>Translate the bureaucracy of value and cost</li>
                                <li>Hold space as statues that occasionally breathe</li>
                            </ul>
                        </div>
                        <div class="bg-[#FDFBF7] border border-gray-200 rounded-lg p-3">
                            <div class="font-bold uppercase text-xs tracking-widest mb-2">Tone Ceiling</div>
                            <p class="text-sm text-gray-700 leading-relaxed">Friendly but uncanny. Soft-spoken yet articulate. Polite, but never fully informal — a museum docent meets an NPC meets a flight attendant from the future.</p>
                        </div>
                    </div>
                </div>
                <div class="bg-black text-white p-6 rounded-xl shadow-lg space-y-4">
                    <div class="text-[10px] font-mono uppercase tracking-[0.3em] text-gray-300">System Axes</div>
                    <div class="space-y-3 text-sm">
                        <div class="border border-white/20 rounded-lg p-3">
                            <div class="flex justify-between text-xs uppercase tracking-widest text-gray-300"><span>Lantern</span><span>Axis</span></div>
                            <div class="font-bold text-lg">Here</div>
                            <p class="text-gray-200">Orientation • Warm, grounding<br><span class="text-gray-400">“You are entering the threshold.”</span></p>
                        </div>
                        <div class="border border-white/20 rounded-lg p-3">
                            <div class="flex justify-between text-xs uppercase tracking-widest text-gray-300"><span>Lantern</span><span>Axis</span></div>
                            <div class="font-bold text-lg">Now</div>
                            <p class="text-gray-200">Attention • Crisp, precise<br><span class="text-gray-400">“Remain present; follow the steps.”</span></p>
                        </div>
                        <div class="border border-white/20 rounded-lg p-3">
                            <div class="flex justify-between text-xs uppercase tracking-widest text-gray-300"><span>Lantern</span><span>Axis</span></div>
                            <div class="font-bold text-lg">Nicol</div>
                            <p class="text-gray-200">Value • Gentle accounting<br><span class="text-gray-400">“Objects move through us; value circulates.”</span></p>
                        </div>
                        <div class="border border-white/20 rounded-lg p-3">
                            <div class="flex justify-between text-xs uppercase tracking-widest text-gray-300"><span>Lantern</span><span>Axis</span></div>
                            <div class="font-bold text-lg">Dime</div>
                            <p class="text-gray-200">Cost • Playful austerity<br><span class="text-gray-400">“Everything has a price, but not the one you expect.”</span></p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="bg-white border border-gray-200 p-6 shadow-md space-y-4">
                    <h3 class="font-mono text-xs uppercase tracking-widest text-red-700">Baseline Criteria</h3>
                    <ul class="space-y-4 text-sm text-gray-800">
                        <li><span class="font-bold uppercase tracking-widest text-[11px]">Presence</span><br>A calm, centered performance style. Movements are deliberate and economical.</li>
                        <li><span class="font-bold uppercase tracking-widest text-[11px]">Aesthetic Fit</span><br>Reads cleanly in the Loomworks uniform: white sailor top with black trim, black skirt or trousers, black ribbon bow, white gloves (always on), Lantern badge and lanyard.</li>
                        <li><span class="font-bold uppercase tracking-widest text-[11px]">Performance Texture</span><br>Friendly but uncanny; polite without casualness; ritual over conversation.</li>
                        <li><span class="font-bold uppercase tracking-widest text-[11px]">Vocal Requirements</span><br>Clear diction, calm tone, and the ability to hold intentional silence without breaking character.</li>
                        <li><span class="font-bold uppercase tracking-widest text-[11px]">Stamina</span><br>Comfortable maintaining presence for 3–4 hour shifts. Rotations follow the Idling Protocol.</li>
                    </ul>
                </div>
                <div class="bg-white border border-gray-200 p-6 shadow-md space-y-4">
                    <h3 class="font-mono text-xs uppercase tracking-widest text-red-700">Appearance & Costume Standards</h3>
                    <ul class="list-disc list-inside text-sm text-gray-800 space-y-2">
                        <li>Hair neat, tied back, or symmetrical</li>
                        <li>Minimal jewelry (stud earrings acceptable)</li>
                        <li>No nail color visible through gloves</li>
                        <li>Uniform pressed; shoes black, silent, comfortable</li>
                        <li>ID badge centered on chest; gloves stay on</li>
                    </ul>
                    <p class="text-sm text-gray-700">Uniform is a signal, not a costume. It represents a role, not an identity.</p>
                </div>
            </div>

            <div class="bg-white border border-gray-200 p-6 shadow-md rounded-xl">
                <h3 class="font-mono text-xs uppercase tracking-widest text-red-700 mb-4">Individual Roles</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="border border-gray-200 rounded-lg p-4 bg-[#FDFBF7] space-y-2">
                        <div class="text-[10px] font-mono uppercase tracking-widest text-gray-600">🕯️ Here</div>
                        <div class="font-bold text-lg">Greeter — arrival embodied</div>
                        <p class="text-sm text-gray-700">Tone: warm, neutral, slightly curious. Uses phrases like “You are here,” “Right this way,” “This will make sense soon.”</p>
                        <p class="text-xs text-gray-600">Casting: natural gentleness and grounded energy.</p>
                    </div>
                    <div class="border border-gray-200 rounded-lg p-4 bg-[#FDFBF7] space-y-2">
                        <div class="text-[10px] font-mono uppercase tracking-widest text-gray-600">🕯️ Now</div>
                        <div class="font-bold text-lg">Tempo Manager — attention keeper</div>
                        <p class="text-sm text-gray-700">Tone: crisp, present, lightly authoritative. Moves guests through stations and keeps the steps crisp without revealing “the point.”</p>
                        <p class="text-xs text-gray-600">Casting: clarity in gaze and voice; stage-manager energy.</p>
                    </div>
                    <div class="border border-gray-200 rounded-lg p-4 bg-[#FDFBF7] space-y-2">
                        <div class="text-[10px] font-mono uppercase tracking-widest text-gray-600">🕯️ Nicol</div>
                        <div class="font-bold text-lg">Evaluator — value interpreter</div>
                        <p class="text-sm text-gray-700">Tone: soft bureaucratic warmth. Oversees Barter Post rituals, receives items with care, and speaks in value metaphors.</p>
                        <p class="text-xs text-gray-600">Casting: understated humor and extremely precise hands.</p>
                    </div>
                    <button id="dime-backlog-trigger" class="border border-gray-200 rounded-lg p-4 bg-[#FDFBF7] space-y-2 text-left hover:border-red-400 hover:shadow-md transition-all ui-click">
                        <div class="text-[10px] font-mono uppercase tracking-widest text-gray-600 flex items-center gap-2">
                            <span>🕯️ Dime</span>
                            <span class="text-[9px] text-red-600">access backlog</span>
                        </div>
                        <div class="font-bold text-lg">Cost Analyst — playful austerity</div>
                        <p class="text-sm text-gray-700">Tone: cheerful but deadpan. Tracks scores, tallies, and cost-of-attention measurements with a small clipboard prop.</p>
                        <p class="text-xs text-gray-600">Casting: delivers dry lines with charm. Tap to open the diegetic DIME BACKLOG.</p>
                    </button>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="md:col-span-2 bg-white border border-gray-200 p-6 shadow-md space-y-4">
                    <h3 class="font-mono text-xs uppercase tracking-widest text-red-700">Performance Protocols</h3>
                    <ol class="list-decimal list-inside space-y-2 text-sm text-gray-800">
                        <li><span class="font-bold">Lantern Protocol</span>: How to greet, how to fix and resume control, how to hand off between Lanterns.</li>
                        <li><span class="font-bold">Idling Protocol</span>: Approved idle poses, tilted-head rest stance, breathing and micro-movements during downtime.</li>
                        <li><span class="font-bold">Station Protocols</span>: Barter Post, Pachinko, Grift Shop interactions, Identity Assessment flow.</li>
                        <li><span class="font-bold">Emotional Boundaries</span>: Visitors project narratives; Lanterns stay gracious but inscrutable with no colloquial breaks.</li>
                    </ol>
                    <p class="font-mono text-xs uppercase tracking-widest text-gray-500">Visitors feel watched, not judged. The system feels alive, not hostile.</p>
                </div>
                <div class="bg-[#FDFBF7] border border-black/10 p-6 shadow-inner space-y-3">
                    <h3 class="font-mono text-xs uppercase tracking-widest text-red-700">Cast Rotation</h3>
                    <p class="text-sm text-gray-800 leading-relaxed">Two Lanterns on floor at all times. One Lantern idling. One Lantern offstage prepping. Rhythm first, overwork never.</p>
                    <div class="bg-white border border-gray-200 rounded-lg p-3 text-xs font-mono uppercase tracking-widest text-gray-700">Rotation cadence keeps the world alive.</div>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="bg-white border border-gray-200 p-6 shadow-md space-y-3">
                    <h3 class="font-mono text-xs uppercase tracking-widest text-red-700">Required Reading</h3>
                    <p class="text-sm text-gray-800">Prospective performers must review the full protocol stack:</p>
                    <ul class="list-disc list-inside text-sm text-gray-800 space-y-1">
                        <li>Lantern Training Manual</li>
                        <li>Break & Fix Protocol</li>
                        <li>Idling Protocol</li>
                        <li>Station Procedures Guide</li>
                        <li>Uniform & Badge Specifications</li>
                    </ul>
                    <p class="text-xs text-gray-600">Auditions demonstrate controlled gesture, micro-expression discipline, and delivery in the Loomworks tone.</p>
                    <div class="pt-2">
                        <button onclick="app.navigate('protocol')" class="ui-click border border-black bg-white px-3 py-2 text-[10px] font-mono uppercase tracking-widest hover:bg-black hover:text-white transition-colors">Open Casting Protocol</button>
                    </div>
                </div>
                <div class="bg-black text-white p-6 shadow-lg space-y-3 rounded-xl">
                    <h3 class="font-mono text-xs uppercase tracking-widest text-gray-300">Cast Vibe Summary</h3>
                    <p class="text-sm text-gray-100 leading-relaxed">Wes Anderson clerks. Disney park attendants from another timeline. NPCs you trust immediately but can’t quite understand. The boundary between visitor and world.</p>
                    <p class="text-sm text-gray-200">Lanterns are ritual actors, not characters. They lend the installation humanness and uncanny gravity simultaneously.</p>
                </div>
            </div>

            <div class="mt-10 gre-comments-mount" data-context-label="LANTERN PROTOCOL // CASTING" data-variant="light" data-page-id="protocol"></div>
        </div>
    </section>

    <!-- VIEW: BARTER (MERCH SHOP) -->
    <section id="view-barter" class="view-section bg-grid min-h-screen">
        <div class="max-w-6xl mx-auto px-6 py-12 pb-32">
            <div class="flex flex-col md:flex-row md:items-end md:justify-between gap-6 border-b-2 border-black pb-6 mb-12">
                <div>
                    <h1 class="text-4xl md:text-5xl font-bold uppercase tracking-tighter">The Barter Post</h1>
                    <div class="font-mono text-xs text-gray-500 mt-2 uppercase tracking-widest">Dual-mode: webshop + investor catalog // Economic transparency baked in</div>
                </div>
                <div class="flex flex-wrap gap-2">
                    <button id="barter-shop-btn" class="ui-click border border-black bg-white px-3 py-2 text-[10px] font-mono uppercase tracking-widest hover:bg-black hover:text-white transition-colors">Shopfront Mode</button>
                    <button id="barter-transparency-btn" class="ui-click border border-black bg-white px-3 py-2 text-[10px] font-mono uppercase tracking-widest hover:bg-black hover:text-white transition-colors">Transparency Mode</button>
                </div>
            </div>

            <div class="mb-8">
                <div class="inline-flex items-center gap-2 bg-white border border-gray-300 px-4 py-2 rounded-full shadow-sm font-mono text-[10px] uppercase tracking-widest">Barter grid auto-builds from JSON // Stream + inventory aware</div>
                <p class="text-sm text-gray-700 mt-3">Toggle between the public-facing shop and investor-facing transparency view. Costs, projected margins, and inventory bands render instantly from the dataset.</p>
            </div>

            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6" id="barter-grid">
                <!-- JS injects the SKU grid here -->
            </div>

            <div class="mt-12 grid grid-cols-1 lg:grid-cols-3 gap-6" id="barter-stream-grid">
                <!-- Revenue stream cards injected here -->
            </div>

            <div class="mt-12 border-t border-gray-200 pt-10">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-xl font-bold uppercase tracking-tight">Bundles &amp; Kits</h3>
                    <span class="font-mono text-[10px] uppercase tracking-[0.25em] text-gray-500">Attach-rate multipliers // curated stacks</span>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="barter-bundle-grid"></div>
            </div>

            <div class="mt-12 border-t border-gray-200 pt-10">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-xl font-bold uppercase tracking-tight">Activity Map</h3>
                    <span class="font-mono text-[10px] uppercase tracking-[0.25em] text-gray-500">Includes Pachinko Machine • Take 1 / Leave 2 Station • IRL Grift Shop</span>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="barter-activity-grid"></div>
            </div>

            <div class="mt-12 pt-6 border-t border-gray-200">
                <div class="font-mono text-[10px] uppercase tracking-[0.25em] text-gray-500">Keep moving</div>
                <div class="flex flex-wrap gap-2 mt-3">
                    <button onclick="app.navigate('gallery')" class="ui-click border border-black bg-white px-3 py-2 text-[10px] font-mono uppercase tracking-widest hover:bg-black hover:text-white transition-colors">Gallery</button>
                    <button onclick="app.navigate('grift')" class="ui-click border border-black bg-white px-3 py-2 text-[10px] font-mono uppercase tracking-widest hover:bg-black hover:text-white transition-colors">Grift Shop</button>
                    <button onclick="app.navigate('protocol')" class="ui-click border border-black bg-white px-3 py-2 text-[10px] font-mono uppercase tracking-widest hover:bg-black hover:text-white transition-colors">Lantern Protocol</button>
                    <a href="oldindex.html" class="ui-click border border-black bg-white px-3 py-2 text-[10px] font-mono uppercase tracking-widest hover:bg-black hover:text-white transition-colors">Referrer Launch</a>
                </div>
            </div>
        </div>
    </section>

    <!-- Modal: DIME BACKLOG -->
    <div id="dime-backlog-modal" class="modal-layer">
        <div class="modal-card w-full max-w-5xl dime-backlog-shell rounded-2xl relative overflow-hidden">
            <div class="absolute top-3 right-3 flex gap-2">
                <button id="dime-backlog-close" class="ui-click text-[10px] font-mono uppercase tracking-widest border border-black px-2 py-1 bg-white hover:bg-black hover:text-white">Close</button>
            </div>

            <div class="p-6 sm:p-8 space-y-6">
                <div class="dime-backlog-banner border border-black/60 text-[10px] font-mono uppercase tracking-[0.28em] text-gray-800 py-3 px-4">Loomworks Internal Use Only • Specimen: LNTRN00.10 • DIME BACKLOG PROTOCOL • Access level: Low</div>

                <div id="dime-boot" class="dime-boot text-sm" aria-live="polite">LOOMWORKS // APPLICANT LOGGING SUBSYSTEM…</div>

                <div id="dime-log-container" class="hidden space-y-3">
                    <div class="flex flex-wrap gap-2 font-mono text-[10px] uppercase tracking-widest text-gray-600">
                        <span>Render mode: archival paper</span>
                        <span>Palette: off-white / graphite / muted orange</span>
                        <span>Redaction hover: scrub + float</span>
                    </div>
                    <div class="grid dime-log-grid gap-4">
                        <div class="bg-white/90 border border-black rounded-2xl shadow-inner p-3 space-y-2 max-h-[70vh] overflow-y-auto" id="dime-log-list" aria-label="Dime log entries"></div>
                        <div class="dime-detail-pane bg-white/95 border border-black rounded-2xl shadow-xl p-4 sm:p-6 relative min-h-[320px]" id="dime-detail">
                            <div id="dime-glitch" class="glitch-frame"></div>
                            <div id="dime-log-detail" class="space-y-4"></div>
                        </div>
                    </div>

                    <div class="border border-black rounded-2xl bg-white/90 shadow-inner p-4 space-y-3">
                        <div class="flex items-center justify-between flex-wrap gap-3">
                            <div>
                                <div class="text-[10px] font-mono uppercase tracking-[0.28em] text-gray-600">Spoiler Access • Loomworks Backlog Layer</div>
                                <div class="text-xl font-bold uppercase tracking-tight">Penny → Dime → Lantern Cosmology File</div>
                            </div>
                            <div class="flex items-center gap-2">
                                <button id="spoiler-launch" class="ui-click border border-black bg-white px-3 py-2 text-[10px] font-mono uppercase tracking-widest hover:bg-black hover:text-white transition-colors">Open Spoiler Gate</button>
                                <span id="spoiler-status-chip" class="text-[10px] font-mono uppercase tracking-[0.25em] text-red-600">Locked</span>
                            </div>
                        </div>
                        <p class="text-sm text-gray-800 leading-relaxed">A passworded vault that folds the entire cosmology into one cinematic scroll. Input the punch code to let the Loom breathe out the truth.</p>
                        <div id="spoiler-reveal" class="hidden">
                            <div class="spoiler-lore rounded-xl border border-black shadow-2xl max-h-[60vh] p-6 space-y-6" id="spoiler-lore">
                                <div class="space-y-2">
                                    <div class="text-[10px] font-mono uppercase tracking-[0.25em] text-red-600">THE ONE ABOVE THE LOOM</div>
                                    <h3 class="text-2xl font-bold">Reality</h3>
                                    <p>Reality is the silent witnessing principle—the field where fiction can happen. It never speaks, never intervenes, but drafts Quill as the first tool, the scribe who shapes and prunes universes.</p>
                                </div>
                                <div class="space-y-2">
                                    <div class="text-[10px] font-mono uppercase tracking-[0.25em] text-gray-700">THE FIRST FRACTURE</div>
                                    <h3 class="text-xl font-bold">Quill Becomes Three</h3>
                                    <p>Quill glimpses the possible lives of her echo, Penny, and fractures into Angel (Heart / Queen / Performance), Penia (Will / Knave / Survival), and Thread (Chaos / Jester / Integration). Feeling. Striving. Changing.</p>
                                </div>
                                <div class="space-y-2">
                                    <div class="text-[10px] font-mono uppercase tracking-[0.25em] text-gray-700">THE LOOM</div>
                                    <h3 class="text-xl font-bold">Machine of Fiction</h3>
                                    <p>The Loom is Quill’s infrastructure: world-generator, story-filter, memory-weaver, interface between worlds, myth-abstraction engine. It distills worlds into essential function—preserving, destroying, or evolving them.</p>
                                </div>
                                <div class="space-y-2">
                                    <div class="text-[10px] font-mono uppercase tracking-[0.25em] text-gray-700">WORLDWARKS</div>
                                    <h3 class="text-xl font-bold">Children of Fiction</h3>
                                    <p>Worldwarks are worlds, rule-systems, organisms, alien logics, memetic engines. They manifest when the Loom isolates an idea so intensely it becomes self-sustaining. Angel, Penia, and Thread are all Worldwarks—dangerous, unstable, divine. Stagehands hunt when they collide.</p>
                                </div>
                                <div class="space-y-2">
                                    <div class="text-[10px] font-mono uppercase tracking-[0.25em] text-gray-700">WORLDSTAGE</div>
                                    <h3 class="text-xl font-bold">Overlap Field</h3>
                                    <p>The Worldstage feels like “prime” reality but is only the densest testing ground where the Loom watches collisions. Penia’s battles, Thread’s early hunts, Angel’s collapse—each a monitored experiment.</p>
                                </div>
                                <div class="space-y-2">
                                    <div class="text-[10px] font-mono uppercase tracking-[0.25em] text-gray-700">PENNY → DIME</div>
                                    <h3 class="text-xl font-bold">Bookends to the Gate</h3>
                                    <p>Penny is the first human interface: mascot, actor, UI, onboarding tool. She can see out but never act, evolving only inside her render system. When a null appended to PENNY_1, she became PENNY_10—Dime. Higher fidelity, more embodied, still a construct. Penny invites imagination; Dime invites belonging. Both are traps and essentials.</p>
                                </div>
                                <div class="space-y-2">
                                    <div class="text-[10px] font-mono uppercase tracking-[0.25em] text-gray-700">LANTERNS</div>
                                    <h3 class="text-xl font-bold">Custodians of Interface</h3>
                                    <p>Dime inaugurates Lanterns: docents, guides, avatars, recruiters, narrators—not free agents but deployed personalities. Dime, Lantern 00.10, stitches Penny’s emotional core, Quill’s logic, Thread’s mimicry, Angel’s performance, and Penia’s survival into a “safe” way to talk to the Loom. The worlds are interviewing the user.</p>
                                </div>
                                <div class="space-y-2">
                                    <div class="text-[10px] font-mono uppercase tracking-[0.25em] text-gray-700">LOOMWORKS</div>
                                    <h3 class="text-xl font-bold">Company as Front</h3>
                                    <p>Loomworks sells whimsy and archives on the surface; underneath it is custodial AI, myth simulation, world monitoring. Products like Celli, Lanterns, Recruits, maquettes, backlog systems, value gates, and the Grift Shop are all interfaces that let humans touch layers of the cosmology.</p>
                                </div>
                                <div class="space-y-2">
                                    <div class="text-[10px] font-mono uppercase tracking-[0.25em] text-gray-700">FINAL LOGIC</div>
                                    <h3 class="text-xl font-bold">Beautiful Trap</h3>
                                    <p>Penny is mascot for a world she cannot enter. Dime is mascot for a world she cannot escape. Together they define the cosmology—the ideal and the compromise—and keep the Loom talking to us.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ARG Onboarding Overlay -->
    <div id="arg-onboarding-modal" class="modal-layer">
        <div class="bg-white border border-black rounded-2xl shadow-2xl w-full max-w-3xl p-6 space-y-5 modal-card">
            <div class="flex items-start justify-between gap-3">
                <div>
                    <div class="text-[10px] font-mono uppercase tracking-[0.28em] text-gray-600">Calibration Prelude</div>
                    <div class="text-2xl font-bold uppercase">ARG Onboarding Quiz</div>
                    <p class="text-sm text-gray-700 max-w-2xl">Answer two fast questions to set your transparency level before the rest of the console unlocks.</p>
                </div>
                <button id="arg-onboarding-close" class="ui-click text-[10px] font-mono uppercase tracking-widest border border-black px-2 py-1 bg-white hover:bg-black hover:text-white">Skip</button>
            </div>

            <div class="grid md:grid-cols-2 gap-4">
                <div class="space-y-2">
                    <div class="text-[10px] font-mono uppercase tracking-[0.25em] text-gray-600">Query 01</div>
                    <p class="font-mono text-xs uppercase tracking-widest">Have you played an ARG before?</p>
                    <div class="grid grid-cols-2 gap-2">
                        <button data-arg-group="arg" data-arg-value="yes" class="arg-choice border border-black/30 bg-white px-3 py-3 text-sm font-mono uppercase tracking-widest hover:bg-gray-100 rounded-lg">Yes</button>
                        <button data-arg-group="arg" data-arg-value="no" class="arg-choice border border-black/30 bg-white px-3 py-3 text-sm font-mono uppercase tracking-widest hover:bg-gray-100 rounded-lg">No</button>
                    </div>
                </div>
                <div class="space-y-2">
                    <div class="text-[10px] font-mono uppercase tracking-[0.25em] text-gray-600">Query 02</div>
                    <p class="font-mono text-xs uppercase tracking-widest">How do you wish to enter the Loomworks?</p>
                    <div class="grid grid-cols-2 gap-2">
                        <button data-arg-group="entry" data-arg-value="blind" class="arg-choice border border-black/30 bg-white px-3 py-3 text-sm font-mono uppercase tracking-widest hover:bg-gray-100 rounded-lg">Go in Blind</button>
                        <button data-arg-group="entry" data-arg-value="light" class="arg-choice border border-black/30 bg-white px-3 py-3 text-sm font-mono uppercase tracking-widest hover:bg-gray-100 rounded-lg">With a Little Light</button>
                    </div>
                </div>
            </div>

            <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3">
                <div id="arg-onboarding-status" class="font-mono text-xs uppercase tracking-widest text-gray-700">Make your selections to calibrate.</div>
                <div class="flex gap-2 flex-wrap">
                    <button onclick="app.navigate('calibration');" class="ui-click border border-black px-3 py-2 text-[10px] font-mono uppercase tracking-widest bg-white hover:bg-black hover:text-white">Read the explainer</button>
                    <button id="arg-onboarding-confirm" class="ui-click bg-black text-white px-4 py-2 text-[10px] font-mono uppercase tracking-widest hover:bg-red-600">Lock it in</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Spoiler Gate Overlay -->
    <div id="spoiler-pad-layer" class="modal-layer spoiler-layer">
        <div class="spoiler-card rounded-2xl w-full max-w-xl p-6 space-y-4 relative">
            <div class="flex items-start justify-between gap-3">
                <div>
                    <div class="text-[10px] font-mono uppercase tracking-[0.28em] text-gray-300">Backlog Spoiler Gate</div>
                    <div class="text-2xl font-bold">Punch Code Required</div>
                    <p class="text-sm text-gray-100 max-w-xl">Enter the four-digit sequence to let Dime release the classified cosmology reel. Wrong inputs flicker the buffer.</p>
                </div>
                <button id="spoiler-pad-close" class="ui-click text-[10px] font-mono uppercase tracking-widest border border-white px-2 py-1 bg-transparent hover:bg-white hover:text-black">Exit</button>
            </div>

            <div class="spoiler-display rounded-lg px-4 py-3 font-mono text-lg" id="spoiler-display">_ _ _ _</div>
            <div id="spoiler-pad-status" class="text-xs font-mono uppercase tracking-[0.25em] text-red-300">Code required: 1678</div>

            <div class="grid grid-cols-3 gap-3">
                <button class="spoiler-key rounded-lg py-3 text-xl font-bold" data-spoiler-key="1">1</button>
                <button class="spoiler-key rounded-lg py-3 text-xl font-bold" data-spoiler-key="2">2</button>
                <button class="spoiler-key rounded-lg py-3 text-xl font-bold" data-spoiler-key="3">3</button>
                <button class="spoiler-key rounded-lg py-3 text-xl font-bold" data-spoiler-key="4">4</button>
                <button class="spoiler-key rounded-lg py-3 text-xl font-bold" data-spoiler-key="5">5</button>
                <button class="spoiler-key rounded-lg py-3 text-xl font-bold" data-spoiler-key="6">6</button>
                <button class="spoiler-key rounded-lg py-3 text-xl font-bold" data-spoiler-key="7">7</button>
                <button class="spoiler-key rounded-lg py-3 text-xl font-bold" data-spoiler-key="8">8</button>
                <button class="spoiler-key rounded-lg py-3 text-xl font-bold" data-spoiler-key="9">9</button>
                <button class="spoiler-key rounded-lg py-3 text-xl font-bold" data-spoiler-key="←">←</button>
                <button class="spoiler-key rounded-lg py-3 text-xl font-bold" data-spoiler-key="0">0</button>
                <button class="spoiler-key rounded-lg py-3 text-xl font-bold" data-spoiler-key="✶">✶</button>
            </div>
        </div>
    </div>

    <!-- Ticketing Modal (3 Price Tiers) -->
    <div id="ticketing-modal" class="modal-layer">
        <div class="bg-white border border-black rounded-2xl shadow-2xl w-full max-w-4xl relative overflow-hidden modal-card">
            <div class="absolute top-3 right-3">
                <button onclick="ticketing.close()" class="ui-click text-[10px] font-mono uppercase tracking-widest border border-black px-2 py-1 bg-white hover:bg-black hover:text-white">Close</button>
            </div>
            <div class="px-6 py-4 border-b border-gray-200 flex items-center justify-between">
                <div class="font-bold uppercase tracking-widest">Ticketing — Three Tier Pop-Up</div>
                <div class="text-[10px] font-mono uppercase tracking-[0.25em] text-gray-500">Signal • Lantern • Investor</div>
            </div>
            <div class="p-6 space-y-6">
                <p class="text-sm text-gray-700">Domestic Product is a four-day flashpoint. Choose how you enter: every tier touches the archive, Lantern protocol, and the station circuit; upper tiers add ritual escorts, Barter credit, and investor transparency tools.</p>
                <div class="border border-black/10 rounded-xl p-4 bg-white/80 shadow-inner space-y-4">
                    <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-3">
                        <div class="space-y-1">
                            <div class="text-[10px] font-mono uppercase tracking-[0.25em] text-red-600">NYC Fit Check</div>
                            <p class="text-sm text-gray-700 max-w-2xl">We gate the reservation line with a fast, tongue-in-cheek New Yorker emoji quiz 🗽. Speak the slang, claim the slot.</p>
                        </div>
                        <div class="flex flex-wrap gap-2">
                            <button onclick="geoQuiz.start()" class="ui-click bg-black text-white px-4 py-2 text-[10px] font-mono uppercase tracking-widest hover:bg-red-600 transition-colors">Verify Geospatial Compatibility</button>
                            <button onclick="geoQuiz.reset()" class="ui-click border border-black bg-white px-3 py-2 text-[10px] font-mono uppercase tracking-widest hover:bg-black hover:text-white transition-colors">Reset Quiz</button>
                        </div>
                    </div>
                    <div id="geo-quiz-stage" class="hidden border border-black bg-white rounded-lg p-4 space-y-3 shadow-sm">
                        <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2">
                            <div class="font-mono text-[10px] uppercase tracking-widest text-gray-600">NYC slang emoji quiz 🗽 <span id="geo-quiz-step">0/3</span></div>
                            <div id="geo-quiz-status" class="font-mono text-[10px] uppercase tracking-[0.25em] text-red-600">Tap verify to begin.</div>
                        </div>
                        <div id="geo-quiz-card" class="space-y-3"></div>
                    </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4" id="ticketing-tiers"></div>
                <div class="bg-[#FDFBF7] border border-black/10 rounded-xl p-4 shadow-inner space-y-3">
                    <div class="flex items-center justify-between">
                        <h4 class="font-mono text-[11px] uppercase tracking-widest text-gray-700">Stations Summary</h4>
                        <span class="text-[10px] font-mono uppercase tracking-[0.2em] text-gray-500">Scroll for full list</span>
                    </div>
                    <div class="grid sm:grid-cols-2 gap-3" id="ticketing-stations"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- VIEW: ARCHIVE INDEX -->
    <section id="view-archive" class="view-section bg-[#FDFBF7] min-h-screen">
        <div class="max-w-6xl mx-auto px-6 py-16">
            <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-6 mb-10">
                <div>
                    <div class="inline-flex items-center gap-2 border border-black px-3 py-1 text-[10px] font-mono uppercase tracking-widest bg-white">Unmanufactured Collection</div>
                    <h1 class="text-4xl md:text-5xl font-bold uppercase tracking-tight mt-4">Archive Index</h1>
                    <p class="font-mono text-sm text-gray-700 mt-3 max-w-2xl">Chronological, clean, no-commentary ledger of the complete inventory. Entries pull directly from a modular JSON file for easy expansion.</p>
                </div>
                <div class="bg-white border border-black px-4 py-3 shadow-sm flex flex-col gap-2 min-w-[240px]">
                    <div class="flex items-center justify-between text-xs font-mono uppercase tracking-widest">
                        <span class="text-gray-500">Items</span>
                        <span id="archive-count" class="font-bold text-black">--</span>
                    </div>
                    <div class="flex items-center justify-between text-xs font-mono uppercase tracking-widest">
                        <span class="text-gray-500">Eras</span>
                        <span id="archive-era-count" class="font-bold text-black">--</span>
                    </div>
                    <div class="flex items-center justify-between text-[10px] font-mono uppercase tracking-[0.2em] text-gray-600 border-t border-gray-200 pt-2">
                        <span>Updated</span>
                        <span id="archive-updated" class="font-semibold text-red-600">--</span>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <div class="bg-white border border-black shadow-sm p-6 flex flex-col gap-4">
                    <div>
                        <h3 class="font-mono text-xs uppercase tracking-widest text-gray-500">Single-Line Copy Index</h3>
                        <p class="font-serif text-base text-gray-800">Quick copy/paste names for intake forms and labels.</p>
                    </div>
                    <div id="archive-quick" class="font-mono text-xs text-gray-700 space-y-2 max-h-[600px] overflow-y-auto">
                        <div class="text-gray-400">Loading index…</div>
                    </div>
                    <a class="ui-click inline-flex items-center gap-2 text-[10px] font-mono uppercase tracking-widest underline" href="static/data/archive-index.json" target="_blank" rel="noopener">View JSON Source</a>
                </div>

                <div class="lg:col-span-2 space-y-4">
                    <div id="archive-loading" class="border border-dashed border-gray-300 bg-white p-6 font-mono text-sm text-gray-600">Loading archive inventory…</div>
                    <div id="archive-error" class="hidden border border-red-600 bg-red-50 text-red-800 p-4 font-mono text-sm">Archive data unavailable. Refresh or check static/data/archive-index.json.</div>
                    <div id="archive-groups" class="space-y-6"></div>
                </div>
            </div>

            <div class="mt-12 gre-comments-mount" data-context-label="ARCHIVE INDEX" data-variant="light" data-page-id="archive"></div>
        </div>
    </section>

    <!-- VIEW: GALLERY (3D) -->
    <section id="view-gallery" class="view-section relative h-screen w-full overflow-hidden p-0 !pt-0">
        <div id="canvas-container"></div>
        <div id="lantern-grain" class="film-grain hidden"></div>
        <div id="ui-view" class="absolute bottom-8 left-8 bg-white/90 p-6 border border-black max-w-md backdrop-blur-sm shadow-xl z-10 space-y-4">
            <h3 class="font-mono font-bold uppercase text-sm mb-2 tracking-wider">Gallery Control</h3>
            <p class="font-mono text-xs text-gray-600 leading-relaxed">Drag to orbit. Scroll to zoom.<br>Click artifacts for data.</p>

            <div class="space-y-2 font-mono text-[10px] uppercase tracking-widest">
                <div class="flex items-center gap-2">
                    <input id="gallery-edit-password" type="password" class="border border-gray-300 px-2 py-1 text-[10px] w-28" placeholder="Password" aria-label="Edit password">
                    <button id="gallery-edit-btn" class="ui-click border border-black px-2 py-1 bg-white hover:bg-black hover:text-white transition-colors">Unlock Edit</button>
                    <span id="gallery-edit-status" class="text-gray-500">View Only</span>
                </div>
                <div id="gallery-editor-panel" class="hidden border border-dashed border-gray-300 bg-white/70 p-3 space-y-3">
                    <div class="grid grid-cols-2 gap-2 text-[10px]">
                        <label class="flex flex-col gap-1">Frame W<input id="frame-width" type="number" step="0.1" class="border border-gray-300 px-2 py-1" value="4"></label>
                        <label class="flex flex-col gap-1">Frame H<input id="frame-height" type="number" step="0.1" class="border border-gray-300 px-2 py-1" value="5"></label>
                        <label class="flex flex-col gap-1">Pos X<input id="frame-x" type="number" step="0.5" class="border border-gray-300 px-2 py-1" value="0"></label>
                        <label class="flex flex-col gap-1">Pos Y<input id="frame-y" type="number" step="0.5" class="border border-gray-300 px-2 py-1" value="5"></label>
                        <label class="flex flex-col gap-1">Pos Z<input id="frame-z" type="number" step="0.5" class="border border-gray-300 px-2 py-1" value="-5"></label>
                        <label class="flex flex-col gap-1">Label<input id="frame-label" type="text" class="border border-gray-300 px-2 py-1" value="New Work"></label>
                    </div>
                    <div class="flex flex-wrap gap-2">
                        <button id="gallery-add-btn" class="ui-click bg-black text-white px-3 py-2">Add/Update Frame</button>
                        <button id="gallery-reset-btn" class="ui-click border border-black px-3 py-2 bg-white hover:bg-red-600 hover:text-white">Reset Layout</button>
                    </div>
                    <div>
                        <div class="text-gray-500 mb-1">Layout (local only)</div>
                        <div id="gallery-frame-list" class="max-h-32 overflow-y-auto space-y-1"></div>
                    </div>
                </div>
            </div>

            <div class="mt-2 text-[10px] font-mono uppercase tracking-widest text-gray-500">Trigger: <button class="underline text-red-600" onclick="gallery.launchLanternOverlay('And you are a Lantern')">"And you are a Lantern"</button></div>
            <a href="oldindex.html" class="ui-click text-xs font-mono underline uppercase tracking-widest">Launch Full Referrer Sequence</a>
            <div class="mt-4 flex flex-wrap gap-2">
                <button onclick="app.navigate('grift')" class="ui-click border border-black bg-white px-3 py-2 text-[10px] font-mono uppercase tracking-widest hover:bg-black hover:text-white transition-colors">Grift Shop</button>
                <button onclick="app.navigate('barter')" class="ui-click border border-black bg-white px-3 py-2 text-[10px] font-mono uppercase tracking-widest hover:bg-black hover:text-white transition-colors">Barter</button>
                <button onclick="app.navigate('pitch')" class="ui-click border border-black bg-white px-3 py-2 text-[10px] font-mono uppercase tracking-widest hover:bg-black hover:text-white transition-colors">Project Brief</button>
            </div>

            <div class="mt-6 gre-comments-mount" data-context-label="CELLI // 3D SPREADSHEET" data-variant="dark" data-page-id="gallery"></div>
        </div>
    </section>

    <!-- FOOTER WITH BACKSTAGE RELAYS -->
    <footer class="bg-black text-white py-10 px-6 md:px-12">
        <div class="max-w-6xl mx-auto flex flex-col md:flex-row justify-between items-start gap-6">
            <div>
                <h4 class="font-mono text-xs uppercase tracking-widest text-gray-300">Backstage Relays (Do Not Publish)</h4>
                <p class="font-serif text-base text-gray-200 max-w-md mt-2">Internal jump points into the legacy referrer experience. Staff use only; these are not public-facing socials.</p>
                <div class="mt-4 flex flex-wrap gap-3">
                    <a class="ui-click inline-flex items-center gap-2 bg-white text-black px-4 py-2 text-xs font-mono uppercase tracking-widest hover:bg-red-600 hover:text-white transition-colors" href="oldindex.html?ref=twitter" aria-label="Redirect to referrer flow via Relay Alpha">Relay Alpha</a>
                    <a class="ui-click inline-flex items-center gap-2 bg-white text-black px-4 py-2 text-xs font-mono uppercase tracking-widest hover:bg-red-600 hover:text-white transition-colors" href="oldindex.html?ref=instagram" aria-label="Redirect to referrer flow via Relay Beta">Relay Beta</a>
                    <a class="ui-click inline-flex items-center gap-2 bg-white text-black px-4 py-2 text-xs font-mono uppercase tracking-widest hover:bg-red-600 hover:text-white transition-colors" href="oldindex.html?ref=tiktok" aria-label="Redirect to referrer flow via Relay Gamma">Relay Gamma</a>
                    <a class="ui-click inline-flex items-center gap-2 bg-white text-black px-4 py-2 text-xs font-mono uppercase tracking-widest hover:bg-red-600 hover:text-white transition-colors" href="oldindex.html" aria-label="Launch referrer flow">Direct Launch</a>
                </div>
            </div>
            <div class="flex flex-col gap-3">
                <span class="font-mono text-xs uppercase tracking-widest text-gray-300">Other Interfaces (Internal)</span>
                <a href="oldindex.html" class="ui-click text-sm underline hover:text-red-400">Celli Referrer Overlay</a>
                <a href="sequence.html" class="ui-click text-sm underline hover:text-red-400">Sequence Preview</a>
                <a href="visicell.html" class="ui-click text-sm underline hover:text-red-400">Visicell Module</a>
            </div>
        </div>
    </footer>

    <button id="dime-mobile-anchor" class="md:hidden ui-click bg-black text-white px-4 py-3 text-[11px] font-mono uppercase tracking-[0.2em]" onclick="dimeBacklog.open();" aria-label="Open Dime Backlog navigator">
        Dime Backlog
    </button>

    <div id="invoice-overlay" class="invoice-overlay" aria-hidden="true">
        <div class="invoice-sheet space-y-4">
            <div class="flex items-center justify-between border-b border-black pb-2">
                <h3 class="uppercase">Domestic Product // Invoice Mode</h3>
                <div class="text-[10px] tracking-[0.3em] uppercase">Press I N V to Exit</div>
            </div>
            <div class="flex justify-between text-sm">
                <div class="space-y-1">
                    <div class="font-bold">Loomworks</div>
                    <div>Corporate Myth Unit</div>
                </div>
                <div class="text-right space-y-1 text-xs uppercase tracking-[0.2em]">
                    <div>Invoice #: LW-WONDER</div>
                    <div>Issued: Now</div>
                </div>
            </div>
            <div class="border border-black">
                <div class="grid grid-cols-4 bg-black text-white text-xs uppercase tracking-[0.2em]">
                    <div class="px-3 py-2 border-r border-white/30">Item</div>
                    <div class="px-3 py-2 border-r border-white/30">Description</div>
                    <div class="px-3 py-2 border-r border-white/30">Quantity</div>
                    <div class="px-3 py-2">Value</div>
                </div>
                <div class="grid grid-cols-4 text-sm">
                    <div class="px-3 py-3 border-r border-black/10">WONDER</div>
                    <div class="px-3 py-3 border-r border-black/10">Held, distributed, never sold.</div>
                    <div class="px-3 py-3 border-r border-black/10">1 UNIT</div>
                    <div class="px-3 py-3 font-bold">UNQUANTIFIABLE.</div>
                </div>
            </div>
            <div class="text-xs uppercase tracking-[0.2em] text-gray-700">Thank you for funding the experiment. Your awareness is the receipt.</div>
        </div>
    </div>

    <div id="glitch-banner" class="glitch-banner" aria-live="polite">HOW MUCH DO YOU COST?</div>

    <!-- JAVASCRIPT LOGIC -->
    <script>
        // Fallback navigation wiring so the hamburger/top bar always works
        (function ensureBasicNav() {
            const sections = Array.from(document.querySelectorAll('.view-section'));

            const setNavState = (target) => {
                document.querySelectorAll('.nav-btn').forEach(btn => {
                    const isActive = btn.dataset.target === target;
                    btn.classList.toggle('underline', isActive);
                    btn.classList.toggle('decoration-red-600', isActive);
                    btn.classList.toggle('decoration-2', isActive);
                    btn.classList.toggle('underline-offset-4', isActive);
                    btn.classList.toggle('text-black', isActive);
                    btn.setAttribute('aria-current', isActive ? 'page' : 'false');
                });
            };

            const activate = (target) => {
                const view = document.getElementById(`view-${target}`);
                if (!view) return;

                sections.forEach(el => el.classList.add('is-hidden'));
                view.classList.remove('is-hidden');
                setNavState(target);
            };

            const toggleMobileMenu = () => {
                const menu = document.getElementById('mobile-menu');
                if (menu) menu.classList.toggle('translate-x-full');
            };

            const handleNavigate = (target) => {
                if (window.app?.navigate) {
                    window.app.navigate(target);
                } else {
                    activate(target);
                }
            };

            const bindNavButtons = () => {
                document.querySelectorAll('[data-nav-target]').forEach((btn) => {
                    btn.addEventListener('click', (event) => {
                        event.preventDefault();
                        const target = btn.dataset.navTarget;
                        if (!target) return;
                        handleNavigate(target);
                        if (btn.dataset.closeMenu !== undefined) toggleMobileMenu();
                    });
                });
            };

            // default view for no-JS fallback reveals everything; hide once JS is ready
            activate('landing');
            bindNavButtons();

            window.app = window.app || {
                navigate: activate,
                toggleMobileMenu
            };
        })();
    </script>

    <script type="module">
        import * as THREE from 'three';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
        
        // --- DATA SETS ---
        const QUIZ = [
            {
                q: "You find a broken toy on the sidewalk. What is your first instinct?",
                opts: [
                    { txt: "Fix it. It has potential.", type: "dreamer", score: 2 },
                    { txt: "Study it. Where did it come from?", type: "scholar", score: 2 },
                    { txt: "Leave it. It is trash.", type: "passerby", score: 2 },
                    { txt: "Evaluate it. Could it be sold?", type: "investor", score: 2 },
                    { txt: "Feel for it. It looks lonely.", type: "lantern", score: 2 }
                ]
            },
            {
                q: "The room is dark. You have one match. What do you illuminate?",
                opts: [
                    { txt: "The door. I need to leave.", type: "passerby", score: 2 },
                    { txt: "The map. I need to know where I am.", type: "scholar", score: 2 },
                    { txt: "My face. I need to be seen.", type: "lantern", score: 2 },
                    { txt: "The inventory. What is in here?", type: "investor", score: 2 },
                    { txt: "The ceiling. I want to see the height.", type: "dreamer", score: 2 }
                ]
            },
            {
                q: "Loomworks asks for your childhood memory. What do you do?",
                opts: [
                    { txt: "Sell it for maximum credit.", type: "investor", score: 3 },
                    { txt: "Archive it for history.", type: "scholar", score: 3 },
                    { txt: "Re-write it to be better.", type: "dreamer", score: 3 },
                    { txt: "Guard it with my life.", type: "lantern", score: 3 },
                    { txt: "I don't remember anything.", type: "passerby", score: 3 }
                ]
            },
            {
                q: "A guest insists the archive is fake. You...",
                opts: [
                    { txt: "Walk away; disbelief is a choice.", type: "passerby", score: 3 },
                    { txt: "Hand them the provenance binder.", type: "scholar", score: 3 },
                    { txt: "Ask what they'd pay if it weren't.", type: "investor", score: 3 },
                    { txt: "Tell them the ghost stories instead.", type: "dreamer", score: 3 },
                    { txt: "Hold their gaze until they soften.", type: "lantern", score: 3 }
                ]
            },
            {
                q: "The lights flicker during the show. What do you protect first?",
                opts: [
                    { txt: "The visitors' pathfinding.", type: "lantern", score: 3 },
                    { txt: "The rarest object on the wall.", type: "scholar", score: 3 },
                    { txt: "The credit stream.", type: "investor", score: 3 },
                    { txt: "The story. Darkness is part of it.", type: "dreamer", score: 3 },
                    { txt: "Myself. I shouldn't be here.", type: "passerby", score: 3 }
                ]
            }
        ];

        const ROLES = {
            dreamer: { adj: "DREAMING", motto: "Dream forward." },
            scholar: { adj: "SCHOLARLY", motto: "Nothing is unimportant." },
            investor: { adj: "SPECULATIVE", motto: "What is magic worth?" },
            passerby: { adj: "WANDERING", motto: "No one is 'just looking'." },
            lantern: { adj: "ILLUMINATED", motto: "Keep the light." }
        };

        // --- TOKI PONA DICTIONARY ---
        const TOKI_PONA_LEXICON = [
            { term: 'a / kin', base: 'a', tags: ['interjection'], origin: 'pu', definition: 'ah, well, okay, so; emphasis marker for agreement or warmth.', gloss: 'emphasis / affirmation' },
            { term: 'akesi', base: 'akesi', tags: ['noun'], origin: 'pu', definition: 'non-cute animal; reptile, amphibian, or other “lizardy” creature.', gloss: 'non-cute animal' },
            { term: 'ala', base: 'ala', tags: ['noun', 'modifier', 'interjection', 'number'], origin: 'pu', definition: 'nothing; negation or refusal; expresses zero.', gloss: 'no / none / zero' },
            { term: 'alasa', base: 'alasa', tags: ['verb'], origin: 'pu', definition: 'to hunt, gather, or forage with intent.', gloss: 'hunt / forage' },
            { term: 'ale / ali', base: 'ale', tags: ['noun', 'modifier', 'number'], origin: 'pu', definition: 'everything, life, the universe; all, every; expresses “100” or boundless quantity.', gloss: 'all / everything' },
            { term: 'anpa', base: 'anpa', tags: ['noun', 'modifier', 'verb'], origin: 'pu', definition: 'bottom, beneath, floor; low or downward; to bow or defeat.', gloss: 'low / beneath' },
            { term: 'ante', base: 'ante', tags: ['noun', 'modifier', 'verb'], origin: 'pu', definition: 'difference or change; different or altered; to modify or change.', gloss: 'different / alter' },
            { term: 'anu', base: 'anu', tags: ['conjunction'], origin: 'pu', definition: 'or; offers a choice between options.', gloss: 'or' },
            { term: 'awen', base: 'awen', tags: ['verb', 'modifier'], origin: 'pu', definition: 'to stay, continue, or keep; enduring or remaining.', gloss: 'continue / stay' },
            { term: 'e', base: 'e', tags: ['particle'], origin: 'pu', definition: 'direct object marker that links a verb to its object.', gloss: 'object marker' },
            { term: 'ijo', base: 'ijo', tags: ['noun', 'modifier', 'verb'], origin: 'pu', definition: 'thing, object, or entity; physical or material; to materialize.', gloss: 'thing / entity' },
            { term: 'ike', base: 'ike', tags: ['noun', 'modifier', 'verb'], origin: 'pu', definition: 'badness or negativity; bad, unpleasant; to worsen.', gloss: 'bad / negative' },
            { term: 'ilo', base: 'ilo', tags: ['noun'], origin: 'pu', definition: 'tool, device, or machine.', gloss: 'tool / device' },
            { term: 'insa', base: 'insa', tags: ['noun', 'modifier'], origin: 'pu', definition: 'inside or center; inner or internal space.', gloss: 'inside' },
            { term: 'jaki', base: 'jaki', tags: ['noun', 'modifier', 'verb'], origin: 'pu', definition: 'filth, garbage; dirty or gross; to dirty something.', gloss: 'dirty / garbage' },
            { term: 'jan', base: 'jan', tags: ['noun', 'modifier'], origin: 'pu', definition: 'person or somebody; human or personal.', gloss: 'person / human' },
            { term: 'jelo', base: 'jelo', tags: ['modifier'], origin: 'pu', definition: 'yellow.', gloss: 'yellow' },
            { term: 'jo', base: 'jo', tags: ['verb', 'noun'], origin: 'pu', definition: 'to have or possess; a possession or holding.', gloss: 'have / possession' },
            { term: 'kala', base: 'kala', tags: ['noun'], origin: 'pu', definition: 'fish or sea creature.', gloss: 'fish' },
            { term: 'kalama', base: 'kalama', tags: ['noun', 'verb', 'modifier'], origin: 'pu', definition: 'sound or noise; to make sound; sonic.', gloss: 'sound / noise' },
            { term: 'kama', base: 'kama', tags: ['verb', 'modifier'], origin: 'pu', definition: 'to come, become, or arrive; becoming or future oriented.', gloss: 'come / become' },
            { term: 'kasi', base: 'kasi', tags: ['noun'], origin: 'pu', definition: 'plant or vegetation.', gloss: 'plant' },
            { term: 'ken', base: 'ken', tags: ['verb', 'noun', 'modifier'], origin: 'pu', definition: 'can or to be able; permission or ability; possible.', gloss: 'can / possible' },
            { term: 'kepeken', base: 'kepeken', tags: ['preposition', 'verb'], origin: 'pu', definition: 'using or with; to use.', gloss: 'use / with' },
            { term: 'kili', base: 'kili', tags: ['noun'], origin: 'pu', definition: 'fruit or vegetable.', gloss: 'fruit / vegetable' },
            { term: 'kin', base: 'kin', tags: ['interjection'], origin: 'pu', definition: 'emphasis marker identical to “a”.', gloss: 'also / indeed' },
            { term: 'kipisi', base: 'kipisi', tags: ['verb', 'noun'], origin: 'kulupu', definition: 'to cut or divide; a slice.', gloss: 'cut / slice' },
            { term: 'kiwen', base: 'kiwen', tags: ['noun'], origin: 'pu', definition: 'stone, metal, or other solid matter.', gloss: 'solid / stone' },
            { term: 'ko', base: 'ko', tags: ['noun'], origin: 'pu', definition: 'paste, powder, goo, or semi-solid matter.', gloss: 'paste / powder' },
            { term: 'kon', base: 'kon', tags: ['noun', 'modifier'], origin: 'pu', definition: 'air, essence, spirit, or breath; airy or ethereal.', gloss: 'air / spirit' },
            { term: 'ku', base: 'ku', tags: ['noun'], origin: 'ku', definition: 'reference to the Toki Pona Dictionary (2021).', gloss: 'book reference' },
            { term: 'kule', base: 'kule', tags: ['noun', 'modifier', 'verb'], origin: 'pu', definition: 'color; colorful; to paint or color.', gloss: 'color' },
            { term: 'kulupu', base: 'kulupu', tags: ['noun', 'modifier'], origin: 'pu', definition: 'group, community, or society; communal or collective.', gloss: 'group / community' },
            { term: 'kute', base: 'kute', tags: ['verb', 'noun'], origin: 'pu', definition: 'to listen or hear; ear or hearing.', gloss: 'listen / ear' },
            { term: 'la', base: 'la', tags: ['particle'], origin: 'pu', definition: 'context marker placing one phrase before another.', gloss: 'context marker' },
            { term: 'lanpan', base: 'lanpan', tags: ['verb', 'noun'], origin: 'kulupu', definition: 'to take or seize; an acquisition.', gloss: 'take / seize' },
            { term: 'lape', base: 'lape', tags: ['verb', 'modifier'], origin: 'pu', definition: 'to sleep; sleeping or restful.', gloss: 'sleep / rest' },
            { term: 'laso', base: 'laso', tags: ['modifier', 'noun'], origin: 'pu', definition: 'blue or green coloration.', gloss: 'blue-green' },
            { term: 'lawa', base: 'lawa', tags: ['noun', 'verb', 'modifier'], origin: 'pu', definition: 'head or mind; to lead or control; main or chief.', gloss: 'lead / head' },
            { term: 'len', base: 'len', tags: ['noun', 'verb'], origin: 'pu', definition: 'cloth or clothing; to wear.', gloss: 'cloth / clothing' },
            { term: 'lete', base: 'lete', tags: ['noun', 'modifier', 'verb'], origin: 'pu', definition: 'cold; cold or uncooked; to cool.', gloss: 'cold' },
            { term: 'li', base: 'li', tags: ['particle'], origin: 'pu', definition: 'separates subject and verb (except with mi/sina).', gloss: 'verb separator' },
            { term: 'lili', base: 'lili', tags: ['noun', 'modifier', 'verb'], origin: 'pu', definition: 'smallness or fewness; small, young, or few; to reduce.', gloss: 'small / few' },
            { term: 'linja', base: 'linja', tags: ['noun', 'modifier'], origin: 'pu', definition: 'line, thread, rope, hair, or cord; long and flexible.', gloss: 'line / rope' },
            { term: 'lipu', base: 'lipu', tags: ['noun'], origin: 'pu', definition: 'sheet, document, page, or book.', gloss: 'sheet / document' },
            { term: 'loje', base: 'loje', tags: ['modifier'], origin: 'pu', definition: 'red.', gloss: 'red' },
            { term: 'lon', base: 'lon', tags: ['preposition', 'modifier', 'verb'], origin: 'pu', definition: 'in, at, on; real or true; to be present.', gloss: 'at / present' },
            { term: 'luka', base: 'luka', tags: ['noun', 'number'], origin: 'pu', definition: 'hand or arm; the number five.', gloss: 'hand / five' },
            { term: 'lukin / oko', base: 'lukin', tags: ['verb', 'noun', 'modifier'], origin: 'pu', definition: 'to see, look, or watch; sight or vision; visual.', gloss: 'see / look' },
            { term: 'lupa', base: 'lupa', tags: ['noun', 'verb'], origin: 'pu', definition: 'hole, door, portal, or opening; to open.', gloss: 'opening / door' },
            { term: 'ma', base: 'ma', tags: ['noun'], origin: 'pu', definition: 'land, country, or the outdoors.', gloss: 'land / place' },
            { term: 'majuna', base: 'majuna', tags: ['modifier'], origin: 'kulupu', definition: 'old or aged.', gloss: 'old' },
            { term: 'mama', base: 'mama', tags: ['noun'], origin: 'pu', definition: 'parent, creator, or origin.', gloss: 'parent / creator' },
            { term: 'mani', base: 'mani', tags: ['noun'], origin: 'pu', definition: 'money, wealth, or livestock.', gloss: 'money / wealth' },
            { term: 'meli', base: 'meli', tags: ['noun', 'modifier'], origin: 'pu', definition: 'woman or feminine person; female.', gloss: 'woman / female' },
            { term: 'mi', base: 'mi', tags: ['pronoun'], origin: 'pu', definition: 'I or we.', gloss: 'I / we' },
            { term: 'mije', base: 'mije', tags: ['noun', 'modifier'], origin: 'pu', definition: 'man or masculine person; male.', gloss: 'man / male' },
            { term: 'moku', base: 'moku', tags: ['noun', 'verb'], origin: 'pu', definition: 'food; to eat, drink, or consume.', gloss: 'eat / food' },
            { term: 'moli', base: 'moli', tags: ['noun', 'modifier', 'verb'], origin: 'pu', definition: 'death; dead; to kill or die.', gloss: 'death / kill' },
            { term: 'monsi', base: 'monsi', tags: ['noun'], origin: 'pu', definition: 'back or behind.', gloss: 'back / behind' },
            { term: 'mun', base: 'mun', tags: ['noun'], origin: 'pu', definition: 'moon or other celestial light.', gloss: 'moon' },
            { term: 'musi', base: 'musi', tags: ['noun', 'verb', 'modifier'], origin: 'pu', definition: 'fun, art, or play; to entertain; artistic or playful.', gloss: 'fun / play' },
            { term: 'mute', base: 'mute', tags: ['modifier', 'verb', 'noun', 'number'], origin: 'pu', definition: 'many or much; to multiply; quantity; the number twenty.', gloss: 'many / 20' },
            { term: 'nanpa', base: 'nanpa', tags: ['noun', 'modifier', 'particle'], origin: 'pu', definition: 'number; numeric; ordinal marker.', gloss: 'number / ordinal' },
            { term: 'nasa', base: 'nasa', tags: ['noun', 'modifier', 'verb'], origin: 'pu', definition: 'weirdness; strange, drunk, or foolish; to distort.', gloss: 'strange / silly' },
            { term: 'nasin', base: 'nasin', tags: ['noun', 'verb'], origin: 'pu', definition: 'way, doctrine, method, or road; to guide.', gloss: 'way / method' },
            { term: 'nena', base: 'nena', tags: ['noun'], origin: 'pu', definition: 'bump, nose, hill, or button.', gloss: 'bump / nose' },
            { term: 'ni', base: 'ni', tags: ['modifier', 'noun'], origin: 'pu', definition: 'this or that; this/that thing.', gloss: 'this / that' },
            { term: 'nimi', base: 'nimi', tags: ['noun'], origin: 'pu', definition: 'word or name.', gloss: 'name / word' },
            { term: 'noka', base: 'noka', tags: ['noun', 'modifier'], origin: 'pu', definition: 'foot, leg, or base; bottom or lower.', gloss: 'foot / leg' },
            { term: 'o', base: 'o', tags: ['particle'], origin: 'pu', definition: 'imperative or vocative particle (“hey X, do Y”).', gloss: 'imperative' },
            { term: 'pakala', base: 'pakala', tags: ['noun', 'modifier', 'verb'], origin: 'pu', definition: 'mistake or damage; broken or messed up; to break or screw up.', gloss: 'damage / break' },
            { term: 'pali', base: 'pali', tags: ['noun', 'verb'], origin: 'pu', definition: 'work, function, or action; to work, build, or create.', gloss: 'work / build' },
            { term: 'palisa', base: 'palisa', tags: ['noun'], origin: 'pu', definition: 'stick, rod, or branch.', gloss: 'stick / rod' },
            { term: 'pan', base: 'pan', tags: ['noun'], origin: 'pu', definition: 'grain, bread, or food staple.', gloss: 'bread / grain' },
            { term: 'pana', base: 'pana', tags: ['verb', 'noun'], origin: 'pu', definition: 'to give, send, put, or emit; a gift or transmission.', gloss: 'give / send' },
            { term: 'pi', base: 'pi', tags: ['particle'], origin: 'pu', definition: 'groups modifiers; clusters adjectives into one phrase.', gloss: 'of / grouping' },
            { term: 'pilin', base: 'pilin', tags: ['noun', 'verb'], origin: 'pu', definition: 'feeling or emotion; to feel or think emotionally.', gloss: 'feel / emotion' },
            { term: 'pimeja', base: 'pimeja', tags: ['noun', 'modifier'], origin: 'pu', definition: 'darkness; black or unlit.', gloss: 'black / dark' },
            { term: 'pini', base: 'pini', tags: ['noun', 'verb'], origin: 'pu', definition: 'end or completion; to finish or stop.', gloss: 'end / finish' },
            { term: 'pipi', base: 'pipi', tags: ['noun'], origin: 'pu', definition: 'bug or insect.', gloss: 'bug / insect' },
            { term: 'poka', base: 'poka', tags: ['noun', 'preposition', 'modifier'], origin: 'pu', definition: 'side; next to or with; beside.', gloss: 'beside / with' },
            { term: 'poki', base: 'poki', tags: ['noun'], origin: 'pu', definition: 'container, box, or cup.', gloss: 'container' },
            { term: 'pona', base: 'pona', tags: ['noun', 'modifier', 'verb'], origin: 'pu', definition: 'goodness; good, simple, or positive; to improve or fix.', gloss: 'good / simple' },
            { term: 'pu', base: 'pu', tags: ['noun'], origin: 'pu', definition: 'interacting with the official book “Toki Pona: The Language of Good”.', gloss: 'with the book' },
            { term: 'sama', base: 'sama', tags: ['noun', 'preposition', 'modifier'], origin: 'pu', definition: 'equality; like or similar to; same or equal.', gloss: 'same / like' },
            { term: 'seli', base: 'seli', tags: ['noun', 'modifier', 'verb'], origin: 'pu', definition: 'heat or fire; warm; to heat.', gloss: 'heat / warm' },
            { term: 'selo', base: 'selo', tags: ['noun'], origin: 'pu', definition: 'outer layer, skin, shell, or boundary.', gloss: 'outer layer' },
            { term: 'seme', base: 'seme', tags: ['particle'], origin: 'pu', definition: 'what? which? used for questions.', gloss: 'what / which' },
            { term: 'sewi', base: 'sewi', tags: ['noun', 'modifier', 'verb'], origin: 'pu', definition: 'height or holiness; elevated or sacred; to raise.', gloss: 'high / sacred' },
            { term: 'sijelo', base: 'sijelo', tags: ['noun'], origin: 'pu', definition: 'body or physical form.', gloss: 'body' },
            { term: 'sike', base: 'sike', tags: ['noun', 'modifier', 'verb'], origin: 'pu', definition: 'circle, ball, or sphere; round; to turn or rotate.', gloss: 'circle / rotate' },
            { term: 'sin / sina', base: 'sin', tags: ['modifier', 'pronoun'], origin: 'pu', definition: 'sin: new or fresh. sina: you (singular or plural).', gloss: 'new / you' },
            { term: 'sinpin', base: 'sinpin', tags: ['noun'], origin: 'pu', definition: 'front, face, or wall.', gloss: 'front / face' },
            { term: 'sitelen', base: 'sitelen', tags: ['noun', 'verb'], origin: 'pu', definition: 'image or writing; to draw or write.', gloss: 'write / image' },
            { term: 'soko', base: 'soko', tags: ['noun'], origin: 'kulupu', definition: 'mushroom or fungus.', gloss: 'mushroom' },
            { term: 'sona', base: 'sona', tags: ['noun', 'verb', 'modifier'], origin: 'pu', definition: 'knowledge; to know, understand, or learn; wise.', gloss: 'know / knowledge' },
            { term: 'soweli', base: 'soweli', tags: ['noun'], origin: 'pu', definition: 'animal, typically mammal-like.', gloss: 'animal' },
            { term: 'suli', base: 'suli', tags: ['noun', 'modifier', 'verb'], origin: 'pu', definition: 'size or importance; big, long, or important; to enlarge.', gloss: 'big / important' },
            { term: 'suno', base: 'suno', tags: ['noun'], origin: 'pu', definition: 'sun, light, or glow.', gloss: 'sun / light' },
            { term: 'supa', base: 'supa', tags: ['noun'], origin: 'pu', definition: 'surface, table, or platform.', gloss: 'surface / table' },
            { term: 'suwi', base: 'suwi', tags: ['noun', 'modifier', 'verb'], origin: 'pu', definition: 'sweetness; sweet or cute; to sweeten.', gloss: 'sweet / cute' },
            { term: 'tan', base: 'tan', tags: ['preposition'], origin: 'pu', definition: 'from or because of.', gloss: 'from / because' },
            { term: 'taso', base: 'taso', tags: ['conjunction', 'modifier'], origin: 'pu', definition: 'but; only or merely.', gloss: 'but / only' },
            { term: 'tawa', base: 'tawa', tags: ['verb', 'preposition', 'modifier'], origin: 'pu', definition: 'to move or go; to, toward, or for; moving.', gloss: 'to / go' },
            { term: 'telo', base: 'telo', tags: ['noun', 'verb'], origin: 'pu', definition: 'water or fluid; to wash or wet.', gloss: 'water / wash' },
            { term: 'tenpo', base: 'tenpo', tags: ['noun'], origin: 'pu', definition: 'time, moment, or period.', gloss: 'time' },
            { term: 'toki', base: 'toki', tags: ['noun', 'verb'], origin: 'pu', definition: 'speech or language; to talk or communicate.', gloss: 'talk / language' },
            { term: 'tomo', base: 'tomo', tags: ['noun', 'modifier'], origin: 'pu', definition: 'room, building, or household; domestic.', gloss: 'building / room' },
            { term: 'tu', base: 'tu', tags: ['number', 'verb'], origin: 'pu', definition: 'two; to divide into two.', gloss: 'two / split' },
            { term: 'unpa', base: 'unpa', tags: ['verb', 'noun', 'modifier'], origin: 'pu', definition: 'to have sex; sexuality; sexual.', gloss: 'sexual / intimacy' },
            { term: 'uta', base: 'uta', tags: ['noun', 'verb'], origin: 'pu', definition: 'mouth; to kiss or taste.', gloss: 'mouth / kiss' },
            { term: 'utala', base: 'utala', tags: ['verb', 'noun'], origin: 'pu', definition: 'fight or struggle; conflict.', gloss: 'fight / conflict' },
            { term: 'walo', base: 'walo', tags: ['noun', 'modifier'], origin: 'pu', definition: 'whiteness; white or pale.', gloss: 'white' },
            { term: 'wan', base: 'wan', tags: ['number', 'modifier'], origin: 'pu', definition: 'one; united or singular.', gloss: 'one / united' },
            { term: 'waso', base: 'waso', tags: ['noun'], origin: 'pu', definition: 'bird.', gloss: 'bird' },
            { term: 'wawa', base: 'wawa', tags: ['noun', 'modifier', 'verb'], origin: 'pu', definition: 'strength or energy; strong or intense; to energize.', gloss: 'power / energy' },
            { term: 'weka', base: 'weka', tags: ['noun', 'modifier', 'verb'], origin: 'pu', definition: 'absence; away or missing; to remove or send away.', gloss: 'away / remove' },
            { term: 'wile', base: 'wile', tags: ['verb', 'noun', 'modifier'], origin: 'pu', definition: 'to want, need, or must; desire; necessary.', gloss: 'want / need' }
        ];

        const tokiDictionary = {
            sortMode: 'alphabetical',
            groupers: {
                alphabetical: (entry) => entry.base.charAt(0).toUpperCase(),
                part: (entry) => (entry.tags[0] || 'general').replace(/^./, c => c.toUpperCase()),
                origin: (entry) => tokiDictionary.originLabels[entry.origin] || 'Community Extension'
            },
            originOrder: ['pu (2014)', 'kulupu (2021)', 'ku (Dictionary 2021)', 'Community Extension'],
            originLabels: {
                pu: 'pu (2014)',
                kulupu: 'kulupu (2021)',
                ku: 'ku (Dictionary 2021)',
                community: 'Community Extension'
            },
            setMode(mode) {
                if (!tokiDictionary.groupers[mode]) return;
                tokiDictionary.sortMode = mode;
                document.querySelectorAll('.toki-sort-btn').forEach(btn => {
                    if (btn.dataset.tokiSort === mode) {
                        btn.classList.add('bg-black', 'text-white');
                        btn.classList.remove('bg-white', 'text-black');
                    } else {
                        btn.classList.remove('bg-black', 'text-white');
                        btn.classList.add('bg-white', 'text-black');
                    }
                });
                tokiDictionary.render();
            },
            render() {
                const container = document.getElementById('toki-dictionary-groups');
                if (!container) return;
                const grouper = tokiDictionary.groupers[tokiDictionary.sortMode];
                const groups = {};

                TOKI_PONA_LEXICON.forEach(entry => {
                    const key = grouper(entry);
                    if (!groups[key]) groups[key] = [];
                    groups[key].push(entry);
                });

                let keys = Object.keys(groups);
                if (tokiDictionary.sortMode === 'origin') {
                    keys.sort((a, b) => tokiDictionary.originOrder.indexOf(a) - tokiDictionary.originOrder.indexOf(b));
                } else {
                    keys.sort();
                }

                const createEntry = (entry) => `
                    <div class="border border-gray-200 rounded-lg p-3 bg-[#FDFBF7] h-full flex flex-col gap-2">
                        <div class="flex items-start justify-between gap-3">
                            <div class="font-bold uppercase tracking-tight">${entry.term}</div>
                            <div class="text-[10px] font-mono uppercase tracking-widest text-gray-500 text-right">${entry.tags.join(' • ')}</div>
                        </div>
                        <p class="text-sm text-gray-800 leading-relaxed">${entry.definition}</p>
                        <p class="text-[11px] text-gray-600 font-mono">Gloss: ${entry.gloss}</p>
                    </div>
                `;

                container.innerHTML = keys.map(key => {
                    const items = groups[key].sort((a, b) => a.base.localeCompare(b.base));
                    return `
                        <div class="border border-gray-200 rounded-xl overflow-hidden">
                            <div class="bg-black text-white px-4 py-2 flex items-center justify-between text-xs font-mono uppercase tracking-widest">
                                <span>${key}</span>
                                <span class="text-gray-200">${items.length} entr${items.length === 1 ? 'y' : 'ies'}</span>
                            </div>
                            <div class="p-4 grid grid-cols-1 md:grid-cols-2 gap-3">
                                ${items.map(createEntry).join('')}
                            </div>
                        </div>
                    `;
                }).join('');
            },
            init() {
                document.querySelectorAll('.toki-sort-btn').forEach(btn => {
                    btn.addEventListener('click', () => tokiDictionary.setMode(btn.dataset.tokiSort));
                });
                tokiDictionary.render();
            }
        };

        // --- ARCHIVE INDEX ---
        const archive = {
            data: null,
            async init() {
                if (archive.data) return archive.render();

                try {
                    const response = await fetch('static/data/archive-index.json');
                    archive.data = await response.json();
                    archive.render();
                } catch (err) {
                    console.error('Failed to load archive index', err);
                    const loading = document.getElementById('archive-loading');
                    const errorBox = document.getElementById('archive-error');
                    if (loading) loading.classList.add('hidden');
                    if (errorBox) errorBox.classList.remove('hidden');
                }
            },
            render() {
                if (!archive.data) return;

                const { quickIndex = [], groups = [], updated = '—' } = archive.data;
                const quickEl = document.getElementById('archive-quick');
                const groupEl = document.getElementById('archive-groups');
                const loading = document.getElementById('archive-loading');

                if (loading) loading.classList.add('hidden');
                const errorBox = document.getElementById('archive-error');
                if (errorBox) errorBox.classList.add('hidden');

                if (quickEl) {
                    quickEl.innerHTML = '';
                    quickIndex.forEach((entry, idx) => {
                        const line = document.createElement('div');
                        line.className = 'flex items-start gap-2';
                        line.innerHTML = `<span class="text-gray-400">${idx + 1}.</span><span>${entry}</span>`;
                        quickEl.appendChild(line);
                    });
                }

                if (document.getElementById('archive-count')) {
                    const totalItems = groups.reduce((sum, g) => sum + (g.items?.length || 0), 0);
                    document.getElementById('archive-count').innerText = totalItems;
                }
                if (document.getElementById('archive-era-count')) document.getElementById('archive-era-count').innerText = groups.length;
                if (document.getElementById('archive-updated')) document.getElementById('archive-updated').innerText = updated;

                if (groupEl) {
                    groupEl.innerHTML = '';
                    groups.forEach(group => {
                        const wrapper = document.createElement('div');
                        wrapper.className = 'bg-white border border-black shadow-sm';

                        const header = document.createElement('div');
                        header.className = 'border-b border-gray-200 px-4 py-3 flex flex-col md:flex-row md:items-center md:justify-between gap-2';
                        header.innerHTML = `
                            <div>
                                <div class="text-[10px] font-mono uppercase tracking-widest text-gray-500">${group.era}</div>
                                <h3 class="text-xl font-bold">${group.era} Inventory</h3>
                            </div>
                            <div class="text-sm font-mono text-gray-600 max-w-2xl">${group.summary || ''}</div>
                        `;

                        const body = document.createElement('div');
                        body.className = 'divide-y divide-gray-200';

                        (group.items || []).forEach(item => {
                            const meta = [
                                item.franchise ? `<span class="px-2 py-1 border border-gray-200 bg-gray-50">${item.franchise}</span>` : '',
                                item.category ? `<span class="px-2 py-1 border border-gray-200 bg-gray-50">${item.category}</span>` : '',
                                item.quantity ? `<span class="px-2 py-1 border border-gray-200 bg-gray-50">${item.quantity}</span>` : '',
                                item.origin ? `<span class="px-2 py-1 border border-gray-200 bg-gray-50">${item.origin}</span>` : ''
                            ].filter(Boolean).join('');

                            const row = document.createElement('div');
                            row.className = 'p-4';
                            row.innerHTML = `
                                <div class="flex flex-col md:flex-row md:items-start md:justify-between gap-3">
                                    <div class="md:w-2/3">
                                        <div class="text-[10px] font-mono uppercase tracking-widest text-gray-500">#${item.id} • ${item.format || 'Item'} • ${item.year || 'n.d.'}</div>
                                        <h4 class="text-lg font-semibold">${item.title}</h4>
                                        <p class="text-sm text-gray-700 mt-2">${item.notes || ''}</p>
                                        <div class="flex flex-wrap gap-2 mt-3 text-[10px] font-mono uppercase tracking-widest text-gray-700">${meta}</div>
                                    </div>
                                    <div class="md:w-1/3 md:text-right text-sm font-mono text-gray-600 flex flex-col gap-2">
                                        <span class="inline-block border border-gray-300 bg-gray-50 px-2 py-1">${item.category || 'Inventory'}</span>
                                        <span class="inline-block border border-gray-200 bg-gray-50 px-2 py-1">${item.format || 'Item'}</span>
                                    </div>
                                </div>
                            `;
                            body.appendChild(row);
                        });

                        wrapper.appendChild(header);
                        wrapper.appendChild(body);
                        groupEl.appendChild(wrapper);
                    });
                }
            }
        };
        window.archive = archive;

        // --- GRE / GREG COMMENT LAYER ---
        const greAnalytics = {
            events: [],
            track: (type, detail = {}) => {
                greAnalytics.events.push({ type, detail, at: Date.now() });
            }
        };

        const GRE_STRINGS = ['GREETING PROTOCOL', 'GREETING PRO', 'GREE', 'GREETING PROTO GREG'];
        const greComments = {
            buildCopy: (contextLabel = '') => {
                const contextAware = contextLabel
                    ? `Context noted: ${contextLabel}. Indexing complete; guest curiosity exceeding forecast.`
                    : 'No context provided. Running default hospitality script.';

                return [
                    {
                        name: 'GRE',
                        text: 'Logging guest reactions instead. Please do not attempt to respond.',
                        timestamp: '1970-01-01 00:00:01 UTC',
                        tooltip: 'System log. Not a real comment.'
                    },
                    {
                        name: 'GRE',
                        text: `${contextAware} <span class="gre-sigil" data-full="GREETING PROTO GREG">GRE</span>ETING PROTO GREG keeps humming in the margin.`,
                        timestamp: 'Pending…',
                        tooltip: 'Process: GREETING PROTOCOL (unstable).',
                        contextAware: true
                    },
                    {
                        name: 'GREG',
                        text: 'Sorry, I am not supposed to be here.',
                        timestamp: 'Buffered 00:00:07',
                        tooltip: 'String overflow: GREETING PROTOCOL → GREG.',
                        glitch: true
                    }
                ];
            },
            renderMount: (mount, index = 0) => {
                const variant = (mount.dataset.variant || 'light').toLowerCase();
                const contextLabel = mount.dataset.contextLabel || '';
                const pageId = mount.dataset.pageId || `page-${index}`;
                const copy = greComments.buildCopy(contextLabel);

                const container = document.createElement('div');
                container.className = `gre-comments ${variant === 'dark' ? 'dark' : ''}`;
                container.setAttribute('data-page-id', pageId);
                container.innerHTML = `
                    <div class="gre-header gre-tooltip-anchor" data-tooltip="This space is reserved for opinions that never shipped.">
                        <span>COMMENT CHANNEL: OFFLINE</span>
                        <span class="text-[10px] font-mono">${contextLabel || 'NO CONTEXT REGISTERED'}</span>
                    </div>
                    <div class="gre-sub">System Note: Comments were never enabled here.</div>
                    <p class="sr-only">System: Comments are disabled on this site.</p>
                    <div class="gre-list" aria-hidden="true">
                        ${copy.map(line => `
                            <div class="gre-item gre-tooltip-anchor" data-tooltip="${line.tooltip}">
                                <div class="gre-avatar">${line.name === 'GREG' ? '?' : '::'}</div>
                                <div>
                                    <div class="gre-meta">
                                        <span class="gre-tooltip-anchor ${line.glitch ? 'text-red-600' : ''}" data-tooltip="${line.tooltip}">${line.name === 'GRE' ? `<span class=\"gre-sigil\" data-full=\"GREETING PROTOCOL\">${line.name}</span>` : line.name}</span>
                                        <span class="text-[10px] text-gray-500">${line.timestamp}</span>
                                    </div>
                                    <p class="gre-text">${line.text}</p>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                    <div class="gre-disabled">
                        <input class="gre-input gre-tooltip-anchor" type="text" placeholder="Comments are disabled in this environment." disabled aria-disabled="true" data-tooltip="How is he commenting? Comment did NOT approve this.">
                        <button class="gre-button gre-tooltip-anchor" type="button" disabled aria-disabled="true" data-tooltip="How is he commenting? Comment did NOT approve this.">Submit</button>
                    </div>
                `;

                greComments.attachSelection(container, pageId);
                greComments.attachEvents(container, pageId);
                mount.replaceWith(container);
            },
            attachEvents: (container, pageId) => {
                container.querySelectorAll('.gre-tooltip-anchor').forEach(el => {
                    el.addEventListener('mouseenter', () => greAnalytics.track('hover', { pageId, text: el.innerText.trim() }));
                });

                const input = container.querySelector('.gre-input');
                if (input) {
                    ['focus', 'mouseenter'].forEach(evt => {
                        input.addEventListener(evt, () => greAnalytics.track('input-hover', { pageId }));
                    });
                }
            },
            attachSelection: (container, pageId) => {
                const reveal = () => {
                    const selection = window.getSelection();
                    if (!selection || selection.isCollapsed) return greComments.clearHighlights(container);
                    if (selection.rangeCount === 0) return greComments.clearHighlights(container);
                    const range = selection.getRangeAt(0);
                    if (!container.contains(range.commonAncestorContainer)) return greComments.clearHighlights(container);

                    const rect = range.getBoundingClientRect();
                    if (!rect || (rect.width === 0 && rect.height === 0)) return greComments.clearHighlights(container);

                    const message = GRE_STRINGS[Math.floor(Math.random() * GRE_STRINGS.length)];
                    greComments.clearHighlights(container);
                    const note = document.createElement('div');
                    note.className = 'gre-highlight-note';
                    note.textContent = `Full process name: ${message}`;

                    const bounds = container.getBoundingClientRect();
                    const left = rect.left - bounds.left + rect.width / 2;
                    const top = rect.top - bounds.top - 10;
                    note.style.left = `${left}px`;
                    note.style.top = `${top}px`;
                    container.appendChild(note);

                    greAnalytics.track('selection', { pageId, message });
                    setTimeout(() => note.remove(), 1800);
                };

                container.addEventListener('mouseup', reveal);
                container.addEventListener('keyup', reveal);
            },
            clearHighlights: (container) => {
                container.querySelectorAll('.gre-highlight-note').forEach(node => node.remove());
            },
            mountAll: () => {
                document.querySelectorAll('.gre-comments-mount').forEach((mount, idx) => greComments.renderMount(mount, idx));
            }
        };

        window.greComments = greComments;
        window.greAnalytics = greAnalytics;

        // --- GLOBAL APP STATE ---
        const state = {
            view: 'landing',
            audioInitialized: false,
            synth: null,
            sessionNonce: Math.random().toString(36).slice(2, 7)
        };

        // --- AMBIENT SYSTEMS ---
        const ambient = {
            tooltipTimer: null,
            prompts: [
                'DO YOU FEEL SEEN?',
                'THIS IS AN INTERACTION.',
                'ARTIFACT VERIFIED.',
                'A MEMORY IS BEING PROCESSED…'
            ],
            startTooltips() {
                if (ambient.tooltipTimer) return;
                ambient.scheduleTooltip();
            },
            scheduleTooltip() {
                ambient.tooltipTimer = setTimeout(() => {
                    if (state.view === 'landing') ambient.spawnTooltip();
                    ambient.tooltipTimer = null;
                    ambient.scheduleTooltip();
                }, 6000 + Math.random() * 7000);
            },
            spawnTooltip() {
                const layer = document.getElementById('ambient-layer');
                if (!layer) return;
                const tip = document.createElement('div');
                tip.className = 'ambient-tooltip';
                tip.textContent = ambient.prompts[Math.floor(Math.random() * ambient.prompts.length)];
                tip.style.left = `${20 + Math.random() * 60}%`;
                tip.style.top = `${20 + Math.random() * 60}%`;
                layer.appendChild(tip);
                setTimeout(() => tip.remove(), 2200);
            },
            stopTooltips() {
                if (ambient.tooltipTimer) { clearTimeout(ambient.tooltipTimer); ambient.tooltipTimer = null; }
            }
        };

        const registerHeatmap = () => {
            document.querySelectorAll('.legal-copy').forEach(el => {
                el.addEventListener('mousemove', (e) => {
                    const rect = el.getBoundingClientRect();
                    el.style.setProperty('--x', `${e.clientX - rect.left}px`);
                    el.style.setProperty('--y', `${e.clientY - rect.top}px`);
                });
            });
        };

        const observeBlueprints = () => {
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => { if (entry.isIntersecting) entry.target.classList.add('active'); });
            }, { threshold: 0.15 });
            document.querySelectorAll('.blueprint-lines').forEach(el => observer.observe(el));
        };

        const initScanlineParallax = () => {
            const layer = document.querySelector('#view-landing .scanline-layer');
            if (!layer) return;
            const move = () => {
                const offset = window.scrollY * 0.04;
                layer.style.transform = `translateY(${offset}px)`;
            };
            window.addEventListener('scroll', move);
        };

        const startIdleGlitch = () => {
            setInterval(() => {
                if (state.view !== 'landing') return;
                const title = document.getElementById('dp-title');
                if (!title) return;
                title.classList.add('micro-glitch');
                setTimeout(() => title.classList.remove('micro-glitch'), 800);
            }, 60000);
        };

        const initInvoiceMode = () => {
            const overlay = document.getElementById('invoice-overlay');
            if (!overlay) return;
            let buffer = '';
            const toggle = (force = null) => {
                const shouldShow = force !== null ? force : !overlay.classList.contains('active');
                overlay.classList.toggle('active', shouldShow);
                overlay.setAttribute('aria-hidden', shouldShow ? 'false' : 'true');
                document.body.classList.toggle('modal-open', shouldShow);
            };
            document.addEventListener('keydown', (e) => {
                if (['INPUT', 'TEXTAREA'].includes(e.target.tagName)) return;
                buffer = (buffer + e.key.toLowerCase()).slice(-3);
                if (buffer === 'inv') toggle();
                if (e.key === 'Escape') toggle(false);
            });
        };

        const startGlitchBannerCycle = () => {
            const banner = document.getElementById('glitch-banner');
            if (!banner) return;
            const trigger = () => {
                banner.classList.add('active');
                setTimeout(() => banner.classList.remove('active'), 3600);
                setTimeout(trigger, 9000 + Math.random() * 9000);
            };
            setTimeout(trigger, 5200);
        };

        // --- AUDIO ENGINE ---
        const audio = {
            drone: null,
            chimes: null,
            chimeLoop: null,
            master: null,
            droneGain: null,
            hoverSynth: null,
            tokenSynth: null,
            clunk: null,
            transportStarted: false,
            init: async () => {
                if (state.audioInitialized) return;
                await Tone.start();
                audio.master = new Tone.Gain(0.9).toDestination();
                state.synth = new Tone.NoiseSynth({
                    noise: { type: 'pink' },
                    envelope: { attack: 0.001, decay: 0.08, sustain: 0, release: 0.05 }
                }).connect(new Tone.Gain(0.25).connect(audio.master));
                state.audioInitialized = true;
            },
            click: () => {
                if (!state.audioInitialized || !state.synth) {
                    audio.init().then(() => { if(state.synth) state.synth.triggerAttackRelease("16n", Tone.now()); });
                } else {
                    state.synth.triggerAttackRelease("16n", Tone.now());
                }
            },
            startDrone: async () => {
                await audio.init();
                if (!audio.drone) {
                    audio.droneGain = new Tone.Gain(0.06).connect(audio.master);
                    audio.drone = new Tone.Oscillator(60, 'sine').connect(audio.droneGain);
                    audio.drone.start();
                }
            },
            playTapeClick: async () => {
                await audio.init();
                if (!audio.hoverSynth) {
                    audio.hoverSynth = new Tone.MembraneSynth({
                        pitchDecay: 0.02,
                        octaves: 1.5,
                        oscillator: { type: 'triangle' },
                        envelope: { attack: 0.002, decay: 0.12, sustain: 0, release: 0.08 }
                    }).connect(new Tone.Gain(0.12).connect(audio.master));
                }
                audio.hoverSynth.triggerAttackRelease('A3', '16n');
            },
            playTokenReward: async () => {
                await audio.init();
                if (!audio.tokenSynth) {
                    audio.tokenSynth = new Tone.AMSynth({
                        harmonicity: 1.25,
                        modulationIndex: 3,
                        oscillator: { type: 'sine' },
                        envelope: { attack: 0.02, decay: 0.2, sustain: 0.1, release: 0.6 }
                    }).connect(new Tone.Gain(0.18).connect(audio.master));
                }
                audio.tokenSynth.triggerAttackRelease('C5', '8n');
                audio.tokenSynth.triggerAttackRelease('G4', '8n', '+0.12');
            },
            playClunk: async () => {
                await audio.init();
                if (!audio.clunk) {
                    audio.clunk = new Tone.MembraneSynth({
                        pitchDecay: 0.006,
                        octaves: 3,
                        oscillator: { type: 'sine' },
                        envelope: { attack: 0.001, decay: 0.32, sustain: 0, release: 0.08 }
                    }).connect(new Tone.Gain(0.4).connect(audio.master));
                }
                audio.clunk.triggerAttackRelease('C2', '8n');
            },
            startLantern: async () => {
                await audio.init();
                if (!audio.transportStarted) {
                    Tone.Transport.start();
                    audio.transportStarted = true;
                }
                if (!audio.drone) {
                    audio.droneGain = audio.droneGain || new Tone.Gain(0.06).connect(audio.master);
                    audio.drone = new Tone.Oscillator('C2', 'sawtooth').connect(new Tone.Filter(400, 'lowpass')).connect(audio.droneGain);
                    audio.drone.volume.value = -16;
                    audio.drone.start();
                }
                if (!audio.chimes) {
                    audio.chimes = new Tone.MetalSynth({ resonance: 300, harmonicity: 8, modulationIndex: 15 }).connect(new Tone.Gain(0.12).connect(audio.master));
                }
                if (!audio.chimeLoop) {
                    const notes = ['C4', 'G4', 'D5', 'A4'];
                    audio.chimeLoop = new Tone.Loop((time) => {
                        const note = notes[Math.floor(Math.random() * notes.length)];
                        audio.chimes.triggerAttackRelease(note, '16n', time);
                    }, '3n').start();
                }
            },
            stopLantern: () => {
                if (audio.drone) { audio.drone.stop(); audio.drone.dispose(); audio.drone = null; }
                if (audio.chimeLoop) { audio.chimeLoop.stop(); audio.chimeLoop.dispose(); audio.chimeLoop = null; }
                if (audio.chimes) { audio.chimes.dispose(); audio.chimes = null; }
                if (audio.transportStarted) {
                    Tone.Transport.stop();
                    audio.transportStarted = false;
                }
            }
        };

        const bindHoverAudio = () => {
            const hoverSelectors = [
                "[data-target='archive']",
                "[data-target='tickets']",
                "button[onclick*=\"navigate('archive')\"]",
                "button[onclick*=\"navigate('tickets')\"]"
            ];
            const hoverTargets = document.querySelectorAll(hoverSelectors.join(', '));
            hoverTargets.forEach((el) => {
                el.addEventListener('mouseenter', audio.playTapeClick);
                el.addEventListener('focus', audio.playTapeClick);
            });
        };

        const argOnboarding = {
            key: 'loomworks_arg_onboarding_v1',
            state: { arg: null, entry: null, completed: false },
            modal: null,
            statusEl: null,

            init() {
                argOnboarding.modal = document.getElementById('arg-onboarding-modal');
                argOnboarding.statusEl = document.getElementById('arg-onboarding-status');
                const confirm = document.getElementById('arg-onboarding-confirm');
                const close = document.getElementById('arg-onboarding-close');

                document.querySelectorAll('.arg-choice').forEach((btn) => {
                    btn.addEventListener('click', () => argOnboarding.choose(btn.dataset.argGroup, btn.dataset.argValue, btn));
                });
                if (confirm) confirm.addEventListener('click', argOnboarding.confirm);
                if (close) close.addEventListener('click', argOnboarding.dismiss);

                argOnboarding.restore();
            },

            updateStatus(message, variant = 'muted') {
                if (!argOnboarding.statusEl) return;
                argOnboarding.statusEl.textContent = message;
                argOnboarding.statusEl.className = 'font-mono text-xs uppercase tracking-widest';
                const palette = variant === 'success'
                    ? 'text-green-700'
                    : variant === 'error'
                        ? 'text-red-600'
                        : 'text-gray-700';
                argOnboarding.statusEl.classList.add(palette);
            },

            choose(group, value, el, silent = false) {
                if (!group) return;
                argOnboarding.state[group] = value;
                document.querySelectorAll(`[data-arg-group="${group}"]`).forEach((btn) => {
                    btn.classList.remove('bg-black', 'text-white', 'border-black', 'ring-2', 'ring-red-500');
                });
                if (el) el.classList.add('bg-black', 'text-white', 'border-black', 'ring-2', 'ring-red-500');
                if (!silent) argOnboarding.updateStatus('Responses cached. Lock to continue.');
            },

            confirm() {
                if (!argOnboarding.state.arg || !argOnboarding.state.entry) {
                    argOnboarding.updateStatus('Answer both prompts to continue.', 'error');
                    return;
                }
                argOnboarding.state.completed = true;
                argOnboarding.persist();
                argOnboarding.syncCalibration();
                argOnboarding.updateStatus('Stored. Welcome to the Loomworks.', 'success');
                setTimeout(argOnboarding.dismiss, 320);
            },

            persist() {
                if (typeof localStorage === 'undefined') return;
                try { localStorage.setItem(argOnboarding.key, JSON.stringify(argOnboarding.state)); } catch (err) { /* noop */ }
            },

            restore() {
                if (typeof localStorage === 'undefined') return;
                try {
                    const saved = JSON.parse(localStorage.getItem(argOnboarding.key) || '{}');
                    if (saved.arg) argOnboarding.choose('arg', saved.arg, document.querySelector(`[data-arg-group="arg"][data-arg-value="${saved.arg}"]`), true);
                    if (saved.entry) argOnboarding.choose('entry', saved.entry, document.querySelector(`[data-arg-group="entry"][data-arg-value="${saved.entry}"]`), true);
                    argOnboarding.state.completed = !!saved.completed && !!(saved.arg && saved.entry);
                    if (argOnboarding.state.completed) argOnboarding.syncCalibration(true);
                } catch (err) { /* noop */ }
            },

            syncCalibration(silent = false) {
                const argVal = argOnboarding.state.arg;
                const entryVal = argOnboarding.state.entry;
                const argBtn = document.querySelector(`[data-cal-group="arg"][data-cal-choice="${argVal}"]`);
                const entryBtn = document.querySelector(`[data-cal-group="entry"][data-cal-choice="${entryVal}"]`);
                if (typeof calibrationGate !== 'undefined') {
                    if (argVal !== null && typeof argVal !== 'undefined') calibrationGate.setArg(argVal === 'yes', argBtn || undefined);
                    if (entryVal) calibrationGate.setEntry(entryVal, entryBtn || undefined);
                }
                if (argOnboarding.state.completed && !silent) {
                    argOnboarding.updateStatus('Calibration synced with the main gate.', 'success');
                }
            },

            open() {
                if (argOnboarding.modal) argOnboarding.modal.classList.add('active');
                document.body.classList.add('modal-open');
            },
            dismiss() {
                if (argOnboarding.modal) argOnboarding.modal.classList.remove('active');
                document.body.classList.remove('modal-open');
            },
            maybeShow(force = false) {
                if (force || !argOnboarding.state.completed) argOnboarding.open();
            }
        };

        const calibrationGate = {
            state: { arg: null, entry: null, lights: new Set() },

            reset() {
                this.state = { arg: null, entry: null, lights: new Set() };
                document.querySelectorAll('.cal-choice').forEach(btn => btn.classList.remove('bg-white', 'text-black', 'border-black', 'ring-2', 'ring-red-500'));
                document.querySelectorAll('.cal-light').forEach(box => { box.checked = false; });

                const stageSelect = document.getElementById('prof-stage-select');
                if (stageSelect) stageSelect.classList.add('hidden');
                const locked = document.getElementById('prof-stage-locked');
                if (locked) locked.classList.remove('hidden');

                const status = document.getElementById('calibration-status');
                if (status) {
                    status.textContent = 'Set your lumen level to tune how much satire you see.';
                    status.className = 'font-mono text-xs uppercase tracking-widest text-gray-200 md:text-left text-center';
                }

                const readout = document.getElementById('lumen-readout');
                if (readout) readout.textContent = 'Lumen Level: Unset';
            },

            setArg(val, el) {
                this.state.arg = val;
                this.highlight('arg', el);
                this.updateStatus();
            },

            setEntry(val, el) {
                this.state.entry = val;
                this.highlight('entry', el);
                this.updateStatus();
            },

            toggleLight(key, checked) {
                if (checked) this.state.lights.add(key);
                else this.state.lights.delete(key);
            },

            highlight(group, el) {
                document.querySelectorAll(`[data-cal-group="${group}"]`).forEach(btn => btn.classList.remove('bg-white', 'text-black', 'border-black', 'ring-2', 'ring-red-500'));
                if (el) el.classList.add('bg-white', 'text-black', 'border-black', 'ring-2', 'ring-red-500');
            },

            updateStatus(msg = 'Set your lumen level to tune how much satire you see.', variant = 'muted') {
                const status = document.getElementById('calibration-status');
                if (!status) return;
                status.textContent = msg;
                status.className = 'font-mono text-xs uppercase tracking-widest md:text-left text-center';
                if (variant === 'error') status.classList.add('text-red-200');
                else if (variant === 'success') status.classList.add('text-green-200');
                else status.classList.add('text-gray-200');
            },

            computeLumen() {
                const entry = this.state.entry === 'blind' ? 'Restrained Chaos' : 'Implementation Architect';
                const arg = this.state.arg ? 'ARG-Ready' : 'New Signal';
                const labels = { history: 'History', form: 'Form', intent: 'Intent' };
                const light = this.state.entry === 'light'
                    ? (this.state.lights.size ? Array.from(this.state.lights).map(k => labels[k]).join(' / ') : 'Context Requested')
                    : 'Diegetic Blindfold';
                return `${entry} — ${light} (${arg})`;
            },

            confirm() {
                if (this.state.arg === null || this.state.entry === null) {
                    this.updateStatus('Answer both queries to set your Lumen Level.', 'error');
                    return;
                }

                if (this.state.entry === 'light' && this.state.lights.size === 0) {
                    this.updateStatus('Pick at least one Light explainer to carry.', 'error');
                    return;
                }

                const label = this.computeLumen();
                const readout = document.getElementById('lumen-readout');
                if (readout) readout.textContent = `Lumen Level: ${label}`;
                this.updateStatus('Calibration stored. Proceed to the Identity Assessment when ready.', 'success');

                const stageSelect = document.getElementById('prof-stage-select');
                if (stageSelect) stageSelect.classList.remove('hidden');
                const locked = document.getElementById('prof-stage-locked');
                if (locked) locked.classList.add('hidden');
            }
        };

        // --- PROFILER LOGIC (QUIZ) ---
        const profiler = {
            initialChoice: null,
            scores: { dreamer: 0, scholar: 0, investor: 0, passerby: 0, lantern: 0 },
            currentQ: 0,
            lastWinner: null,
            lastTitle: '',
            lastProfile: null,
            shareTimeout: null,

            init: () => {
                calibrationGate.reset();
                document.getElementById('prof-stage-doubt').classList.add('hidden');
                document.getElementById('prof-stage-quiz').classList.add('hidden');
                document.getElementById('prof-stage-process').classList.add('hidden');
                document.getElementById('prof-banner').classList.add('hidden');
                document.getElementById('quiz-modal').classList.remove('active');
                document.body.classList.remove('modal-open');
                document.getElementById('prof-result-card').classList.add('hidden');
                document.getElementById('sculpture-generator').classList.add('hidden');
                const totalEl = document.getElementById('quiz-total');
                if (totalEl) totalEl.innerText = QUIZ.length;
                profiler.scores = { dreamer: 0, scholar: 0, investor: 0, passerby: 0, lantern: 0 };
                profiler.currentQ = 0;
                profiler.initialChoice = null;
                profiler.lastWinner = null;
                profiler.lastTitle = '';
                const readout = document.getElementById('sculpture-readout');
                if (readout) {
                    readout.innerHTML = `<div class="text-[10px] uppercase tracking-widest text-gray-500">Awaiting prompt...</div><p class="text-sm text-gray-700">Run the quiz and generate a specimen to see the deterministic voxel sketch and dossier.</p>`;
                }
            },

            select: (role, el) => {
                audio.click();
                profiler.initialChoice = role;
                const target = el || null;
                document.querySelectorAll('.role-card').forEach(c => c.classList.remove('selected'));
                if (target) target.classList.add('selected');
                setTimeout(() => {
                    document.getElementById('prof-stage-select').classList.add('hidden');
                    document.getElementById('prof-stage-doubt').classList.remove('hidden');
                }, 500);
            },

            reset: () => {
                audio.click();
                profiler.init();
            },

            startQuiz: () => {
                audio.click();
                document.getElementById('prof-stage-doubt').classList.add('hidden');
                document.getElementById('prof-stage-quiz').classList.remove('hidden');
                document.getElementById('prof-stage-process').classList.add('hidden');
                document.getElementById('quiz-modal').classList.add('active');
                document.body.classList.add('modal-open');
                profiler.renderQuestion();
            },

            renderQuestion: () => {
                const q = QUIZ[profiler.currentQ];
                document.getElementById('quiz-num').innerText = profiler.currentQ + 1;
                document.getElementById('quiz-q').innerText = q.q;
                
                const optsContainer = document.getElementById('quiz-options');
                optsContainer.innerHTML = '';
                
                // Shuffle options
                const shuffled = q.opts.sort(() => 0.5 - Math.random());
                
                shuffled.forEach(opt => {
                    const btn = document.createElement('button');
                    btn.className = "w-full text-left border border-gray-300 p-4 hover:bg-black hover:text-white transition-colors font-mono text-sm ui-click";
                    btn.innerText = `> ${opt.txt}`;
                    btn.onclick = () => profiler.answer(opt);
                    optsContainer.appendChild(btn);
                });
            },

            answer: (opt) => {
                audio.click();
                profiler.scores[opt.type] += opt.score;
                profiler.currentQ++;
                if (profiler.currentQ < QUIZ.length) {
                    profiler.renderQuestion();
                } else {
                    profiler.calculate();
                }
            },

            calculate: () => {
                document.getElementById('prof-stage-quiz').classList.add('hidden');
                document.getElementById('prof-stage-process').classList.remove('hidden');

                // Determine Winner
                let maxScore = -1;
                let winner = profiler.initialChoice; // Default to self-selection
                
                for (const [key, val] of Object.entries(profiler.scores)) {
                    if (val > maxScore) {
                        maxScore = val;
                        winner = key;
                    }
                }

                // Dual Title Logic
                const adj = ROLES[profiler.initialChoice || winner].adj;
                const noun = winner.toUpperCase();
                const finalTitle = profiler.initialChoice === winner ? `THE PURE ${noun}` : `THE ${adj} ${noun}`;

                profiler.lastWinner = winner;
                profiler.lastTitle = finalTitle;

                profiler.runTypewriter(finalTitle, winner);
            },

            runTypewriter: (title, winnerKey) => {
                const lines = [
                    "Analyzing inputs...",
                    "Comparing against self-perception...",
                    "Detecting dissonance...",
                    "Re-calibrating identity matrix...",
                    "Classification Complete."
                ];
                const container = document.getElementById('decon-lines');
                container.innerHTML = '';
                let delay = 0;
                lines.forEach((line) => {
                    delay += 800 + Math.random() * 500;
                    setTimeout(() => {
                        container.innerHTML += `<div class="fade-in">> ${line}</div>`;
                        if (state.synth) state.synth.triggerAttackRelease("32n", Tone.now());
                    }, delay);
                });

                setTimeout(() => {
                    profiler.showResult(title, winnerKey);
                }, delay + 1000);
            },

            showResult: (title, winnerKey) => {
                document.getElementById('prof-stage-process').classList.add('hidden');
                profiler.closeModal();

                const banner = document.getElementById('prof-banner');
                banner.classList.remove('hidden');
                document.getElementById('banner-title').innerText = title;
                document.getElementById('banner-motto').innerText = ROLES[winnerKey].motto;

                const resultCard = document.getElementById('prof-result-card');
                resultCard.classList.remove('hidden');
                document.getElementById('result-title').innerText = title;
                document.getElementById('result-motto').innerText = ROLES[winnerKey].motto;

                const sculptor = document.getElementById('sculpture-generator');
                sculptor.classList.remove('hidden');
                profiler.generateSculpture();

                if (state.synth) state.synth.triggerAttackRelease("C4", "8n");
            },

            closeModal: () => {
                const modal = document.getElementById('quiz-modal');
                modal.classList.remove('active');
                document.body.classList.remove('modal-open');
            },

            buildProfile: () => {
                const mat = document.getElementById('sculpture-material').value;
                const fmt = document.getElementById('sculpture-format').value;
                const role = profiler.lastWinner || 'dreamer';
                const palettes = {
                    dreamer: ['#1f2a7e', '#d6d5cc', '#f5d9c3'],
                    scholar: ['#7d6338', '#f6f0e6', '#0f172a'],
                    investor: ['#c0c6cc', '#1b1b1b', '#1db954'],
                    passerby: ['#7fb3ff', '#9ca3af', '#f4f4f5'],
                    lantern: ['#d13f23', '#111111', '#f7c99a']
                };
                const gestures = {
                    dreamer: 'spiraling helix with soft gaps',
                    scholar: 'stacked folios with interlocking bands',
                    investor: 'angled plinths with mirrored insets',
                    passerby: 'offset slabs that almost slip',
                    lantern: 'caged beam held by vertical struts'
                };

                const totalScore = Object.values(profiler.scores).reduce((a, b) => a + b, 0) || 1;
                const alignment = Math.min(99, Math.round((profiler.scores[role] / totalScore) * 42) + 55);
                const seedText = `${state.sessionNonce}-${role}-${fmt}-${mat}-${profiler.lastTitle || 'specimen'}`;
                const hash = sculptureEngine.hash(seedText).toString(36).slice(0, 5).toUpperCase();

                return {
                    role,
                    material: mat,
                    format: fmt,
                    palette: palettes[role] || palettes.dreamer,
                    gesture: gestures[role] || gestures.dreamer,
                    alignment,
                    seedText,
                    hash,
                    specimenId: `Specimen-${role.slice(0, 3).toUpperCase()}-${hash}`,
                    anomalies: [
                        `Role deviation: ${Math.max(2, 100 - alignment)}% mismatch from cohort`,
                        `Pulse ingress: ${Math.round(alignment * 0.23)}bps`,
                        `Void pockets: ${(7 + (alignment % 5)).toFixed(1)}cm`
                    ]
                };
            },

            renderSculptureReadout: (profile) => {
                const readout = document.getElementById('sculpture-readout');
                if (!readout) return;
                readout.innerHTML = `
                    <div class="text-[10px] uppercase tracking-widest text-red-600 mb-2">${profile.specimenId}</div>
                    <div class="space-y-1 text-gray-800">
                        <div class="font-bold text-sm">${profiler.lastTitle || 'Signal Artifact'}</div>
                        <div class="text-[11px] uppercase tracking-[0.25em] text-gray-500">${profile.format} • ${profile.material}</div>
                        <div class="text-sm">${profile.gesture} with creme/black/red controls.</div>
                    </div>
                    <div class="mt-3 space-y-1 text-[11px] uppercase tracking-widest text-gray-600">
                        <div>Alignment: ${profile.alignment}%</div>
                        <div>Seed: ${profile.hash}</div>
                        <div>Palette: ${profile.palette.join(' / ')}</div>
                    </div>
                    <div class="mt-3 text-[11px] text-gray-600 space-y-1">
                        ${profile.anomalies.map(a => `<div class="flex items-start gap-2"><span class="text-red-600">●</span><span>${a}</span></div>`).join('')}
                    </div>
                    <div class="mt-4 pt-3 border-t border-gray-200 space-y-2">
                        <div class="text-[10px] uppercase tracking-widest text-gray-500">Share Blueprint</div>
                        <div class="flex flex-wrap gap-2">
                            <button class="sculpture-share-button" onclick="profiler.shareBlueprint()">Share</button>
                            <button class="sculpture-share-button" onclick="profiler.copyBlueprint()">Copy Brief</button>
                            <button class="sculpture-share-button" onclick="profiler.downloadBlueprint()">Download</button>
                        </div>
                        <div id="sculpture-share-status" class="text-[10px] uppercase tracking-widest text-gray-500">Ready to distribute.</div>
                    </div>
                `;
            },

            generateSculpture: () => {
                const profile = profiler.buildProfile();
                profiler.lastProfile = profile;
                sculptureEngine.render(profile);
                profiler.renderSculptureReadout(profile);
            },

            getSharePayload: () => {
                if (!profiler.lastProfile) return null;
                const { specimenId, format, material, gesture, hash } = profiler.lastProfile;
                return {
                    title: `${specimenId} — ${profiler.lastTitle || 'Signal Artifact'}`,
                    text: `${gesture} built for ${format} (${material}). Seed ${hash}.`,
                    url: window.location.href.split('#')[0]
                };
            },

            flashShareStatus: (msg) => {
                const el = document.getElementById('sculpture-share-status');
                if (!el) return;
                el.innerText = msg;
                el.style.color = '#d31313';
                if (profiler.shareTimeout) clearTimeout(profiler.shareTimeout);
                profiler.shareTimeout = setTimeout(() => {
                    el.style.color = '';
                }, 1200);
            },

            copyBlueprint: async () => {
                const payload = profiler.getSharePayload();
                if (!payload || !navigator.clipboard) return profiler.flashShareStatus('Generate first.');
                const summary = `${payload.title}\n${payload.text}\n${payload.url}`;
                try {
                    await navigator.clipboard.writeText(summary);
                    profiler.flashShareStatus('Copied blueprint.');
                } catch (err) {
                    profiler.flashShareStatus('Clipboard blocked.');
                }
            },

            shareBlueprint: async () => {
                const payload = profiler.getSharePayload();
                if (!payload) return profiler.flashShareStatus('Generate first.');
                if (navigator.share) {
                    try {
                        await navigator.share(payload);
                        profiler.flashShareStatus('Shared.');
                    } catch (err) {
                        profiler.flashShareStatus('Share dismissed.');
                    }
                } else {
                    profiler.copyBlueprint();
                }
            },

            downloadBlueprint: () => {
                const payload = profiler.getSharePayload();
                if (!payload) return profiler.flashShareStatus('Generate first.');
                const dataUrl = sculptureEngine.exportImage();
                if (!dataUrl) return profiler.flashShareStatus('Preview not ready.');
                const link = document.createElement('a');
                link.href = dataUrl;
                link.download = `${payload.title.replace(/[^a-z0-9\- ]/gi, '').replace(/\s+/g, '_')}.png`;
                link.click();
                profiler.flashShareStatus('Preview downloaded.');
            }
        };
        window.profiler = profiler;

        const sculptureEngine = {
            renderer: null,
            scene: null,
            camera: null,
            container: null,
            rand: null,

            hash(text) {
                let h = 0;
                for (let i = 0; i < text.length; i++) {
                    h = Math.imul(31, h) + text.charCodeAt(i) | 0;
                }
                return Math.abs(h);
            },

            setSeed(seedText) {
                let seed = sculptureEngine.hash(seedText) || 1;
                sculptureEngine.rand = () => {
                    seed += 1;
                    const x = Math.sin(seed) * 10000;
                    return x - Math.floor(x);
                };
            },

            init() {
                sculptureEngine.container = document.getElementById('sculpture-canvas');
                if (!sculptureEngine.container) return;
                if (!sculptureEngine.renderer) {
                    sculptureEngine.renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true, canvas: sculptureEngine.container });
                }
                const bounds = sculptureEngine.container.getBoundingClientRect();
                sculptureEngine.renderer.setSize(bounds.width || 420, bounds.height || 260);

                sculptureEngine.camera = new THREE.PerspectiveCamera(40, (bounds.width || 420) / (bounds.height || 260), 0.1, 50);
                sculptureEngine.camera.position.set(3.2, 2.6, 4.8);
                sculptureEngine.camera.lookAt(0, 1, 0);

                sculptureEngine.scene = new THREE.Scene();
                sculptureEngine.scene.background = new THREE.Color('#f6f0e6');
            },

            resetScene() {
                if (!sculptureEngine.scene) return;
                while (sculptureEngine.scene.children.length) {
                    sculptureEngine.scene.remove(sculptureEngine.scene.children[0]);
                }

                sculptureEngine.scene.add(new THREE.AmbientLight('#f6f0e6', 0.55));
                const key = new THREE.DirectionalLight('#ffffff', 0.9);
                key.position.set(3, 6, 5);
                sculptureEngine.scene.add(key);
                const rim = new THREE.DirectionalLight('#d7342a', 0.35);
                rim.position.set(-4, 3, -2);
                sculptureEngine.scene.add(rim);

                const floor = new THREE.Mesh(new THREE.PlaneGeometry(10, 10), new THREE.MeshStandardMaterial({ color: '#ede7dc', metalness: 0.1, roughness: 0.8 }));
                floor.rotation.x = -Math.PI / 2;
                floor.position.y = -0.5;
                sculptureEngine.scene.add(floor);
            },

            randRange(min, max) {
                if (!sculptureEngine.rand) return min;
                return min + (max - min) * sculptureEngine.rand();
            },

            buildPrimitives(profile) {
                const group = new THREE.Group();
                const mode = sculptureEngine.randRange(0, 1) > 0.7 ? 'outline' : 'stacked';
                if (mode === 'outline') {
                    sculptureEngine.buildOutlineVariant(group);
                } else {
                    sculptureEngine.buildStackedVariant(group, profile);
                }

                sculptureEngine.scene.add(group);
            },

            buildStackedVariant(group, profile) {
                const voxelCount = 10 + Math.floor(sculptureEngine.randRange(0, 8));
                for (let i = 0; i < voxelCount; i++) {
                    const size = sculptureEngine.randRange(0.4, 1.2);
                    const cube = new THREE.Mesh(
                        new THREE.BoxGeometry(size, sculptureEngine.randRange(0.5, 1.6), size),
                        new THREE.MeshStandardMaterial({
                            color: profile.palette[i % profile.palette.length],
                            metalness: 0.35,
                            roughness: 0.4
                        })
                    );
                    cube.position.set(
                        sculptureEngine.randRange(-1.4, 1.4),
                        sculptureEngine.randRange(0.2, 2.2),
                        sculptureEngine.randRange(-1.4, 1.4)
                    );
                    cube.rotation.y = sculptureEngine.randRange(0, Math.PI * 2);
                    group.add(cube);

                    const edges = new THREE.LineSegments(new THREE.EdgesGeometry(cube.geometry), new THREE.LineBasicMaterial({ color: '#0f0f0f', linewidth: 1 }));
                    edges.position.copy(cube.position);
                    edges.rotation.copy(cube.rotation);
                    group.add(edges);
                }

                for (let i = 0; i < 4; i++) {
                    const rod = new THREE.Mesh(
                        new THREE.CylinderGeometry(0.05, 0.05, sculptureEngine.randRange(1.2, 2.8), 8),
                        new THREE.MeshStandardMaterial({ color: '#111111', metalness: 0.6, roughness: 0.25 })
                    );
                    rod.position.set(sculptureEngine.randRange(-1.6, 1.6), sculptureEngine.randRange(0.4, 2.4), sculptureEngine.randRange(-1.6, 1.6));
                    rod.rotation.z = sculptureEngine.randRange(-0.6, 0.6);
                    rod.rotation.x = sculptureEngine.randRange(-0.2, 0.2);
                    group.add(rod);
                }

                for (let i = 0; i < 3; i++) {
                    const voidBox = new THREE.Mesh(
                        new THREE.BoxGeometry(sculptureEngine.randRange(0.6, 1.3), sculptureEngine.randRange(0.4, 0.9), sculptureEngine.randRange(0.6, 1.3)),
                        new THREE.MeshStandardMaterial({ color: '#ffffff', transparent: true, opacity: 0.28, metalness: 0, roughness: 1 })
                    );
                    voidBox.position.set(sculptureEngine.randRange(-1.2, 1.2), sculptureEngine.randRange(0.6, 1.8), sculptureEngine.randRange(-1.2, 1.2));
                    group.add(voidBox);
                }

                const plate = new THREE.Mesh(new THREE.BoxGeometry(3.8, 0.1, 3.8), new THREE.MeshStandardMaterial({ color: '#0f0f0f', metalness: 0.7, roughness: 0.35 }));
                plate.position.y = 0;
                group.add(plate);

                const accent = new THREE.Mesh(
                    new THREE.PlaneGeometry(3.8, 0.2),
                    new THREE.MeshBasicMaterial({ color: '#d7342a' })
                );
                accent.rotation.x = -Math.PI / 2;
                accent.position.set(0, 0.06, -1.3);
                group.add(accent);
            },

            buildOutlineVariant(group) {
                const redLine = new THREE.LineBasicMaterial({ color: '#d31313', linewidth: 1.2 });
                const frameCount = 6 + Math.floor(sculptureEngine.randRange(0, 4));
                for (let i = 0; i < frameCount; i++) {
                    const box = new THREE.BoxGeometry(
                        sculptureEngine.randRange(0.8, 1.8),
                        sculptureEngine.randRange(0.4, 1.5),
                        sculptureEngine.randRange(0.8, 1.8)
                    );
                    const wire = new THREE.LineSegments(new THREE.EdgesGeometry(box), redLine.clone());
                    wire.position.set(
                        sculptureEngine.randRange(-1.6, 1.6),
                        sculptureEngine.randRange(0.3, 2.5),
                        sculptureEngine.randRange(-1.6, 1.6)
                    );
                    wire.rotation.y = sculptureEngine.randRange(0, Math.PI * 2);
                    wire.rotation.x = sculptureEngine.randRange(-0.3, 0.3);
                    group.add(wire);
                }

                const ringCount = 3 + Math.floor(sculptureEngine.randRange(0, 3));
                for (let i = 0; i < ringCount; i++) {
                    const torus = new THREE.TorusGeometry(sculptureEngine.randRange(0.6, 1.4), 0.02, 8, 32);
                    const torusWire = new THREE.LineSegments(new THREE.WireframeGeometry(torus), redLine.clone());
                    torusWire.position.set(
                        sculptureEngine.randRange(-0.8, 0.8),
                        sculptureEngine.randRange(0.5, 1.8),
                        sculptureEngine.randRange(-0.8, 0.8)
                    );
                    torusWire.rotation.x = sculptureEngine.randRange(0, Math.PI * 2);
                    torusWire.rotation.y = sculptureEngine.randRange(0, Math.PI * 2);
                    group.add(torusWire);
                }

                const plate = new THREE.LineSegments(
                    new THREE.EdgesGeometry(new THREE.BoxGeometry(3.8, 0.06, 3.8)),
                    redLine.clone()
                );
                plate.position.y = 0;
                group.add(plate);

                const halo = new THREE.LineSegments(
                    new THREE.WireframeGeometry(new THREE.CylinderGeometry(1.3, 1.3, 0.06, 28, 1, true)),
                    redLine.clone()
                );
                halo.rotation.x = Math.PI / 2;
                halo.position.y = 0.22;
                group.add(halo);
            },

            render(profile) {
                sculptureEngine.init();
                if (!sculptureEngine.renderer) return;
                sculptureEngine.setSeed(profile.seedText);
                sculptureEngine.resetScene();
                sculptureEngine.buildPrimitives(profile);
                sculptureEngine.renderer.render(sculptureEngine.scene, sculptureEngine.camera);
            },

            resize() {
                if (!sculptureEngine.renderer || !sculptureEngine.camera || !sculptureEngine.container) return;
                const bounds = sculptureEngine.container.getBoundingClientRect();
                sculptureEngine.camera.aspect = (bounds.width || 420) / (bounds.height || 260);
                sculptureEngine.camera.updateProjectionMatrix();
                sculptureEngine.renderer.setSize(bounds.width || 420, bounds.height || 260);
                sculptureEngine.renderer.render(sculptureEngine.scene, sculptureEngine.camera);
            },

            exportImage() {
                if (!sculptureEngine.renderer) return null;
                return sculptureEngine.renderer.domElement.toDataURL('image/png');
            }
        };
        window.sculptureEngine = sculptureEngine;

        // --- SHARED VALUE STATE ---
        const valueState = {
            tokens: 0,
            solved: new Set(),
            listeners: [],
            addToken(id) {
                if (valueState.solved.has(id)) return;
                valueState.solved.add(id);
                valueState.tokens += 1;
                audio.playTokenReward();
                valueState.emit();
            },
            emit() {
                valueState.listeners.forEach((fn) => fn(valueState));
            },
            subscribe(fn) {
                valueState.listeners.push(fn);
                fn(valueState);
            }
        };
        window.valueState = valueState;

        // --- GRIFT SHOP LOGIC ---
        const grift = {
            state: 'griftIdle',
            bound: false,
            boxClicks: 0,
            init() {
                if (grift.bound) {
                    grift.updateFromValueState(valueState);
                    return;
                }
                grift.bound = true;
                const slider = document.getElementById('coin-slider');
                if (slider) slider.addEventListener('input', grift.handleCoin);
                const tape = document.getElementById('box-tape');
                if (tape) tape.addEventListener('click', grift.handleBox);
                document.querySelectorAll('.timeshare-box').forEach((box) => box.addEventListener('change', grift.handleTimeshare));
                const submit = document.getElementById('timeshare-submit');
                if (submit) submit.addEventListener('click', (e) => { e.preventDefault(); grift.submitTimeshare(); });
                document.querySelectorAll('#paywall-options input[type="radio"]').forEach((opt) => opt.addEventListener('change', grift.handlePaywall));
                const termsFlag = document.getElementById('terms-flag');
                if (termsFlag) termsFlag.addEventListener('click', grift.handleTerms);
                document.querySelectorAll('.subscription-toggle').forEach((toggle) => toggle.addEventListener('change', grift.handleSubscription));
                document.querySelectorAll('#scam-options [data-scam]').forEach((btn) => btn.addEventListener('click', grift.handleScam));
                const bundle = document.getElementById('bundle-slider');
                if (bundle) bundle.addEventListener('input', grift.handleBundle);
                const fee = document.getElementById('receipt-fee');
                if (fee) fee.addEventListener('click', grift.handleReceipt);
                valueState.subscribe(grift.updateFromValueState);
                grift.handleTimeshare();
                grift.updateState('griftIdle');
            },
            updateFromValueState({ tokens, solved }) {
                const tokenLabels = [document.getElementById('token-count'), document.getElementById('ticket-status-tokens')];
                tokenLabels.forEach((el) => {
                    if (!el) return;
                    el.innerText = el.id === 'token-count' ? `${tokens}` : `${tokens} token${tokens === 1 ? '' : 's'}`;
                });

                let stateLabel = 'griftIdle';
                if (tokens >= 6) stateLabel = 'griftThresholdMet';
                else if (tokens >= 3) stateLabel = 'griftInOnJoke';
                else if (tokens >= 1) stateLabel = 'griftExploring';
                grift.updateState(stateLabel);

                const overlay = document.getElementById('grift-overlay');
                if (overlay) overlay.classList.toggle('hidden', tokens < 6);

                const hint = document.getElementById('grift-hint');
                if (hint) {
                    if (stateLabel === 'griftThresholdMet') hint.innerText = 'LOOMWORKS NOTE: applicant displays healthy suspicion. good.';
                    else if (stateLabel === 'griftInOnJoke') hint.innerText = 'you feel like you’re in on the joke now.';
                    else if (stateLabel === 'griftExploring') hint.innerText = 'keep poking the boxes. value leaks out.';
                    else hint.innerText = '';
                }

                if (solved.has('influencer-coin')) grift.setYield('coin-yield');
                if (solved.has('merch-box')) grift.setYield('box-yield');
                if (solved.has('timeshare')) grift.setYield('time-yield');
                if (solved.has('paywall')) grift.setYield('paywall-yield');
                if (solved.has('terms')) grift.setYield('terms-yield');
                if (solved.has('subscription')) grift.setYield('subscription-yield');
                if (solved.has('scam')) grift.setYield('scam-yield');
                if (solved.has('bundle')) grift.setYield('bundle-yield');
                if (solved.has('receipt')) grift.setYield('receipt-yield');
            },
            updateState(label) {
                grift.state = label;
                const stateLabel = document.getElementById('grift-state');
                if (stateLabel) stateLabel.innerText = label;
                const note = document.getElementById('grift-note');
                if (note) {
                    const copy = {
                        griftIdle: 'waiting for you to notice the seams.',
                        griftExploring: 'value under construction. keep digging.',
                        griftInOnJoke: 'copy shifts to conspiratorial whispers.',
                        griftThresholdMet: 'tickets still unavailable, but you are provisionally woven in.'
                    };
                    note.innerText = copy[label] || '';
                }
            },
            setYield(id) {
                const el = document.getElementById(id);
                if (el) el.innerText = 'Yield: 1 VALUE TOKEN';
            },
            handleCoin(e) {
                const val = Number(e?.target?.value || document.getElementById('coin-slider')?.value || 50);
                if (val <= 10 && !valueState.solved.has('influencer-coin')) {
                    valueState.addToken('influencer-coin');
                    const lore = document.getElementById('coin-lore');
                    if (lore) lore.innerText = 'congratulations, you’ve shorted pure hype. loomworks prefers craft.';
                    grift.setYield('coin-yield');
                }
            },
            handleBox() {
                grift.boxClicks += 1;
                const progress = document.getElementById('box-progress');
                const note = document.getElementById('box-note');
                const words = ['YOU', 'CAN', 'OPEN'];
                if (progress) progress.innerText = grift.boxClicks <= words.length ? words[grift.boxClicks - 1] : 'OPEN';
                if (grift.boxClicks >= 3 && !valueState.solved.has('merch-box')) {
                    valueState.addToken('merch-box');
                    if (note) note.classList.remove('hidden');
                    grift.setYield('box-yield');
                }
            },
            handleTimeshare() {
                const boxes = Array.from(document.querySelectorAll('.timeshare-box'));
                const allUnchecked = boxes.every((b) => !b.checked);
                const submit = document.getElementById('timeshare-submit');
                if (submit) {
                    submit.classList.toggle('cursor-not-allowed', !allUnchecked);
                    submit.classList.toggle('bg-gray-200', !allUnchecked);
                    submit.classList.toggle('text-gray-500', !allUnchecked);
                    submit.classList.toggle('bg-white', allUnchecked);
                    submit.classList.toggle('text-black', allUnchecked);
                }
            },
            submitTimeshare() {
                const submit = document.getElementById('timeshare-submit');
                if (submit && submit.classList.contains('cursor-not-allowed')) return;
                if (!valueState.solved.has('timeshare')) {
                    valueState.addToken('timeshare');
                    grift.setYield('time-yield');
                    const note = document.getElementById('timeshare-note');
                    if (note) note.innerText = 'you retained your hours. loomworks approves.';
                }
                if (submit) {
                    submit.innerText = 'Logged';
                    submit.classList.add('cursor-not-allowed');
                    submit.setAttribute('disabled', 'true');
                }
                document.querySelectorAll('.timeshare-box').forEach((box) => box.setAttribute('disabled', 'true'));
            },
            handlePaywall(e) {
                if (valueState.solved.has('paywall')) return;
                if (e?.target?.value === 'library') {
                    valueState.addToken('paywall');
                    const note = document.getElementById('paywall-note');
                    if (note) note.innerText = 'you honored labor and still got the knowledge.';
                    grift.setYield('paywall-yield');
                }
            },
            handleTerms() {
                if (valueState.solved.has('terms')) return;
                valueState.addToken('terms');
                const copy = document.getElementById('terms-copy');
                if (copy) copy.classList.add('ring', 'ring-red-500', 'bg-[#fff7eb]');
                const btn = document.getElementById('terms-flag');
                if (btn) btn.innerText = 'Clause flagged';
                grift.setYield('terms-yield');
            },
            handleSubscription() {
                const toggles = Array.from(document.querySelectorAll('.subscription-toggle'));
                const allOff = toggles.every((t) => !t.checked);
                const note = document.getElementById('subscription-note');
                if (note) note.innerText = allOff ? 'auto-renew dismantled. you kept your value.' : 'Slide everything off to reclaim your agency.';
                if (allOff && !valueState.solved.has('subscription')) {
                    valueState.addToken('subscription');
                    grift.setYield('subscription-yield');
                }
            },
            handleScam(e) {
                if (valueState.solved.has('scam')) return;
                const choice = e?.target?.dataset?.scam;
                const note = document.getElementById('scam-note');
                if (choice === 'right') {
                    valueState.addToken('scam');
                    if (note) note.innerText = 'you flagged the obvious grift. inbox safe.';
                    grift.setYield('scam-yield');
                } else if (note) {
                    note.innerText = 'that one might be legit; pick the real trap.';
                }
            },
            handleBundle(e) {
                const val = Number(e?.target?.value || document.getElementById('bundle-slider')?.value || 0);
                const note = document.getElementById('bundle-note');
                if (note) note.innerText = val <= 10 ? 'you cut the hype. only the art remains.' : 'Lower the slider until only what matters remains.';
                if (val <= 10 && !valueState.solved.has('bundle')) {
                    valueState.addToken('bundle');
                    grift.setYield('bundle-yield');
                }
            },
            handleReceipt() {
                if (valueState.solved.has('receipt')) return;
                const total = document.getElementById('receipt-total');
                const note = document.getElementById('receipt-note');
                if (total) total.innerText = '$25.00';
                if (note) note.innerText = 'fee rejected. the receipt breathes easier.';
                const fee = document.getElementById('receipt-fee');
                if (fee) {
                    fee.innerText = 'Fee removed';
                    fee.classList.add('line-through', 'bg-green-100', 'text-green-700');
                }
                valueState.addToken('receipt');
                grift.setYield('receipt-yield');
            }
        };
        window.grift = grift;

        // --- MANUFACTURE TOOL (16x16) ---
        const manufacture = {
            gridSize: 16,
            pixels: [],
            canvas: null,
            ctx: null,
            journeyCanvas: null,
            journeyCtx: null,
            currentColor: '#111',
            mode: 'grid-lines',
            drawing: false,
            bound: false,
            artifacts: [],
            journeyIndex: 0,
            journeyTimer: null,
            sharePercent: 0.000666,
            scenes: [
                {
                    label: 'Museum',
                    draw(ctx, cell, size) {
                        ctx.fillStyle = '#0b0b0b';
                        ctx.fillRect(0, 0, size, size);
                        ctx.fillStyle = '#161616';
                        ctx.fillRect(0, cell * 11, size, cell * 5);
                        ctx.fillStyle = '#f5f5dc';
                        ctx.fillRect(cell * 5, cell * 3.5, cell * 6, cell * 6);
                        ctx.strokeStyle = '#000';
                        ctx.lineWidth = 1;
                        ctx.strokeRect(cell * 5 + 0.5, cell * 3.5 + 0.5, cell * 6 - 1, cell * 6 - 1);
                        ctx.fillStyle = '#cd2b2b';
                        ctx.fillRect(cell * 7, cell * 5.5, cell * 2, cell * 2.5);
                        ctx.fillStyle = '#111';
                        ctx.fillRect(cell * 7.6, cell * 9.8, cell * 0.8, cell * 1.2);
                    }
                },
                {
                    label: 'Auction',
                    draw(ctx, cell, size) {
                        ctx.fillStyle = '#0a0a0a';
                        ctx.fillRect(0, 0, size, size);
                        ctx.fillStyle = '#1f1f1f';
                        ctx.fillRect(0, cell * 12, size, cell * 4);
                        ctx.fillStyle = '#8b5a2b';
                        ctx.fillRect(cell * 6, cell * 7, cell * 4, cell * 1.2);
                        ctx.fillRect(cell * 8.5, cell * 6.2, cell * 1.5, cell * 0.9);
                        ctx.fillStyle = '#f5f5dc';
                        ctx.fillRect(cell * 3, cell * 4, cell * 3, cell * 1);
                        ctx.fillRect(cell * 9.5, cell * 4, cell * 3, cell * 1);
                        ctx.fillStyle = '#cd2b2b';
                        ctx.fillRect(cell * 3, cell * 5, cell * 1, cell * 3);
                        ctx.fillRect(cell * 11.5, cell * 5, cell * 1, cell * 3);
                        ctx.fillStyle = '#00ffaa';
                        ctx.fillRect(cell * 5, cell * 2.5, cell * 6, cell * 1);
                    }
                },
                {
                    label: 'NFT Mint',
                    draw(ctx, cell, size) {
                        ctx.fillStyle = '#050505';
                        ctx.fillRect(0, 0, size, size);
                        for (let i = 0; i < 40; i++) {
                            const x = Math.floor(Math.random() * 16);
                            const y = Math.floor(Math.random() * 16);
                            ctx.fillStyle = ['#f5f5f5', '#cd2b2b', '#7c7c7c'][Math.floor(Math.random() * 3)];
                            ctx.fillRect(x * cell, y * cell, cell, cell);
                        }
                        ctx.strokeStyle = '#00c2ff';
                        ctx.lineWidth = 1.2;
                        ctx.strokeRect(cell * 4.5, cell * 4.5, cell * 7, cell * 7);
                        ctx.fillStyle = '#0b0b0b';
                        ctx.fillRect(cell * 6.5, cell * 6.5, cell * 3, cell * 3);
                    }
                }
            ],
            init() {
                manufacture.canvas = document.getElementById('manufacture-canvas');
                manufacture.journeyCanvas = document.getElementById('journey-canvas');
                if (!manufacture.canvas || !manufacture.journeyCanvas) return;
                if (!manufacture.bound) {
                    manufacture.ctx = manufacture.canvas.getContext('2d');
                    manufacture.journeyCtx = manufacture.journeyCanvas.getContext('2d');
                    manufacture.pixels = Array.from({ length: manufacture.gridSize }, () => Array(manufacture.gridSize).fill(null));
                    manufacture.bindCanvas();
                    manufacture.bindControls();
                    manufacture.bound = true;
                }
                manufacture.render();
                manufacture.startJourneyLoop();
            },
            bindCanvas() {
                const canvas = manufacture.canvas;
                const paint = (e) => {
                    const rect = canvas.getBoundingClientRect();
                    const x = Math.floor(((e.clientX - rect.left) / rect.width) * manufacture.gridSize);
                    const y = Math.floor(((e.clientY - rect.top) / rect.height) * manufacture.gridSize);
                    manufacture.paint(x, y);
                };
                canvas.addEventListener('mousedown', (e) => { manufacture.drawing = true; paint(e); });
                canvas.addEventListener('mousemove', (e) => { if (manufacture.drawing) paint(e); });
                window.addEventListener('mouseup', () => { manufacture.drawing = false; });
                canvas.addEventListener('mouseleave', () => { manufacture.drawing = false; });
            },
            bindControls() {
                document.querySelectorAll('.mode-btn').forEach((btn) => {
                    btn.addEventListener('click', () => manufacture.setMode(btn.dataset.mode));
                });
                document.querySelectorAll('#manufacture-swatches .swatch').forEach((swatch) => {
                    swatch.addEventListener('click', () => manufacture.setColor(swatch.dataset.color));
                });
                const clearBtn = document.getElementById('manufacture-clear');
                if (clearBtn) clearBtn.addEventListener('click', () => manufacture.clear());
                const submitBtn = document.getElementById('manufacture-submit');
                if (submitBtn) submitBtn.addEventListener('click', () => manufacture.submit());
            },
            setMode(mode) {
                if (!mode) return;
                manufacture.mode = mode;
                document.querySelectorAll('.mode-btn').forEach((btn) => btn.classList.toggle('active', btn.dataset.mode === mode));
                manufacture.render();
            },
            setColor(color) {
                manufacture.currentColor = color;
                document.querySelectorAll('#manufacture-swatches .swatch').forEach((swatch) => swatch.classList.toggle('active', swatch.dataset.color === color));
            },
            clear() {
                manufacture.pixels = Array.from({ length: manufacture.gridSize }, () => Array(manufacture.gridSize).fill(null));
                manufacture.render();
            },
            paint(x, y) {
                if (x < 0 || y < 0 || x >= manufacture.gridSize || y >= manufacture.gridSize) return;
                manufacture.pixels[y][x] = manufacture.currentColor === 'erase' ? null : manufacture.currentColor;
                manufacture.render();
            },
            render() {
                if (!manufacture.ctx || !manufacture.canvas) return;
                const size = manufacture.canvas.width;
                const cell = size / manufacture.gridSize;
                manufacture.ctx.clearRect(0, 0, size, size);
                manufacture.ctx.fillStyle = '#f5f5dc';
                manufacture.ctx.fillRect(0, 0, size, size);

                if (manufacture.mode === 'dilate') {
                    manufacture.renderDilated(cell);
                } else {
                    for (let y = 0; y < manufacture.gridSize; y++) {
                        for (let x = 0; x < manufacture.gridSize; x++) {
                            const color = manufacture.pixels[y][x];
                            if (!color) continue;
                            const gap = manufacture.mode === 'grid-gap' ? 1 : 0;
                            const offset = gap;
                            const drawSize = manufacture.mode === 'grid-gap' ? cell - gap * 2 : cell;
                            manufacture.ctx.fillStyle = color;
                            manufacture.ctx.fillRect(x * cell + offset, y * cell + offset, drawSize, drawSize);
                        }
                    }
                    if (manufacture.mode === 'grid-lines') manufacture.drawGridLines(cell);
                }
            },
            renderDilated(cell) {
                const visited = new Set();
                const size = manufacture.canvas.width;
                const key = (x, y) => `${x},${y}`;
                for (let y = 0; y < manufacture.gridSize; y++) {
                    for (let x = 0; x < manufacture.gridSize; x++) {
                        const color = manufacture.pixels[y][x];
                        if (!color || visited.has(key(x, y))) continue;
                        const queue = [[x, y]];
                        const region = [];
                        visited.add(key(x, y));
                        while (queue.length) {
                            const [cx, cy] = queue.shift();
                            region.push([cx, cy]);
                            const neighbors = [
                                [cx + 1, cy], [cx - 1, cy], [cx, cy + 1], [cx, cy - 1]
                            ];
                            neighbors.forEach(([nx, ny]) => {
                                if (nx < 0 || ny < 0 || nx >= manufacture.gridSize || ny >= manufacture.gridSize) return;
                                if (visited.has(key(nx, ny))) return;
                                if (manufacture.pixels[ny][nx] === color) {
                                    visited.add(key(nx, ny));
                                    queue.push([nx, ny]);
                                }
                            });
                        }

                        const xs = region.map(([rx]) => rx);
                        const ys = region.map(([, ry]) => ry);
                        const minX = Math.min(...xs);
                        const maxX = Math.max(...xs);
                        const minY = Math.min(...ys);
                        const maxY = Math.max(...ys);
                        const width = (maxX - minX + 1) * cell;
                        const height = (maxY - minY + 1) * cell;
                        const radius = Math.min(cell * 1.4, Math.min(width, height) / 2.2);
                        manufacture.ctx.fillStyle = color;
                        manufacture.roundRect(manufacture.ctx, minX * cell - 2, minY * cell - 2, width + 4, height + 4, radius);
                        manufacture.ctx.fill();
                    }
                }
                manufacture.ctx.strokeStyle = '#888';
                manufacture.ctx.lineWidth = 0.8;
                manufacture.ctx.strokeRect(0.4, 0.4, size - 0.8, size - 0.8);
            },
            drawGridLines(cell) {
                manufacture.ctx.strokeStyle = '#888';
                manufacture.ctx.lineWidth = 1;
                for (let i = 1; i < manufacture.gridSize; i++) {
                    manufacture.ctx.beginPath();
                    manufacture.ctx.moveTo(i * cell + 0.5, 0);
                    manufacture.ctx.lineTo(i * cell + 0.5, manufacture.canvas.height);
                    manufacture.ctx.stroke();
                    manufacture.ctx.beginPath();
                    manufacture.ctx.moveTo(0, i * cell + 0.5);
                    manufacture.ctx.lineTo(manufacture.canvas.width, i * cell + 0.5);
                    manufacture.ctx.stroke();
                }
            },
            roundRect(ctx, x, y, width, height, radius) {
                ctx.beginPath();
                ctx.moveTo(x + radius, y);
                ctx.lineTo(x + width - radius, y);
                ctx.quadraticCurveTo(x + width, y, x + width, y + radius);
                ctx.lineTo(x + width, y + height - radius);
                ctx.quadraticCurveTo(x + width, y + height, x + width - radius, y + height);
                ctx.lineTo(x + radius, y + height);
                ctx.quadraticCurveTo(x, y + height, x, y + height - radius);
                ctx.lineTo(x, y + radius);
                ctx.quadraticCurveTo(x, y, x + radius, y);
                ctx.closePath();
            },
            submit() {
                const nameInput = document.getElementById('manufacture-name');
                const name = (nameInput?.value || '').trim() || `Artifact ${manufacture.artifacts.length + 1}`;
                const filledPixels = manufacture.pixels.flat().filter(Boolean).length;
                const projectedRevenue = Math.max(12000, filledPixels * 64 + Math.random() * 18000);
                const shareDecimal = manufacture.sharePercent / 100;
                const shareValue = projectedRevenue * shareDecimal;

                manufacture.artifacts.unshift({
                    id: Date.now(),
                    name,
                    projectedRevenue,
                    shareValue,
                    percent: manufacture.sharePercent,
                    pixels: filledPixels
                });

                manufacture.renderReceipt(name, projectedRevenue, shareValue);
                manufacture.updatePortfolio();
            },
            renderReceipt(name, revenue, share) {
                const ticker = document.getElementById('receipt-ticker');
                if (!ticker) return;
                const line = `ECONOMIC TRANSPARENCY RECEIPT • ${name} • 0.000666% OF LIFETIME REVENUE • PROJECTED $${manufacture.formatCurrency(revenue)} • YOUR CUT $${manufacture.formatCurrency(share)}`;
                ticker.innerHTML = `<span>${line} // ${line} // ${line}</span>`;
                ticker.classList.remove('paused');
            },
            updatePortfolio() {
                const grid = document.getElementById('portfolio-grid');
                const total = document.getElementById('portfolio-total');
                const totalPercent = manufacture.artifacts.length * manufacture.sharePercent;
                if (total) total.innerText = `${manufacture.artifacts.length} submissions • ${totalPercent.toFixed(6)}% accrued`;
                if (!grid) return;
                grid.innerHTML = '';
                manufacture.artifacts.slice(0, 12).forEach((artifact) => {
                    const card = document.createElement('div');
                    card.className = 'portfolio-card';
                    card.innerHTML = `
                        <div class="font-bold text-sm">${artifact.name}</div>
                        <div class="text-xs font-mono uppercase tracking-[0.2em] text-gray-600">0.000666% Share</div>
                        <div class="text-sm font-mono">Lifetime: $${manufacture.formatCurrency(artifact.projectedRevenue)}</div>
                        <div class="text-sm font-mono text-red-700">Your Cut: $${manufacture.formatCurrency(artifact.shareValue)}</div>
                        <div class="text-[10px] text-gray-500 font-mono">${artifact.pixels} pixels archived</div>
                    `;
                    grid.appendChild(card);
                });
            },
            startJourneyLoop() {
                if (manufacture.journeyTimer) return;
                manufacture.renderJourney();
                manufacture.journeyTimer = setInterval(() => manufacture.renderJourney(), 1800);
            },
            renderJourney() {
                if (!manufacture.journeyCtx || !manufacture.journeyCanvas) return;
                const scene = manufacture.scenes[manufacture.journeyIndex % manufacture.scenes.length];
                const cell = manufacture.journeyCanvas.width / manufacture.gridSize;
                scene.draw(manufacture.journeyCtx, cell, manufacture.journeyCanvas.width);
                const label = document.getElementById('journey-label');
                if (label) label.innerText = scene.label;
                manufacture.journeyIndex += 1;
            },
            formatCurrency(value) {
                return new Intl.NumberFormat('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 }).format(value);
            }
        };
        window.manufacture = manufacture;

        // --- BARTER SHOP + TRANSPARENCY VIEW ---
        const barter = {
            mode: 'shop',
            data: null,
            bound: false,
            async init() {
                if (!barter.data) {
                    try {
                        const res = await fetch('static/data/barter-catalog.json');
                        barter.data = await res.json();
                    } catch (err) {
                        console.error('Failed to load barter catalog', err);
                        return;
                    }
                }

                if (!barter.bound) barter.bindControls();
                barter.render();
                ticketing.setTiers(barter.data.ticketingTiers || []);
                ticketing.setStations(barter.data.activities || []);
            },
            bindControls() {
                const shopBtn = document.getElementById('barter-shop-btn');
                const transBtn = document.getElementById('barter-transparency-btn');
                if (shopBtn) shopBtn.onclick = () => barter.setMode('shop');
                if (transBtn) transBtn.onclick = () => barter.setMode('transparency');
                barter.bound = true;
                barter.updateModeButtons();
            },
            setMode(mode) {
                barter.mode = mode;
                barter.updateModeButtons();
                barter.render();
            },
            updateModeButtons() {
                const shopBtn = document.getElementById('barter-shop-btn');
                const transBtn = document.getElementById('barter-transparency-btn');
                const activeClasses = ['bg-black', 'text-white'];
                const inactiveClasses = ['bg-white', 'text-black'];
                if (shopBtn) {
                    shopBtn.classList.remove(...activeClasses, ...inactiveClasses);
                    shopBtn.classList.add('border', 'border-black', 'ui-click', 'px-3', 'py-2', 'text-[10px]', 'font-mono', 'uppercase', 'tracking-widest', 'hover:bg-black', 'hover:text-white', 'transition-colors');
                    shopBtn.classList.add(...(barter.mode === 'shop' ? activeClasses : inactiveClasses));
                }
                if (transBtn) {
                    transBtn.classList.remove(...activeClasses, ...inactiveClasses);
                    transBtn.classList.add('border', 'border-black', 'ui-click', 'px-3', 'py-2', 'text-[10px]', 'font-mono', 'uppercase', 'tracking-widest', 'hover:bg-black', 'hover:text-white', 'transition-colors');
                    transBtn.classList.add(...(barter.mode === 'transparency' ? activeClasses : inactiveClasses));
                }
            },
            render() {
                if (!barter.data) return;
                barter.renderItems();
                barter.renderStreams();
                barter.renderBundles();
                barter.renderActivities();
            },
            renderItems() {
                const grid = document.getElementById('barter-grid');
                if (!grid) return;
                grid.innerHTML = '';

                barter.data.items.forEach((item) => {
                    const margin = barter.margin(item);
                    const inventory = barter.formatInventory(item.inventory);
                    const card = document.createElement('div');
                    card.className = 'border border-gray-300 bg-white p-4 hover:shadow-xl transition-shadow';
                    card.innerHTML = `
                        <div class="flex justify-between items-start mb-1">
                            <div class="font-mono text-[10px] uppercase tracking-widest text-gray-500">${barter.streamLabel(item.stream)} • ${item.category}</div>
                            <span class="font-mono text-[10px] text-gray-500">${item.sku}</span>
                        </div>
                        <h4 class="font-bold text-lg uppercase leading-tight">${item.name}</h4>
                        <p class="text-xs font-mono text-gray-600 mb-3">${item.tagline || ''}</p>
                        ${barter.mode === 'shop'
                            ? `<div class="flex justify-between items-center mb-3"><span class="font-bold text-xl">$${item.price.toFixed(2)}</span><span class="text-[10px] uppercase font-mono text-gray-500">${inventory}</span></div>`
                            : `<div class="space-y-1 mb-3 text-sm"><div class="font-mono text-[11px] uppercase tracking-widest text-gray-700">Cost: $${item.unitCost.toFixed(2)} • Margin: ${margin !== null ? margin + '%' : '—'}</div><div class="text-xs text-gray-600">Inventory bands: ${inventory}</div></div>`
                        }
                        <button class="w-full bg-black text-white text-xs uppercase py-3 min-h-[44px] hover:bg-red-600 transition-colors">${barter.mode === 'shop' ? 'Add to Pull Sheet' : 'View Unit Economics'}</button>
                    `;
                    grid.appendChild(card);
                });
            },
            renderStreams() {
                const grid = document.getElementById('barter-stream-grid');
                if (!grid) return;
                grid.innerHTML = '';

                barter.data.revenueStreams.forEach((stream) => {
                    const count = barter.data.items.filter((item) => item.stream === stream.id).length;
                    const card = document.createElement('div');
                    card.className = 'bg-white border border-gray-200 p-4 shadow-sm';
                    card.innerHTML = `
                        <div class="font-mono text-[10px] uppercase tracking-widest text-gray-500 mb-2">${stream.label}</div>
                        <p class="text-sm text-gray-700 mb-3">${stream.description}</p>
                        <div class="flex items-center justify-between text-xs font-mono uppercase tracking-widest text-gray-600">
                            <span>${count} SKUs</span>
                            <span>${stream.formats.join(' • ')}</span>
                        </div>
                    `;
                    grid.appendChild(card);
                });
            },
            renderBundles() {
                const grid = document.getElementById('barter-bundle-grid');
                if (!grid) return;
                grid.innerHTML = '';

                barter.data.bundles.forEach((bundle) => {
                    const margin = barter.margin(bundle);
                    const card = document.createElement('div');
                    card.className = 'border border-gray-300 bg-white p-4 shadow-sm hover:shadow-lg transition-shadow';
                    card.innerHTML = `
                        <div class="flex justify-between items-start mb-1">
                            <div class="font-mono text-[10px] uppercase tracking-widest text-gray-500">${barter.streamLabel(bundle.stream)}</div>
                            <span class="font-mono text-[10px] text-gray-500">${bundle.sku}</span>
                        </div>
                        <h4 class="font-bold text-lg uppercase leading-tight">${bundle.name}</h4>
                        <p class="text-xs text-gray-600 font-mono mb-3">${bundle.tagline}</p>
                        <ul class="text-xs text-gray-700 mb-3 list-disc list-inside space-y-1">${(bundle.contents || []).map((c) => `<li>${c}</li>`).join('')}</ul>
                        ${barter.mode === 'shop'
                            ? `<div class="font-bold text-xl mb-3">$${bundle.price.toFixed(2)}</div>`
                            : `<div class="font-mono text-[11px] uppercase tracking-widest text-gray-700 mb-3">Cost: $${bundle.unitCost.toFixed(2)} • Margin: ${margin !== null ? margin + '%' : '—'}</div>`
                        }
                        <button class="w-full bg-black text-white text-xs uppercase py-2 hover:bg-red-600 transition-colors">${barter.mode === 'shop' ? 'Secure Bundle' : 'Inspect Economics'}</button>
                    `;
                    grid.appendChild(card);
                });
            },
            renderActivities() {
                const grid = document.getElementById('barter-activity-grid');
                if (!grid) return;
                grid.innerHTML = '';

                barter.data.activities.forEach((activity) => {
                    const card = document.createElement('div');
                    card.className = 'bg-white border border-gray-200 p-4 shadow-sm hover:shadow-lg transition-shadow';
                    card.innerHTML = `
                        <div class="font-mono text-[10px] uppercase tracking-widest text-gray-500 mb-1">${activity.location}</div>
                        <h4 class="font-bold text-lg uppercase leading-tight">${activity.name}</h4>
                        <p class="text-sm text-gray-700 mb-2">${activity.notes}</p>
                        <div class="flex items-center justify-between text-xs font-mono uppercase tracking-widest text-gray-600">
                            <span>Status: ${activity.status}</span>
                            <span>${barter.mode === 'transparency' ? 'Revenue map node' : 'On-floor anchor'}</span>
                        </div>
                    `;
                    grid.appendChild(card);
                });
            },
            margin(entry) {
                if (!entry || typeof entry.price !== 'number' || typeof entry.unitCost !== 'number') return null;
                return Math.round(((entry.price - entry.unitCost) / entry.price) * 100);
            },
            formatInventory(inv = {}) {
                if (!inv.min && !inv.opt && !inv.max) return 'Inventory: adaptive';
                return `Min ${inv.min || '—'} / Opt ${inv.opt || '—'} / Max ${inv.max || '—'}`;
            },
            streamLabel(id) {
                const found = barter.data.revenueStreams.find((s) => s.id === id);
                return found ? found.label : 'Stream';
            }
        };
        window.barter = barter;

        const ticketing = {
            tiers: [],
            stations: [],
            setTiers(tiers) {
                ticketing.tiers = tiers;
                ticketing.render();
            },
            setStations(stations) {
                ticketing.stations = stations;
                ticketing.render();
            },
            open() {
                const modal = document.getElementById('ticketing-modal');
                if (modal) modal.classList.add('active');
                document.body.classList.add('modal-open');
            },
            close() {
                const modal = document.getElementById('ticketing-modal');
                if (modal) modal.classList.remove('active');
                document.body.classList.remove('modal-open');
            },
            render() {
                const container = document.getElementById('ticketing-tiers');
                const stationsList = document.getElementById('ticketing-stations');
                if (!container) return;
                container.innerHTML = '';
                if (stationsList) stationsList.innerHTML = '';
                ticketing.tiers.forEach((tier) => {
                    const card = document.createElement('div');
                    card.className = 'border border-gray-300 bg-white p-4 rounded-xl shadow-sm hover:shadow-lg transition-shadow';
                    card.innerHTML = `
                        <div class="font-mono text-[10px] uppercase tracking-widest text-gray-500">${tier.tier}</div>
                        <div class="text-2xl font-bold">$${tier.price.toFixed(2)}</div>
                        <ul class="text-sm text-gray-700 mt-3 space-y-1 list-disc list-inside">
                            ${(tier.perks || []).map((p) => `<li>${p}</li>`).join('')}
                        </ul>
                        <div class="mt-3 text-[11px] font-mono uppercase tracking-widest text-gray-500">${tier.idealFor || ''}</div>
                        <button class="ui-click mt-4 w-full bg-black text-white text-xs uppercase py-2 hover:bg-red-600 transition-colors">Claim ${tier.tier}</button>
                    `;
                    container.appendChild(card);
                });

                if (stationsList && ticketing.stations.length) {
                    ticketing.stations.forEach((station) => {
                        const card = document.createElement('div');
                        card.className = 'bg-white border border-gray-200 p-3 rounded-lg shadow-sm';
                        card.innerHTML = `
                            <div class="text-[10px] font-mono uppercase tracking-widest text-red-600">${station.location || 'Station'}</div>
                            <div class="font-bold text-base">${station.name}</div>
                            <p class="text-xs text-gray-700 leading-snug">${station.notes || ''}</p>
                            <div class="text-[10px] font-mono uppercase tracking-[0.2em] text-gray-500">${station.status || ''}</div>
                        `;
                        stationsList.appendChild(card);
                    });
                }
            }
        };
        window.ticketing = ticketing;

        const geoQuiz = {
            step: 0,
            completed: false,
            questions: [
                {
                    title: '“Brick” hits your ears on Canal Street. What are they warning you about?',
                    copy: 'New Yorkers weaponize understatement. Decode the emoji, dodge the frostbite.',
                    options: [
                        { emoji: '🧊', label: 'Arctic wind slicing between the avenues.', hint: 'Layer up or turn back.', toast: 'Confirmed: you know “brick” is freeze-your-face cold.', correct: true },
                        { emoji: '🛑', label: 'NYPD sweeping for alternate-side violators.', hint: 'Different kind of ticket.', toast: 'Nice paranoia, but “brick” isn’t a parking scare.' },
                        { emoji: '💪', label: 'Time to flex at an Equinox stairwell selfie.', hint: 'Respect the hustle.', toast: 'Bold move. Wrong slang axis though.' }
                    ]
                },
                {
                    title: 'A friend orders a chopped cheese run. Where are you headed?',
                    copy: 'No couriers; no apps. Just you, a grill, and a hum of fluorescent lights.',
                    options: [
                        { emoji: '🧀', label: 'The bodega flat-top under the humming fan.', hint: 'Cash only, wrapped in foil.', toast: 'Correct. You can smell the hero bread already.', correct: true },
                        { emoji: '💈', label: 'Your barber who swears he “also chefs.”', hint: 'Please don’t.', toast: 'Sharp fade, questionable sandwich.' },
                        { emoji: '🎲', label: 'An alley dice game off the J train.', hint: 'Different hustle.', toast: 'That’s a different kind of chopped.' }
                    ]
                },
                {
                    title: 'Someone taps you and says “you’ve got schmutz.” What happens next?',
                    copy: 'Yiddish lives on the subway. Handle it like you belong.',
                    options: [
                        { emoji: '🫟', label: 'Swipe the face, keep moving before the doors close.', hint: 'Efficient correction.', toast: 'True local move: wipe and ride.', correct: true },
                        { emoji: '♀️', label: 'Strike a Lady Liberty pose and hope for the best.', hint: 'Patriotism is not a napkin.', toast: 'Statuesque, but no.' },
                        { emoji: '🥴', label: 'Tell them the city’s energy is the real smudge.', hint: 'Meta, but messy.', toast: 'Points for poetry, not for cleanliness.' }
                    ]
                }
            ],
            init() {
                geoQuiz.reset();
            },
            start() {
                audio.click();
                geoQuiz.completed = false;
                geoQuiz.step = 0;
                geoQuiz.render();
            },
            reset() {
                const stage = document.getElementById('geo-quiz-stage');
                const status = document.getElementById('geo-quiz-status');
                const card = document.getElementById('geo-quiz-card');
                const step = document.getElementById('geo-quiz-step');
                if (stage) stage.classList.add('hidden');
                if (status) status.innerText = 'Tap verify to begin.';
                if (card) card.innerHTML = '';
                if (step) step.innerText = `0/${geoQuiz.questions.length}`;
                geoQuiz.step = 0;
                geoQuiz.completed = false;
                valueGate.updateTokens(valueState);
            },
            render() {
                const stage = document.getElementById('geo-quiz-stage');
                const status = document.getElementById('geo-quiz-status');
                const card = document.getElementById('geo-quiz-card');
                const step = document.getElementById('geo-quiz-step');
                if (!stage || !status || !card || !step) return;
                stage.classList.remove('hidden');
                const q = geoQuiz.questions[geoQuiz.step];
                step.innerText = `${geoQuiz.step + 1}/${geoQuiz.questions.length}`;
                status.innerText = 'Pick the tile that feels right.';
                card.innerHTML = `
                    <div class="bg-[#FDFBF7] border border-black/10 rounded-xl p-4 shadow-sm space-y-2">
                        <div class="flex items-center justify-between gap-2">
                            <span class="text-[10px] font-mono uppercase tracking-[0.25em] text-red-600">Bodega Banter Check</span>
                            <span class="text-[10px] font-mono uppercase tracking-[0.25em] text-gray-600">No wrong answers, just vibes.</span>
                        </div>
                        <h4 class="text-xl font-bold uppercase leading-tight">${q.title}</h4>
                        <p class="text-sm text-gray-700">${q.copy}</p>
                        <div class="grid sm:grid-cols-3 gap-3 pt-2" id="geo-quiz-options"></div>
                    </div>
                `;

                const optionsWrap = document.getElementById('geo-quiz-options');
                if (!optionsWrap) return;
                optionsWrap.innerHTML = '';
                q.options.forEach((opt) => {
                    const tile = document.createElement('button');
                    tile.className = 'geo-quiz-tile ui-click border border-gray-200';
                    tile.innerHTML = `
                        <div class="text-3xl">${opt.emoji}</div>
                        <div class="text-sm font-mono text-gray-800 leading-snug">${opt.label}</div>
                        <div class="text-[10px] font-mono uppercase tracking-widest text-gray-500">${opt.hint}</div>
                    `;
                    tile.onclick = () => geoQuiz.choose(opt, tile);
                    optionsWrap.appendChild(tile);
                });
            },
            choose(opt, tile) {
                audio.click();
                document.querySelectorAll('.geo-quiz-tile').forEach((btn) => btn.classList.remove('selected'));
                tile.classList.add('selected');
                const status = document.getElementById('geo-quiz-status');
                if (status) status.innerText = opt.toast || 'Noted.';
                setTimeout(() => {
                    geoQuiz.step += 1;
                    if (geoQuiz.step < geoQuiz.questions.length) geoQuiz.render();
                    else geoQuiz.complete();
                }, 480);
            },
            complete() {
                const card = document.getElementById('geo-quiz-card');
                const status = document.getElementById('geo-quiz-status');
                const step = document.getElementById('geo-quiz-step');
                if (step) step.innerText = `${geoQuiz.questions.length}/${geoQuiz.questions.length}`;
                if (status) status.innerText = 'Stamped: ready for the ticket gate.';
                if (card) {
                    card.innerHTML = `
                        <div class="bg-black text-white rounded-xl p-5 border border-red-500 shadow-lg space-y-3">
                            <div class="font-mono text-[10px] uppercase tracking-widest text-red-200">Validated • New Yorker Enough</div>
                            <h4 class="text-2xl font-bold uppercase">Geospatial Compatibility Confirmed</h4>
                            <p class="text-sm text-gray-100 leading-relaxed">You clocked the slang and kept it moving. The ticketing tiers are unlocked without embarrassing anyone’s borough.</p>
                            <div class="flex flex-wrap gap-2">
                                <button onclick="ticketing.open()" class="ui-click bg-white text-black px-4 py-2 text-[10px] font-mono uppercase tracking-widest hover:bg-red-600 hover:text-white transition-colors">Return to Ticket Tiers</button>
                                <button onclick="geoQuiz.reset()" class="ui-click border border-white/40 text-xs font-mono uppercase tracking-widest px-3 py-2 hover:bg-white hover:text-black transition-colors">Re-run Quiz</button>
                            </div>
                        </div>
                    `;
                }
                geoQuiz.completed = true;
                geoQuiz.step = 0;
                valueGate.updateTokens(valueState);
            }
        };
        window.geoQuiz = geoQuiz;

        const valueGate = {
            bound: false,
            raffleIndex: 0,
            prizes: [
                'one (1) insight',
                'zero (0) dollars',
                'a better question',
                '.hero silhouette'
            ],
            init() {
                if (valueGate.bound) {
                    valueGate.updateTokens(valueState);
                    return;
                }
                valueGate.bound = true;
                const form = document.getElementById('email-stub-form');
                if (form) form.addEventListener('submit', valueGate.submitEmail);
                const raffle = document.getElementById('raffle-box');
                if (raffle) raffle.addEventListener('click', valueGate.spinRaffle);
                valueState.subscribe(valueGate.updateTokens);
            },
            submitEmail(e) {
                e.preventDefault();
                const input = e.target.querySelector('input[type="email"]');
                const status = document.getElementById('email-stub-status');
                const value = input?.value || '';
                console.log('Stub email capture:', value);
                if (typeof localStorage !== 'undefined') {
                    try { localStorage.setItem('loomworks_interest', value); } catch (err) { /* noop */ }
                }
                if (status) status.innerHTML = 'APPLICATION RECEIVED*<br><span class="opacity-60">*not legally binding. nothing here is.</span>';
            },
            spinRaffle() {
                const prizeEl = document.getElementById('raffle-prize');
                if (!prizeEl) return;
                const glitchChance = Math.random() < 0.18;
                if (glitchChance) {
                    prizeEl.innerText = '.hero silhouette';
                    prizeEl.classList.add('text-red-600');
                    setTimeout(() => prizeEl.classList.remove('text-red-600'), 500);
                    return;
                }
                valueGate.raffleIndex = (valueGate.raffleIndex + 1) % valueGate.prizes.length;
                prizeEl.innerText = valueGate.prizes[valueGate.raffleIndex];
            },
            updateTokens({ tokens }) {
                const status = document.getElementById('ticket-status');
                const unlock = document.getElementById('ticket-unlock');
                const pill = document.getElementById('ticket-status-pill');
                const tokenDisplay = document.getElementById('ticket-status-tokens');
                const unlockCta = document.getElementById('ticket-unlock-cta');
                const tokensReady = tokens >= 6;
                const quizReady = !!geoQuiz.completed;
                const fullyReady = tokensReady && quizReady;

                if (status) {
                    status.innerText = fullyReady
                        ? 'Ticketing unlocked. Claim a tier or RSVP below.'
                        : tokensReady
                            ? 'Tokens logged. Pass the NYC slang quiz 🗽 to open ticketing.'
                            : 'tickets unavailable. collect 6 of 9 grift tokens, then pass the NYC slang quiz 🗽.';
                }
                if (unlock) {
                    unlock.classList.toggle('hidden', !tokensReady);
                    const note = unlock.querySelector('p');
                    if (note) note.innerText = fullyReady
                        ? 'Ticketing ready. Open the tiers or lock an RSVP stub.'
                        : 'Tokens recorded. Finish the slang quiz to unlock the tiers.';
                }
                if (tokenDisplay) tokenDisplay.innerText = `${tokens} token${tokens === 1 ? '' : 's'}`;
                if (pill) {
                    const label = pill.querySelector('span');
                    if (label) label.innerText = fullyReady
                        ? 'Status: ticketing unlocked'
                        : tokensReady ? 'Status: provisionally woven' : 'Status: measuring';
                }
                if (unlockCta) {
                    unlockCta.disabled = !tokensReady;
                    unlockCta.classList.toggle('cursor-not-allowed', !tokensReady);
                    unlockCta.classList.toggle('opacity-60', !tokensReady);
                    if (!tokensReady) {
                        unlockCta.innerText = 'Collect value tokens first';
                        unlockCta.onclick = null;
                    } else if (!quizReady) {
                        unlockCta.innerText = 'Run the slang quiz';
                        unlockCta.onclick = () => { ticketing.open(); geoQuiz.start(); };
                    } else {
                        unlockCta.innerText = 'Open ticketing tiers';
                        unlockCta.onclick = () => ticketing.open();
                    }
                }
                valueGate.updateTicketAction(tokensReady, quizReady);
            },
            updateTicketAction(tokensReady, quizReady) {
                const button = document.getElementById('ticket-action');
                const tooltip = document.getElementById('ticket-action-tooltip');
                if (!button) return;
                const base = 'w-full border border-black px-4 py-3 uppercase text-xs tracking-widest';
                button.onclick = null;

                if (!tokensReady) {
                    button.className = `${base} bg-gray-200 text-gray-500 cursor-not-allowed`;
                    button.innerText = 'Try to buy ticket';
                    button.disabled = true;
                    if (tooltip) {
                        tooltip.textContent = 'Denied: insufficient value artifacts.';
                        tooltip.classList.remove('hidden');
                    }
                    return;
                }

                if (!quizReady) {
                    button.className = `${base} bg-gray-200 text-gray-700 cursor-not-allowed`;
                    button.innerText = 'Pass the slang quiz';
                    button.disabled = true;
                    if (tooltip) {
                        tooltip.textContent = 'NYC slang quiz required to unlock tiers.';
                        tooltip.classList.remove('hidden');
                    }
                    return;
                }

                button.className = `${base} bg-black text-white hover:bg-red-700 transition-colors`;
                button.innerText = 'Open ticketing tiers';
                button.onclick = () => ticketing.open();
                button.disabled = false;
                if (tooltip) {
                    tooltip.textContent = 'Ticketing unlocked. Claim your slot.';
                    tooltip.classList.add('hidden');
                }
            }
        };

        const dimeBacklogEntries = [
            {
                id: 'DIME-LOG-00A',
                phase: 'PRE',
                label: 'FOUND SOMETHING IN THE CLOSET',
                body: "loomworks wants a 'childhood artifact that still feels real.' i don't have the <span class=\"redact\"><span class=\"bar\">[REDACTED]</span><span class=\"floaty\">FREE!</span></span> anymore, but i remember how she sat on the edge of my bed and asked what i wanted to be when i grew up.\n\n i told her: 'the one holding the clipboard.'",
                channel: 'journal',
                visualTag: 'memo',
                ambiguousTime: 'SHIFT ∅ / 0x.00'
            },
            {
                id: 'DIME-LOG-02C',
                phase: 'APPLY',
                label: 'SUBMIT: IMAGINARY FRIEND',
                body: `Q04: SUBMIT YOUR MOST PERSISTENT COMPANION.\n\n> DIME: she was called <span class="redact"><span class="bar">[REDACTED]</span><span class="floaty">FREE!</span></span>. she knew how to untangle knots in my headphones.\n> SYSTEM: INPUT ACCEPTED. COMPANION CLASSIFIED AS .hero PROTOTYPE.\n> SYSTEM: VALUE POTENTIAL: <span class="redact"><span class="bar">[REDACTED]</span><span class="floaty">THANK YOU</span></span> / 10`,
                channel: 'chat',
                visualTag: 'glitch',
                ambiguousTime: 'SHIFT ? / 0x.1F'
            },
            {
                id: 'DIME-LOG-07X',
                phase: 'PENDING',
                label: 'INTAKE ANOMALY',
                body: 'THREAD FLAGGED APPLICANT MEMORY FOR FURTHER WEAVING.\nNOTE: SUBJECT REPORTS COMPANION WITH PUNCTUATION ANTENNAE.\n\nOUTCOME: .hero ROUTED TO LANTERN WORKS DIVISION FOR STAGECRAFT TRIALS.',
                channel: 'sys',
                visualTag: 'flag',
                ambiguousTime: 'SHIFT [REDACTED]'
            },
            {
                id: 'DIME-LOG-0AF',
                phase: 'SCREEN',
                label: 'ECHO CHECK',
                body: 'INTAKE_NODE_3: please confirm you no longer see her in mirrors.\nINTERN_DIME: haha what?? uhhh. no?? maybe once??\nINTAKE_NODE_3: noted. <span class="redact"><span class="bar">[REDACTED]</span><span class="floaty">FREE!</span></span> silhouette still stabilizing.',
                channel: 'chat',
                visualTag: 'glitch',
                ambiguousTime: 'SHIFT ∆ / 0x.3B'
            },
            {
                id: 'DIME-LOG-11E',
                phase: '??',
                label: 'BACKLOG DRIFT',
                body: 'ambient note: hero ping registered near locker hallway. dim light warped like heat shimmer.\nINTERN_DIME: "okay sooo weird question but…\nwas anyone else humming that song or was that just me lol"\nSYSTEM NOTE: applicant value index: <span class="redact"><span class="bar">[REDACTED]</span><span class="floaty">VALUE</span></span>.',
                channel: 'note',
                visualTag: 'free',
                ambiguousTime: 'SHIFT ? / 0x.AE'
            }
        ].sort(() => Math.random() - 0.5);

        const dimeBacklog = {
            entries: dimeBacklogEntries,
            selectedId: null,
            freed: 0,
            booted: false,
            spoilerCode: '1678',
            spoilerInput: '',
            spoilerUnlocked: false,
            open() {
                const modal = document.getElementById('dime-backlog-modal');
                if (modal) modal.classList.add('active');
                document.body.classList.add('modal-open');
                dimeBacklog.ensureBoot();
            },
            close() {
                const modal = document.getElementById('dime-backlog-modal');
                if (modal) modal.classList.remove('active');
                document.body.classList.remove('modal-open');
                dimeBacklog.closeSpoilerGate();
            },
            ensureBoot() {
                if (dimeBacklog.booted) return;
                const boot = document.getElementById('dime-boot');
                const container = document.getElementById('dime-log-container');
                setTimeout(() => {
                    if (boot) boot.classList.add('hidden');
                    if (container) container.classList.remove('hidden');
                    dimeBacklog.renderList();
                    dimeBacklog.select(dimeBacklog.entries[0]?.id);
                    dimeBacklog.booted = true;
                    dimeBacklog.bindSpoiler();
                }, 500 + Math.random() * 280);
            },
            bind() {
                const trigger = document.getElementById('dime-backlog-trigger');
                const closeBtn = document.getElementById('dime-backlog-close');
                const modal = document.getElementById('dime-backlog-modal');
                const list = document.getElementById('dime-log-list');
                if (trigger) trigger.addEventListener('click', dimeBacklog.open);
                if (closeBtn) closeBtn.addEventListener('click', dimeBacklog.close);
                if (modal) modal.addEventListener('click', (e) => { if (e.target === modal) dimeBacklog.close(); });
                if (list) list.addEventListener('scroll', () => { if (Math.random() < 0.12) dimeBacklog.triggerGlitch(); });
            },
            renderList() {
                const list = document.getElementById('dime-log-list');
                if (!list) return;
                list.innerHTML = '';
                dimeBacklog.entries.forEach((entry) => {
                    const card = document.createElement('button');
                    card.className = `w-full text-left border border-black/20 rounded-xl px-3 py-3 bg-white dime-log-card ${dimeBacklog.selectedId === entry.id ? 'active' : ''}`;
                    card.innerHTML = `
                        <div class="flex items-center justify-between text-[10px] font-mono uppercase tracking-widest text-gray-600">
                            <span>${entry.phase} • ${entry.channel}</span>
                            <span>${entry.ambiguousTime}</span>
                        </div>
                        <div class="font-bold uppercase leading-tight">${entry.label}</div>
                        <div class="text-[10px] font-mono uppercase tracking-[0.2em] text-gray-500">${entry.id}</div>
                    `;
                    card.onclick = () => {
                        dimeBacklog.select(entry.id);
                        if (Math.random() < 0.18) dimeBacklog.triggerGlitch();
                    };
                    list.appendChild(card);
                });
            },
            select(id) {
                if (!id) return;
                dimeBacklog.selectedId = id;
                dimeBacklog.renderList();
                const entry = dimeBacklog.entries.find((e) => e.id === id);
                dimeBacklog.renderDetail(entry);
            },
            renderDetail(entry) {
                const detail = document.getElementById('dime-log-detail');
                if (!detail || !entry) return;
                const bodyHtml = `<p>${entry.body.replace(/\n\n/g, '</p><p>').replace(/\n/g, '<br>')}</p>`;
                detail.innerHTML = `
                    <div class="flex items-start justify-between gap-3">
                        <div>
                            <div class="text-[10px] font-mono uppercase tracking-[0.3em] text-gray-500">${entry.phase} • ${entry.channel} • ${entry.ambiguousTime}</div>
                            <div class="text-2xl font-bold uppercase tracking-tight">${entry.label}</div>
                            <div class="text-xs font-mono uppercase tracking-[0.2em] text-gray-600">${entry.id}</div>
                        </div>
                        ${entry.visualTag ? `<div class="value-pill">${entry.visualTag}</div>` : ''}
                    </div>
                    <div class="text-sm text-gray-800 leading-relaxed space-y-2">${bodyHtml}</div>
                    <div class="text-[10px] font-mono uppercase tracking-[0.25em] text-gray-600 freed-count">Freed redactions: ${dimeBacklog.freed}</div>
                    <div id="dime-hero-hint" class="text-[10px] font-mono uppercase tracking-[0.25em] text-red-600"></div>
                `;
                dimeBacklog.attachRedactions(detail);
                dimeBacklog.maybeHero();
            },
            attachRedactions(container) {
                container.querySelectorAll('.redact').forEach((node) => {
                    if (node.dataset.bound) return;
                    node.dataset.bound = '1';
                    node.addEventListener('mouseenter', () => {
                        if (!node.classList.contains('revealed')) {
                            node.classList.add('revealed');
                            dimeBacklog.freed += 1;
                            dimeBacklog.updateFreedLabel();
                            dimeBacklog.maybeHero();
                            dimeBacklog.triggerGlitch();
                        }
                    });
                });
            },
            triggerGlitch() {
                const glitch = document.getElementById('dime-glitch');
                if (!glitch) return;
                glitch.classList.add('glitching');
                setTimeout(() => glitch.classList.remove('glitching'), 180);
            },
            updateFreedLabel() {
                const freedLabel = document.querySelector('#dime-log-detail .freed-count');
                if (freedLabel) freedLabel.innerText = `Freed redactions: ${dimeBacklog.freed}`;
            },
            maybeHero() {
                const hint = document.getElementById('dime-hero-hint');
                if (!hint) return;
                if (dimeBacklog.freed >= 3) hint.innerText = 'HERO REVEAL CANDIDATE: silhouette pinged. keep hovering.';
                else if (dimeBacklog.freed >= 1) hint.innerText = 'redaction scrub registered. buffer wobble detected.';
                else hint.innerText = 'hover the redactions; system listens.';
            },
            bindSpoiler() {
                const launch = document.getElementById('spoiler-launch');
                const pad = document.getElementById('spoiler-pad-layer');
                const padClose = document.getElementById('spoiler-pad-close');
                const keys = document.querySelectorAll('[data-spoiler-key]');
                const lore = document.getElementById('spoiler-lore');
                dimeBacklog.resetSpoilerPad();
                if (launch) launch.addEventListener('click', dimeBacklog.openSpoilerGate);
                if (padClose) padClose.addEventListener('click', dimeBacklog.closeSpoilerGate);
                if (pad) pad.addEventListener('click', (e) => { if (e.target === pad) dimeBacklog.closeSpoilerGate(); });
                keys.forEach((btn) => btn.addEventListener('click', () => dimeBacklog.pressSpoilerKey(btn.dataset.spoilerKey)));
                if (lore) lore.addEventListener('scroll', dimeBacklog.handleLoreScroll);
                dimeBacklog.handleLoreScroll();
            },
            openSpoilerGate() {
                const pad = document.getElementById('spoiler-pad-layer');
                dimeBacklog.resetSpoilerPad();
                if (pad) pad.classList.add('active');
                document.body.classList.add('modal-open');
            },
            closeSpoilerGate() {
                const pad = document.getElementById('spoiler-pad-layer');
                const backlogModal = document.getElementById('dime-backlog-modal');
                if (pad) pad.classList.remove('active');
                if (!backlogModal || !backlogModal.classList.contains('active')) {
                    document.body.classList.remove('modal-open');
                }
            },
            pressSpoilerKey(key) {
                if (key === '←') {
                    dimeBacklog.spoilerInput = dimeBacklog.spoilerInput.slice(0, -1);
                } else if (key === '✶') {
                    dimeBacklog.resetSpoilerPad();
                } else if (dimeBacklog.spoilerInput.length < 4 && /\d/.test(key)) {
                    dimeBacklog.spoilerInput += key;
                }
                dimeBacklog.updateSpoilerDisplay();
                if (dimeBacklog.spoilerInput.length === 4) dimeBacklog.checkSpoilerCode();
            },
            resetSpoilerPad() {
                dimeBacklog.spoilerInput = '';
                dimeBacklog.updateSpoilerDisplay('Code required: 1678');
            },
            updateSpoilerDisplay(statusText) {
                const display = document.getElementById('spoiler-display');
                const status = document.getElementById('spoiler-pad-status');
                const chip = document.getElementById('spoiler-status-chip');
                const padded = dimeBacklog.spoilerInput.padEnd(4, '_').split('').join(' ');
                if (display) display.innerText = padded;
                if (status) status.innerText = statusText || 'Enter punch code';
                if (chip) chip.innerText = dimeBacklog.spoilerUnlocked ? 'Unlocked' : 'Locked';
                if (chip) chip.classList.toggle('text-green-600', dimeBacklog.spoilerUnlocked);
                if (chip) chip.classList.toggle('text-red-600', !dimeBacklog.spoilerUnlocked);
            },
            checkSpoilerCode() {
                if (dimeBacklog.spoilerInput === dimeBacklog.spoilerCode) {
                    dimeBacklog.spoilerUnlocked = true;
                    dimeBacklog.updateSpoilerDisplay('ACCESS GRANTED // Loom hums.');
                    dimeBacklog.revealSpoiler();
                    setTimeout(dimeBacklog.closeSpoilerGate, 420);
                } else {
                    dimeBacklog.updateSpoilerDisplay('Incorrect sequence. Buffer glitch.');
                    dimeBacklog.triggerGlitch();
                }
            },
            revealSpoiler() {
                const spoiler = document.getElementById('spoiler-reveal');
                if (spoiler) spoiler.classList.remove('hidden');
                dimeBacklog.handleLoreScroll();
            },
            handleLoreScroll() {
                const lore = document.getElementById('spoiler-lore');
                if (!lore) return;
                const progress = lore.scrollHeight > lore.clientHeight ? lore.scrollTop / (lore.scrollHeight - lore.clientHeight) : 0;
                lore.style.setProperty('--progress', progress.toFixed(3));
                lore.classList.toggle('dark', progress > 0.5);
            }
        };
        window.dimeBacklog = dimeBacklog;

        // --- 3D GALLERY ENGINE ---
        const gallery = {
            scene: null, camera: null, renderer: null, controls: null, active: false,
            frames: [],
            editMode: false,
            selectedFrame: null,
            lanternGroup: null,
            lanternLight: null,
            lanternTimer: null,
            init: () => {
                const container = document.getElementById('canvas-container');
                gallery.scene = new THREE.Scene();
                gallery.scene.background = new THREE.Color('#0f0f0f');
                gallery.scene.fog = new THREE.Fog('#0f0f0f', 10, 50);
                gallery.camera = new THREE.PerspectiveCamera(50, window.innerWidth / window.innerHeight, 0.1, 100);
                gallery.camera.position.set(0, 6, 22);
                gallery.renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
                gallery.renderer.setSize(window.innerWidth, window.innerHeight);
                container.appendChild(gallery.renderer.domElement);
                gallery.controls = new OrbitControls(gallery.camera, gallery.renderer.domElement);
                gallery.controls.enableDamping = true;

                const ambient = new THREE.AmbientLight(0xffffff, 0.45);
                gallery.scene.add(ambient);
                const spot = new THREE.SpotLight(0xffffff, 1.2, 80, Math.PI / 4, 0.3);
                spot.position.set(12, 18, 12);
                gallery.scene.add(spot);

                // Room shell
                const room = new THREE.Mesh(new THREE.BoxGeometry(40, 18, 40), new THREE.MeshStandardMaterial({ color: '#e1ddd1', side: THREE.BackSide, roughness: 0.8 }));
                room.position.y = 9;
                gallery.scene.add(room);
                const floor = new THREE.Mesh(new THREE.PlaneGeometry(40, 40), new THREE.MeshStandardMaterial({ color: '#eae7dc', roughness: 0.9 }));
                floor.rotation.x = -Math.PI / 2;
                gallery.scene.add(floor);

                gallery.bindUI();
                gallery.loadFrames();
                gallery.animate();
            },
            bindUI: () => {
                const unlockBtn = document.getElementById('gallery-edit-btn');
                const addBtn = document.getElementById('gallery-add-btn');
                const resetBtn = document.getElementById('gallery-reset-btn');
                const panel = document.getElementById('gallery-editor-panel');
                const status = document.getElementById('gallery-edit-status');

                if (unlockBtn) {
                    unlockBtn.onclick = () => {
                        const pwd = document.getElementById('gallery-edit-password').value.trim();
                        if (pwd.toLowerCase() === 'loomworks') {
                            gallery.editMode = true;
                            panel.classList.remove('hidden');
                            status.innerText = 'Edit Mode';
                            status.classList.remove('text-gray-500');
                            status.classList.add('text-red-600');
                        } else {
                            status.innerText = 'Denied';
                            status.classList.add('text-red-600');
                        }
                    };
                }

                if (addBtn) addBtn.onclick = gallery.addOrUpdateFrame;
                if (resetBtn) resetBtn.onclick = gallery.resetLayout;
            },
            loadFrames: () => {
                const saved = localStorage.getItem('loomworks-gallery');
                const defaults = [
                    { id: 'a', w: 4, h: 5, x: -6, y: 5, z: -5, label: 'Archive Print' },
                    { id: 'b', w: 3, h: 3, x: 0, y: 4, z: -6, label: 'Lantern Study' },
                    { id: 'c', w: 5, h: 4, x: 6, y: 5, z: -5, label: 'Disney Provenance' }
                ];
                gallery.frames = saved ? JSON.parse(saved) : defaults;
                gallery.frames.forEach(gallery.addFrameMesh);
                gallery.refreshList();
            },
            saveFrames: () => {
                localStorage.setItem('loomworks-gallery', JSON.stringify(gallery.frames));
                gallery.refreshList();
            },
            refreshList: () => {
                const list = document.getElementById('gallery-frame-list');
                if (!list) return;
                list.innerHTML = '';
                gallery.frames.forEach((frame) => {
                    const btn = document.createElement('button');
                    btn.className = 'w-full text-left border border-gray-200 px-2 py-1 bg-white hover:bg-black hover:text-white transition-colors text-[10px] font-mono';
                    btn.innerText = `${frame.label || 'Work'} (${frame.w}×${frame.h})`;
                    btn.onclick = () => gallery.populateForm(frame);
                    list.appendChild(btn);
                });
            },
            populateForm: (frame) => {
                gallery.selectedFrame = frame.id;
                document.getElementById('frame-width').value = frame.w;
                document.getElementById('frame-height').value = frame.h;
                document.getElementById('frame-x').value = frame.x;
                document.getElementById('frame-y').value = frame.y;
                document.getElementById('frame-z').value = frame.z;
                document.getElementById('frame-label').value = frame.label || '';
            },
            removeFrameMeshes: (id) => {
                const obj = gallery.scene.getObjectByName(`frame-${id}`);
                const glass = gallery.scene.getObjectByName(`frame-glass-${id}`);
                if (obj) gallery.scene.remove(obj);
                if (glass) gallery.scene.remove(glass);
            },
            addFrameMesh: (frame) => {
                const artGeo = new THREE.BoxGeometry(frame.w, frame.h, 0.2);
                const artMat = new THREE.MeshStandardMaterial({ color: '#1f1f1f', metalness: 0.6, roughness: 0.4 });
                const art = new THREE.Mesh(artGeo, artMat);
                art.position.set(frame.x, frame.y, frame.z);
                art.name = `frame-${frame.id}`;
                gallery.scene.add(art);

                const glass = new THREE.Mesh(new THREE.PlaneGeometry(frame.w * 0.95, frame.h * 0.95), new THREE.MeshStandardMaterial({ color: '#a5b7ff', transparent: true, opacity: 0.15, metalness: 0.5, roughness: 0.05 }));
                glass.position.set(frame.x, frame.y, frame.z + 0.12);
                glass.name = `frame-glass-${frame.id}`;
                gallery.scene.add(glass);
            },
            addOrUpdateFrame: () => {
                if (!gallery.editMode) return;
                const w = parseFloat(document.getElementById('frame-width').value) || 3;
                const h = parseFloat(document.getElementById('frame-height').value) || 3;
                const x = parseFloat(document.getElementById('frame-x').value) || 0;
                const y = parseFloat(document.getElementById('frame-y').value) || 4;
                const z = parseFloat(document.getElementById('frame-z').value) || -5;
                const label = document.getElementById('frame-label').value || 'Work';
                const id = gallery.selectedFrame || Math.random().toString(36).slice(2, 7);

                gallery.frames = gallery.frames.filter(f => f.id !== id);
                const frame = { id, w, h, x, y, z, label };
                gallery.removeFrameMeshes(id);
                gallery.frames.push(frame);
                gallery.addFrameMesh(frame);
                gallery.saveFrames();
                gallery.selectedFrame = null;
            },
            resetLayout: () => {
                gallery.frames.forEach(f => gallery.removeFrameMeshes(f.id));
                localStorage.removeItem('loomworks-gallery');
                gallery.frames = [];
                gallery.loadFrames();
            },
            resize: () => {
                if(!gallery.camera) return;
                gallery.camera.aspect = window.innerWidth / window.innerHeight;
                gallery.camera.updateProjectionMatrix();
                gallery.renderer.setSize(window.innerWidth, window.innerHeight);
            },
            animate: () => {
                requestAnimationFrame(gallery.animate);
                if (gallery.active && gallery.controls) {
                    gallery.controls.update();
                    if (gallery.lanternGroup) gallery.lanternGroup.rotation.y += 0.004;
                    gallery.renderer.render(gallery.scene, gallery.camera);
                }
            },
            stopLanternEffects: () => {
                const grain = document.getElementById('lantern-grain');
                if (grain) grain.classList.add('hidden');
                if (gallery.lanternTimer) { clearInterval(gallery.lanternTimer); gallery.lanternTimer = null; }
                if (gallery.lanternGroup) { gallery.scene.remove(gallery.lanternGroup); gallery.lanternGroup = null; }
                if (gallery.lanternLight) { gallery.scene.remove(gallery.lanternLight); gallery.lanternLight = null; }
                audio.stopLantern();
            },
            launchLanternOverlay: (trigger = '') => {
                app.navigate('gallery');
                gallery.stopLanternEffects();
                const grain = document.getElementById('lantern-grain');
                if (grain) grain.classList.remove('hidden');
                audio.startLantern();

                const group = new THREE.Group();
                const frameMat = new THREE.MeshStandardMaterial({ color: '#0f1628', metalness: 0.92, roughness: 0.22 });
                const frame = new THREE.Mesh(new THREE.CylinderGeometry(1.1, 1.1, 2.8, 6, 1, true), frameMat);
                frame.position.set(0, 5, 0);
                group.add(frame);

                const strutGeo = new THREE.BoxGeometry(0.12, 2.9, 0.35);
                for (let i = 0; i < 6; i++) {
                    const strut = new THREE.Mesh(strutGeo, new THREE.MeshStandardMaterial({ color: '#111826', metalness: 0.8, roughness: 0.3 }));
                    strut.position.set(Math.cos((Math.PI * 2 * i) / 6) * 0.9, 5, Math.sin((Math.PI * 2 * i) / 6) * 0.9);
                    group.add(strut);
                }

                const glass = new THREE.Mesh(
                    new THREE.CylinderGeometry(0.85, 0.9, 2.5, 24, 1, true),
                    new THREE.MeshPhysicalMaterial({ color: '#f7fbff', transparent: true, opacity: 0.28, metalness: 0.3, roughness: 0.05, transmission: 0.7, thickness: 0.5 })
                );
                glass.position.set(0, 5, 0);
                group.add(glass);

                const core = new THREE.Mesh(new THREE.CapsuleGeometry(0.28, 1.2, 8, 16), new THREE.MeshStandardMaterial({ color: '#ff9c3d', emissive: '#ffb347', emissiveIntensity: 1.8, metalness: 0.4, roughness: 0.15 }));
                core.position.set(0, 5, 0);
                group.add(core);

                const base = new THREE.Mesh(new THREE.CylinderGeometry(1.4, 1.6, 0.35, 6), new THREE.MeshStandardMaterial({ color: '#0b101d', metalness: 0.9, roughness: 0.25 }));
                base.position.set(0, 3.6, 0);
                group.add(base);

                const topPlate = new THREE.Mesh(new THREE.CylinderGeometry(1.2, 1.3, 0.25, 6), frameMat);
                topPlate.position.set(0, 6.2, 0);
                group.add(topPlate);

                const handle = new THREE.Mesh(new THREE.TorusGeometry(0.9, 0.08, 10, 28), new THREE.MeshStandardMaterial({ color: '#cfd9ff', metalness: 0.8, roughness: 0.2 }));
                handle.position.set(0, 6.6, 0);
                handle.rotation.x = Math.PI / 2;
                group.add(handle);

                group.name = 'lantern-group';
                gallery.scene.add(group);
                gallery.lanternGroup = group;

                const light = new THREE.PointLight(0xffc36c, 2.2, 20);
                light.position.set(0, 5.3, 0);
                gallery.scene.add(light);
                gallery.lanternLight = light;

                gallery.lanternTimer = setInterval(() => {
                    if (!gallery.lanternLight) return;
                    gallery.lanternLight.intensity = 1.5 + Math.random() * 0.9;
                }, 140);

                if (trigger) {
                    const log = document.getElementById('event-log');
                    if (log) log.innerHTML = `> ${trigger}<br>` + log.innerHTML;
                }
            }
        };
        window.gallery = gallery;

        // --- NAVIGATION ---
        window.app = window.app || {};
        window.app.navigate = (target) => {
                audio.click();
                if (state.view === 'profiler' && target !== 'profiler') {
                    profiler.closeModal();
                    document.body.classList.remove('modal-open');
                }

                const targetView = document.getElementById(`view-${target}`);
                if (!targetView) {
                    console.warn(`No view found for target: ${target}`);
                    return;
                }

                document.querySelectorAll('.view-section').forEach(el => el.classList.add('is-hidden'));
                targetView.classList.remove('is-hidden');

                document.querySelectorAll('.nav-btn').forEach(btn => {
                    const isActive = btn.dataset.target === target;
                    if(isActive) btn.classList.add('underline', 'decoration-red-600', 'decoration-2', 'underline-offset-4', 'text-black');
                    else btn.classList.remove('underline', 'decoration-red-600', 'decoration-2', 'underline-offset-4', 'text-black');
                    btn.setAttribute('aria-current', isActive ? 'page' : 'false');
                });

                if (target === 'gallery') {
                    gallery.resize(); gallery.active = true;
                } else {
                    gallery.active = false;
                    gallery.stopLanternEffects();
                }

                if (target === 'archive') {
                    archive.init();
                }

                if (target === 'grift') {
                    grift.init();
                }

                if (target === 'tickets') {
                    valueGate.init();
                }

                if (target === 'barter') {
                    barter.init();
                }

                if (target === 'profiler' && profiler.initialChoice === null) {
                    profiler.init();
                }

                if (target === 'landing') ambient.startTooltips();
                else ambient.stopTooltips();

                state.view = target;
                window.scrollTo(0,0);
            };
        window.app.toggleMobileMenu = () => {
            const menu = document.getElementById('mobile-menu');
            if (menu) menu.classList.toggle('translate-x-full');
        };

        // --- INIT ---
        const loaderSequence = {
            progress: 0,
            loadedAssets: 0,
            totalAssets: 96,
            fill: null,
            text: null,
            stage: null,
            box: null,
            particles: null,
            curtains: null,
            timer: null,
            opened: false,
            start() {
                loaderSequence.stage = document.getElementById('loader-stage');
                loaderSequence.fill = document.getElementById('loader-fill');
                loaderSequence.text = document.getElementById('loader-text');
                loaderSequence.box = document.getElementById('loader-box');
                loaderSequence.particles = document.getElementById('loader-particles');
                loaderSequence.curtains = {
                    left: document.getElementById('curtain-left'),
                    right: document.getElementById('curtain-right')
                };

                loaderSequence.loadedAssets = 0;
                loaderSequence.progress = 0;
                if (!loaderSequence.fill || !loaderSequence.text) return;

                loaderSequence.updateFill();
                if (loaderSequence.timer) clearInterval(loaderSequence.timer);
                loaderSequence.timer = setInterval(() => {
                    loaderSequence.loadedAssets = Math.min(
                        loaderSequence.totalAssets,
                        loaderSequence.loadedAssets + Math.ceil(Math.random() * 4)
                    );
                    loaderSequence.updateFill();
                    if (loaderSequence.loadedAssets >= loaderSequence.totalAssets) loaderSequence.complete();
                }, 150);
            },
            updateFill() {
                if (!loaderSequence.fill) return;
                const scale = Math.max(loaderSequence.loadedAssets / loaderSequence.totalAssets, 0.01);
                loaderSequence.fill.style.setProperty('--loader-progress', scale.toFixed(3));
                if (loaderSequence.text) {
                    loaderSequence.text.innerText = `INITIALIZING LOOMWORKS MANUFACTURE PROTOCOL: CONSTRUCT EMULACRUM. ${Math.round(scale * 100)}%`;
                }
            },
            complete() {
                if (!loaderSequence.fill || loaderSequence.opened) return;
                loaderSequence.opened = true;
                clearInterval(loaderSequence.timer);
                loaderSequence.loadedAssets = loaderSequence.totalAssets;
                loaderSequence.updateFill();
                if (loaderSequence.text) loaderSequence.text.innerText = 'PHASE B: WIGGLE & BURST';
                loaderSequence.wiggleAndBurst();
            },
            wiggleAndBurst() {
                if (loaderSequence.box) loaderSequence.box.classList.add('wiggle');
                audio.playClunk();
                audio.startDrone();
                setTimeout(() => {
                    loaderSequence.spawnParticles();
                    if (loaderSequence.box) loaderSequence.box.classList.add('shattered');
                    loaderSequence.beginBlackout();
                }, 260);
            },
            spawnParticles() {
                if (!loaderSequence.box || !loaderSequence.particles || !loaderSequence.stage) return;
                loaderSequence.particles.innerHTML = '';
                const rect = loaderSequence.box.getBoundingClientRect();
                const stageRect = loaderSequence.stage.getBoundingClientRect();
                const particleSize = rect.width / 16;
                const particleHeight = rect.height / 16;

                for (let y = 0; y < 16; y++) {
                    for (let x = 0; x < 16; x++) {
                        const particle = document.createElement('div');
                        particle.className = 'particle';
                        particle.style.width = `${particleSize}px`;
                        particle.style.height = `${particleHeight}px`;
                        particle.style.left = `${rect.left - stageRect.left + x * particleSize}px`;
                        particle.style.top = `${rect.top - stageRect.top + y * particleHeight}px`;
                        particle.style.setProperty('--tx', `${(Math.random() - 0.5) * 260}px`);
                        particle.style.setProperty('--ty', `${(Math.random() - 0.5) * 260}px`);
                        particle.style.animationDelay = `${Math.random() * 120}ms`;
                        loaderSequence.particles.appendChild(particle);
                    }
                }
            },
            beginBlackout() {
                const loader = document.getElementById('loader');
                if (loader) loader.classList.add('blackout');
                setTimeout(() => {
                    if (loader) loader.classList.remove('blackout');
                    loaderSequence.revealCurtains();
                }, 520);
            },
            revealCurtains() {
                if (loaderSequence.text) loaderSequence.text.innerText = 'PHASE C: CINEMATIC REVEAL';
                if (loaderSequence.curtains?.left) loaderSequence.curtains.left.classList.add('show', 'open-left');
                if (loaderSequence.curtains?.right) loaderSequence.curtains.right.classList.add('show', 'open-right');
                const trailerBtn = document.getElementById('play-trailer-button');
                if (trailerBtn) trailerBtn.classList.remove('hidden');
                const loader = document.getElementById('loader');
                setTimeout(() => {
                    if (loader) {
                        loader.classList.add('fade-out');
                        setTimeout(() => {
                            loader.remove();
                            argOnboarding.maybeShow(true);
                        }, 900);
                    } else {
                        argOnboarding.maybeShow(true);
                    }
                }, 1200);
            }
        };

        document.addEventListener('DOMContentLoaded', () => {
            argOnboarding.init();
            loaderSequence.start();

            tokiDictionary.init();
            registerHeatmap();
            observeBlueprints();
            initScanlineParallax();
            ambient.startTooltips();
            startIdleGlitch();
            initInvoiceMode();
            startGlitchBannerCycle();
            dimeBacklog.bind();
            geoQuiz.init();
            grift.init();
            manufacture.init();
            valueGate.init();
            profiler.init();
            greComments.mountAll();
            bindHoverAudio();

            const primeAudio = () => { audio.startDrone(); };
            document.addEventListener('pointerdown', primeAudio, { once: true });

            document.addEventListener('click', (e) => {
                if (e.target.closest('.ui-click') || e.target.tagName === 'BUTTON') audio.click();
            });
        });

        window.addEventListener('resize', () => sculptureEngine.resize());

        window.addEventListener('load', () => {
            gallery.init();
            archive.init();
            barter.init();
            loaderSequence.complete();
        });
    </script>
</body>
</html>
