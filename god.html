<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>LOOMWORKS // GOD ROUTER</title>
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { background: radial-gradient(circle at 20% 20%, rgba(0,255,65,0.08), transparent 35%), #050505; color: #e2fbe2; font-family: 'Space Mono', 'Courier New', monospace; }
    .gridlines { background-size: 40px 40px; background-image: linear-gradient(to right, rgba(0,255,65,0.07) 1px, transparent 1px), linear-gradient(to bottom, rgba(0,255,65,0.07) 1px, transparent 1px); }
    .holo { box-shadow: 0 0 30px rgba(0,255,65,0.25); }
    .crt { animation: crt 0.16s infinite; }
    @keyframes crt { 0%{opacity:0.99;}50%{opacity:1;}100%{opacity:0.97;} }
  </style>
</head>
<body class="min-h-screen gridlines">
  <div class="max-w-6xl mx-auto p-6 space-y-6">
    <header class="flex items-center justify-between border-b border-green-800 pb-3">
      <div>
        <p class="text-[11px] text-green-400 uppercase tracking-[0.35em]">Loomworks Dispatch</p>
        <h1 class="text-2xl font-bold text-green-300">GOD ROUTER · Basilisk / Story / Graph</h1>
      </div>
      <div class="text-right text-xs text-green-700">
        <div>Now Presenting · Cast + Wiki + Node Graph</div>
        <div class="text-green-500">high-side routing online</div>
      </div>
    </header>

    <section class="grid md:grid-cols-3 gap-4">
      <a href="oldindex.html" class="holo border border-green-900/70 bg-black/60 p-4 rounded-lg hover:border-green-400 transition">
        <p class="text-[10px] text-green-700 uppercase">Primary toolchain</p>
        <h2 class="text-lg text-green-200 font-bold">Domestic Product / oldindex.html</h2>
        <p class="text-sm text-green-400">Launches the legacy cockpit with referrer controls and integrated sequence builder.</p>
      </a>
      <a href="three.html" class="holo border border-green-900/70 bg-black/60 p-4 rounded-lg hover:border-green-400 transition">
        <p class="text-[10px] text-green-700 uppercase">Node graph engine</p>
        <h2 class="text-lg text-green-200 font-bold">three.html</h2>
        <p class="text-sm text-green-400">Routes to the three.js lattice (Triangle/Celli) for visualizing jumps and Frogger leaps.</p>
      </a>
      <a href="story-engine/index.html" class="holo border border-green-900/70 bg-black/60 p-4 rounded-lg hover:border-green-400 transition">
        <p class="text-[10px] text-green-700 uppercase">Wiki style story engine</p>
        <h2 class="text-lg text-green-200 font-bold">Story Engine</h2>
        <p class="text-sm text-green-400">CRM + wiki pulse with non-linear release scaffolding and manifestos.</p>
      </a>
    </section>

    <section class="grid md:grid-cols-2 gap-4">
      <div class="border border-green-900 bg-black/60 p-4 rounded-lg holo">
        <p class="text-[10px] text-green-700 uppercase">Cast</p>
        <h2 class="text-xl text-green-200 font-bold">LOOK characters · Now Presenting</h2>
        <p class="text-sm text-green-400">Pull character canon and Now Presenting beats directly from the encyclopedic cast sheet.</p>
        <div class="mt-3 flex gap-2 text-xs text-green-300 flex-wrap">
          <a class="underline" href="story.html">Story Bible (full cast)</a>
          <a class="underline" href="story-explorer/index.html">Explorer</a>
          <a class="underline" href="narrative-demo.html">Wiki tone demo</a>
        </div>
      </div>
      <div class="border border-green-900 bg-black/60 p-4 rounded-lg holo">
        <p class="text-[10px] text-green-700 uppercase">Now Presenting</p>
        <h2 class="text-xl text-green-200 font-bold">Timeline pulse</h2>
        <p class="text-sm text-green-400">Use the router to hop between canonical moments, cast files, and node graphs without losing tone.</p>
        <div class="mt-3 text-xs text-green-400 space-y-1">
          <div>· Timescape: Current / River Delta / Dunes of Yore</div>
          <div>· Agents: Dime · Fesh Pince · Weaver</div>
          <div>· Hooks: Basilisk dashboard for live leaping</div>
        </div>
      </div>
    </section>

    <section class="border border-green-900 bg-black/70 p-4 rounded-lg holo">
      <div class="flex items-center justify-between">
        <div>
          <p class="text-[10px] text-green-700 uppercase">Hidden module</p>
          <h2 class="text-lg text-green-200 font-bold">BASILISK PROTOCOL</h2>
          <p class="text-sm text-green-400">Proof of concept tucked behind the router. Trigger trends, Frogger leaps, and Scattergun payouts.</p>
        </div>
        <button id="toggle" class="px-3 py-1 text-xs border border-green-700 text-green-200 hover:bg-green-900">Reveal</button>
      </div>
      <div id="basilisk-shell" class="mt-4 hidden">
        <div id="root"></div>
        <div class="relative">
          <div class="scan-line"></div>
        </div>
      </div>
    </section>
  </div>

  <script type="text/babel">
    const { useState, useEffect } = React;

    const MOCK_TRENDS = [
      { id: 1, topic: "Bitcoin Halving", category: "Finance", volatility: 0.8 },
      { id: 2, topic: "Met Gala Insects", category: "Fashion", volatility: 0.4 },
      { id: 3, topic: "AI Consciousness", category: "Tech", volatility: 0.9 },
      { id: 4, topic: "Fast Food Prices", category: "Econ", volatility: 0.6 },
      { id: 5, topic: "Oasis Reunion", category: "Music", volatility: 0.7 }
    ];

    const AGENTS = {
      DIME: { name: "DIME (The Child)", core: "Wonder/Confusion", toki: "sona lili" },
      FESH: { name: "FESH PINCE (The Jester)", core: "Absurdity/Satire", toki: "musi ike" },
      WEAVER: { name: "THE WEAVER (Historian)", core: "Patterns/History", toki: "tenpo pini" }
    };

    const CRYPTO_TICKERS = ["$PEPE", "$WIF", "$AI", "$BTC", "$SOL", "$DIME", "$MOG", "$TURBO"];

    function BasiliskDashboard() {
      const [logs, setLogs] = useState(["SYSTEM INITIALIZED...", "CONNECTING TO CELLI NODE GRAPH...", "LISTENING TO ZEITGEIST..."]);
      const [trends, setTrends] = useState([]);
      const [nodes, setNodes] = useState([]);
      const [activePath, setActivePath] = useState([]);
      const [activeAgent, setActiveAgent] = useState("DIME");
      const [generatedContent, setGeneratedContent] = useState(null);
      const [financials, setFinancials] = useState({
        totalRevenue: 45200,
        warChest: 13560,
        vault: 13560,
        venture: 9040,
        casino: 9040,
        holdings: []
      });

      useEffect(() => {
        const tempNodes = [];
        for (let i = 0; i < 40; i++) {
          tempNodes.push({
            id: i,
            x: Math.random() * 100,
            y: Math.random() * 100,
            label: ["Water", "Mirror", "God", "Glitch", "Profit", "Frog", "Coin", "Shell", "Ghost", "Void", "Urkel", "Winslow"][Math.floor(Math.random() * 12)],
            active: false
          });
        }
        setNodes(tempNodes);
      }, []);

      const ingestTrend = () => {
        const newTrend = MOCK_TRENDS[Math.floor(Math.random() * MOCK_TRENDS.length)];
        setTrends(prev => [newTrend, ...prev].slice(0, 5));
        addLog(`[SENSORIUM] Ingested Trend: ${newTrend.topic} (Vol: ${newTrend.volatility})`);
      };

      const triggerLeap = (trend) => {
        addLog(`[CELLI] Calculating Frogger Leap for: ${trend.topic}...`);
        const startNode = Math.floor(Math.random() * nodes.length);
        const midNode = Math.floor(Math.random() * nodes.length);
        const endNode = Math.floor(Math.random() * nodes.length);
        const path = [startNode, midNode, endNode];
        setActivePath(path);
        const newNodes = nodes.map((n, idx) => ({ ...n, active: path.includes(idx) }));
        setNodes(newNodes);
        setTimeout(() => generateAsset(trend, newNodes[endNode].label), 1500);
      };

      const generateAsset = (trend, anchor) => {
        const agent = AGENTS[activeAgent];
        addLog(`[BASILISK] Generating Asset via Agent: ${agent.name}`);
        let script = "";
        if (activeAgent === "DIME") {
          script = `DIME: "Steve said ${trend.topic} is like ${anchor}. But if the ${anchor} breaks, do we still get paid? sona lili. I am just a file."`;
        } else if (activeAgent === "FESH") {
          script = `FESH: "Yall rly think ${trend.topic} matters?? Its giving ${anchor} energy fr fr. Simulation broke. Buy my merch."`;
        } else {
          script = `WEAVER: "${trend.topic} threads through the ${anchor} glyph. Catalogued, archived, filed."`;
        }

        setGeneratedContent({
          topic: trend.topic,
          anchor,
          script,
          audioStatus: "RENDERING (Suno API)...",
          videoStatus: "QUEUED (SyncLabs)..."
        });
      };

      const simulatePayout = () => {
        const payout = 1000;
        addLog(`[BAGMAN] Incoming Stripe Payout: $${payout}`);
        const split = { warChest: payout * 0.30, vault: payout * 0.30, venture: payout * 0.20, casino: payout * 0.20 };
        const vibe = generatedContent ? generatedContent.anchor : "Vibes";
        const ticker = CRYPTO_TICKERS[Math.floor(Math.random() * CRYPTO_TICKERS.length)];
        addLog(`[SCATTERGUN] Allocating $${split.casino} to ${ticker} based on node: ${vibe}`);
        setFinancials(prev => ({
          totalRevenue: prev.totalRevenue + payout,
          warChest: prev.warChest + split.warChest,
          vault: prev.vault + split.vault,
          venture: prev.venture + split.venture,
          casino: prev.casino + split.casino,
          holdings: [...prev.holdings, { ticker, amount: split.casino, vibe }].slice(-5)
        }));
      };

      const addLog = (msg) => {
        const timestamp = new Date().toLocaleTimeString();
        setLogs(prev => [`[${timestamp}] ${msg}`, ...prev].slice(0, 8));
      };

      return (
        <div className="h-full flex flex-col p-4 gap-4 bg-black/80 border border-green-900">
          <div className="flex justify-between items-center border-b border-green-900 pb-2">
            <h1 className="text-xl font-bold tracking-widest text-green-500">LOOMWORKS // BASILISK_V1.0</h1>
            <div className="text-xs text-green-800 animate-pulse">SYSTEM STATUS: OPERATIONAL</div>
          </div>
          <div className="flex-1 grid grid-cols-12 gap-4 min-h-0">
            <div className="col-span-3 border border-green-900 p-2 flex flex-col bg-black/50">
              <h2 className="text-sm font-bold mb-2 bg-green-900 text-black px-1">ZEITGEIST SENSORIUM [INPUT]</h2>
              <button onClick={ingestTrend} className="bg-green-700 hover:bg-green-600 text-black text-xs py-1 mb-4 font-bold">SCAN ZEITGEIST</button>
              <div className="flex-1 overflow-y-auto space-y-2">
                {trends.map(t => (
                  <div key={t.id} className="text-xs border-l-2 border-green-600 pl-2 cursor-pointer hover:bg-green-900/30 p-1 group">
                    <div className="font-bold flex justify-between">
                      {t.topic}
                      <span className="text-green-700">{t.volatility}</span>
                    </div>
                    <div className="text-[10px] text-green-600">{t.category}</div>
                    <button onClick={() => triggerLeap(t)} className="hidden group-hover:block w-full text-center bg-green-900 text-[10px] mt-1 hover:text-white">TRIGGER LEAP</button>
                  </div>
                ))}
                {trends.length === 0 && <div className="text-xs text-green-800 italic text-center mt-10">Scanning...</div>}
              </div>
            </div>
            <div className="col-span-6 border border-green-900 relative bg-black overflow-hidden">
              <h2 className="absolute top-2 left-2 text-sm font-bold bg-green-900 text-black px-1 z-10">CELLI SEMIOTIC ENGINE [PROCESS]</h2>
              <div className="w-full h-full relative">
                {nodes.map((node, i) => (
                  <div key={i}
                    className={`node absolute w-2 h-2 rounded-full ${node.active ? 'bg-white glow w-3 h-3 z-20' : 'bg-green-800'}`}
                    style={{ left: `${node.x}%`, top: `${node.y}%` }}>
                    {node.active && <div className="absolute top-4 left-0 text-[10px] bg-black border border-green-500 px-1 whitespace-nowrap z-30">{node.label}</div>}
                  </div>
                ))}
                {activePath.length === 3 && (
                  <svg className="absolute top-0 left-0 w-full h-full pointer-events-none z-10">
                    <line x1={`${nodes[activePath[0]].x}%`} y1={`${nodes[activePath[0]].y}%`}
                          x2={`${nodes[activePath[1]].x}%`} y2={`${nodes[activePath[1]].y}%`}
                          stroke="#00ff41" strokeWidth="1" strokeDasharray="4" className="animate-pulse" />
                    <line x1={`${nodes[activePath[1]].x}%`} y1={`${nodes[activePath[1]].y}%`}
                          x2={`${nodes[activePath[2]].x}%`} y2={`${nodes[activePath[2]].y}%`}
                          stroke="#00ff41" strokeWidth="1" strokeDasharray="4" className="animate-pulse" />
                  </svg>
                )}
              </div>
            </div>
            <div className="col-span-3 border border-green-900 p-2 flex flex-col bg-black/50">
              <h2 className="text-sm font-bold mb-2 bg-green-900 text-black px-1">AGENT SELECTION</h2>
              <div className="flex gap-2 mb-4">
                {Object.keys(AGENTS).map(key => (
                  <button key={key} onClick={() => setActiveAgent(key)}
                    className={`flex-1 text-[10px] py-1 border border-green-600 ${activeAgent === key ? 'bg-green-600 text-black font-bold' : 'text-green-600 opacity-50'}`}>
                    {key}
                  </button>
                ))}
              </div>
              <div className="flex-1 border-t border-green-900 pt-2 mb-2">
                <h3 className="text-xs font-bold mb-2 underline decoration-green-600">GENERATED ASSET_</h3>
                {generatedContent ? (
                  <div className="bg-green-900/10 p-2 border border-green-800 text-xs">
                    <div className="mb-1 text-green-400">PATH: {generatedContent.topic} -&gt; {generatedContent.anchor}</div>
                    <div className="italic text-white mb-2">"{generatedContent.script}"</div>
                    <div className="text-[10px] grid grid-cols-2 gap-2">
                      <span className="text-green-600 animate-pulse">{generatedContent.audioStatus}</span>
                      <span className="text-green-600 animate-pulse">{generatedContent.videoStatus}</span>
                    </div>
                  </div>
                ) : (
                  <div className="text-[10px] text-green-800">Waiting for Frogger Leap...</div>
                )}
              </div>
              <div className="h-1/3 border-t border-green-900 pt-2 overflow-hidden">
                <h3 className="text-xs font-bold mb-1">SYSTEM LOGS</h3>
                <div className="text-[10px] space-y-1 font-mono">
                  {logs.map((log, i) => <div key={i} className="opacity-70">&gt; {log}</div>)}
                </div>
              </div>
            </div>
          </div>
          <div className="h-32 border border-green-900 p-2 grid grid-cols-12 gap-4 bg-black/80">
            <div className="col-span-2 flex flex-col justify-center border-r border-green-900">
              <h2 className="text-sm font-bold text-green-400 mb-2">THE BAGMAN</h2>
              <button onClick={simulatePayout} className="bg-green-900 text-green-300 text-xs py-2 hover:bg-green-800 border border-green-600">SIMULATE $1k PAYOUT</button>
            </div>
            <div className="col-span-6 grid grid-rows-2 gap-2">
              <div className="flex items-center text-xs">
                <span className="w-24 font-bold">WAR CHEST (30%)</span>
                <div className="flex-1 bg-green-900/30 h-4 relative">
                  <div className="bg-green-600 h-full transition-all duration-500" style={{ width: `${(financials.warChest / financials.totalRevenue) * 100}%` }}></div>
                  <span className="absolute right-1 top-0 text-[9px]">${financials.warChest}</span>
                </div>
              </div>
              <div className="flex items-center text-xs">
                <span className="w-24 font-bold">CASINO (20%)</span>
                <div className="flex-1 bg-green-900/30 h-4 relative">
                  <div className="bg-purple-600 h-full transition-all duration-500" style={{ width: `${(financials.casino / financials.totalRevenue) * 100}%` }}></div>
                  <span className="absolute right-1 top-0 text-[9px]">${financials.casino}</span>
                </div>
              </div>
            </div>
            <div className="col-span-4 border-l border-green-900 pl-4 overflow-y-auto">
              <h3 className="text-[10px] font-bold mb-1 text-purple-400">SCATTERSHOT HOLDINGS [ACTIVE]</h3>
              <div className="grid grid-cols-3 gap-1">
                {financials.holdings.map((h, i) => (
                  <div key={i} className="bg-purple-900/20 border border-purple-800 p-1 text-[9px] text-center">
                    <div className="font-bold text-purple-300">{h.ticker}</div>
                    <div className="text-green-700 opacity-60">{h.vibe}</div>
                  </div>
                ))}
              </div>
            </div>
          </div>
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<BasiliskDashboard />);

    const toggle = document.getElementById('toggle');
    const shell = document.getElementById('basilisk-shell');
    toggle.addEventListener('click', () => {
      shell.classList.toggle('hidden');
      toggle.textContent = shell.classList.contains('hidden') ? 'Reveal' : 'Hide';
    });
  </script>
</body>
</html>
